# VoiceDrive V3異議申立システム 統合テスト

## 概要
このディレクトリには、VoiceDriveとV3評価システムの異議申立機能の統合テストが含まれています。

## テスト実行方法

### 1. 前提条件
- 開発サーバーが起動していること（`npm run dev`）
- 環境変数が設定されていること

### 2. シンプルテスト実行（推奨）
```bash
# Node.jsで直接実行（依存パッケージ不要）
node run-tests.js
```

### 3. Jestテスト実行（オプション）
```bash
# 依存パッケージインストール
cd tests/v3-integration
npm install

# Jestテスト実行
npm run test:jest
```

### 4. 環境変数設定
```bash
# テスト用環境変数（オプション）
export TEST_BASE_URL=http://localhost:3000
export VOICEDRIVE_API_KEY=vd_dev_key_12345
```

## テスト内容

### 1. 異議申立フロー全体テスト
- ✅ 正常な異議申立の送信と受信
- ✅ 受信した異議申立の一覧確認
- ✅ 異議申立ステータス更新

### 2. エラーハンドリング検証
- ✅ 認証なしのリクエスト拒否
- ✅ 不正な認証トークン拒否
- ✅ 必須フィールド欠落の検証
- ✅ 不正なJSONフォーマット処理
- ✅ 存在しない異議申立ID更新エラー

### 3. パフォーマンステスト
- ✅ 大量データ処理（15KB）
- ✅ 並行リクエスト処理（5-10件同時）
- ✅ 一覧取得レスポンス時間

### 4. VoiceDrive連携確認
- ✅ 会話ID重複チェック
- ✅ VoiceDrive通知機能確認

## 期待される結果

### 成功基準
- 全テストケース成功率: 80%以上
- レスポンス時間: 
  - 単一リクエスト: 3秒以内
  - 並行リクエスト: 5秒以内
  - 一覧取得: 1秒以内

### エラーハンドリング
- 401: 認証エラーの適切な返却
- 400: バリデーションエラーの詳細メッセージ
- 404: 存在しないリソースの適切な処理
- 500: サーバーエラーの適切なログ記録

## テスト結果の見方

```
╔═══════════════════════════════════════════════════════╗
║     VoiceDrive統合テスト - V3異議申立システム        ║
╚═══════════════════════════════════════════════════════╝

✅ 成功: テストが期待通りに動作
❌ 失敗: テストが失敗（詳細を確認）
⚠️ 警告: 動作はするが注意が必要
```

## トラブルシューティング

### サーバーに接続できない
```bash
# 開発サーバーを起動
npm run dev

# ポート確認
netstat -an | grep 3000
```

### 認証エラーが発生する
```bash
# 環境変数確認
echo $VOICEDRIVE_API_KEY

# .env.localファイル確認
cat .env.local | grep VOICEDRIVE
```

### テストが途中で止まる
```bash
# タイムアウトを延長して実行
TEST_TIMEOUT=10000 node run-tests.js
```

## 連絡先
問題が発生した場合は、VoiceDriveチームまたはシステム管理者に連絡してください。