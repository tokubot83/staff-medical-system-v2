# Phase 2 ユーザーフロー詳細設計書

**作成日**: 2025年8月10日  
**バージョン**: 1.0

## 1. 3段階選択フローの概要

### フロー構造
```
┌─────────────────┐
│   開始画面      │
└────────┬────────┘
         ↓
┌─────────────────┐
│ Step 1: 分類選択│
│ ・定期面談      │
│ ・特別面談      │
│ ・サポート面談  │
└────────┬────────┘
         ↓
┌─────────────────┐
│ Step 2: 種別選択│
│ (分類に応じた   │
│  選択肢を表示)  │
└────────┬────────┘
         ↓
┌─────────────────┐
│ Step 3: カテゴリ│ ← 条件付き（3種類の面談のみ）
│ (必要な場合のみ)│
└────────┬────────┘
         ↓
┌─────────────────┐
│ Step 4: 職員・  │
│   日時選択      │
└────────┬────────┘
         ↓
┌─────────────────┐
│   確認画面      │
└────────┬────────┘
         ↓
┌─────────────────┐
│   予約完了      │
└─────────────────┘
```

## 2. 各ステップの詳細

### Step 1: 面談分類選択

**目的**: ユーザーが面談の大まかな種類を選択

**UI要素**:
- 3つの大きなカードボタン
- アイコンと説明文付き
- ホバー効果とアニメーション

**選択肢**:
1. **定期面談** 📅
   - 説明: 月次・年次・半期などの定期的な面談
   - 色: グリーン (#4CAF50)

2. **特別面談** ⚠️
   - 説明: 特定の状況で実施する面談
   - 色: オレンジ (#FF9800)

3. **サポート面談** 💬
   - 説明: 職員の希望に応じて実施する支援面談
   - 色: ブルー (#2196F3)

### Step 2: 面談種別選択

**目的**: 具体的な面談種別を選択

**条件分岐**:
```javascript
if (selectedClassification === 'regular') {
  // 3種類の定期面談を表示
  options = [
    '新入職員月次面談',
    '一般職員年次面談',
    '管理職半年面談'
  ]
} else if (selectedClassification === 'special') {
  // 3種類の特別面談を表示
  options = [
    '復職面談',
    'インシデント後面談',
    '退職面談'
  ]
} else if (selectedClassification === 'support') {
  // 4種類のサポート面談を表示
  options = [
    'フィードバック面談',
    'キャリア系面談',      // カテゴリ必須
    '職場環境系面談',      // カテゴリ必須
    '個別相談面談'         // カテゴリ必須
  ]
}
```

### Step 3: カテゴリ選択（条件付き）

**表示条件**:
```javascript
const requiresCategorySelection = [
  'career_support',
  'workplace_support',
  'individual_consultation'
].includes(selectedType);
```

**カテゴリ選択肢**:

**キャリア系面談**:
- キャリアプラン相談
- 資格取得支援
- 異動・転職相談
- スキルアップ相談

**職場環境系面談**:
- 人間関係の悩み
- ハラスメント相談
- 業務負荷相談
- 職場改善提案
- 勤務体制相談

**個別相談面談**:
- プライベート相談
- 健康相談
- その他の相談

### Step 4: 職員・日時選択

**UI要素**:
- 職員選択ドロップダウン
- カレンダー日付選択
- 時間選択
- 予約確認ボタン

**表示情報**:
- 職員名
- 所属部署
- 経験年数カテゴリ
- 選択可能な日時

## 3. プログレスバー仕様

### 表示パターン

**カテゴリ不要な面談（7種類）**:
```
[1.分類] → [2.種別] → [3.職員・日時]
```

**カテゴリ必須な面談（3種類）**:
```
[1.分類] → [2.種別] → [3.カテゴリ] → [4.職員・日時]
```

### 状態表示
- **未選択**: グレー
- **選択中**: ブルー + 背景色
- **完了済**: グリーン + チェックマーク

## 4. 選択内容サマリー

**表示位置**: 画面下部に常時表示

**表示内容**:
```
選択内容
━━━━━━━━━━━━━━━━━━━━
面談分類: サポート面談
面談種別: キャリア系面談
カテゴリ: キャリアプラン相談
対象職員: 山田太郎（内科・5年目）
日時: 2025/08/15 14:00
━━━━━━━━━━━━━━━━━━━━
```

## 5. エラーハンドリング

### バリデーション
- 必須項目の未選択チェック
- 日時の妥当性チェック（過去日時不可）
- 職員の対象条件チェック

### エラーメッセージ
```javascript
const errorMessages = {
  noStaff: '職員を選択してください',
  noDate: '日付を選択してください',
  noTime: '時間を選択してください',
  pastDate: '過去の日時は選択できません',
  invalidTarget: 'この職員は選択した面談の対象外です'
};
```

## 6. モバイル対応

### ブレークポイント
- デスクトップ: 1024px以上
- タブレット: 768px〜1023px
- モバイル: 767px以下

### レスポンシブ対応
- カードレイアウト: グリッド → 縦積み
- プログレスバー: 横並び → 縦並び
- ボタンサイズ: タップしやすいサイズに拡大

## 7. アニメーション仕様

### ページ遷移
- フェードイン/アウト: 300ms
- スライド効果: 次へ進む時は左へ、戻る時は右へ

### ホバー効果
- カード: 上方向に4px移動 + 影の強調
- ボタン: 背景色の変化（明度10%アップ）

### 選択時フィードバック
- クリック時: スケールダウン（0.95倍）
- 選択完了時: チェックマークアニメーション

## 8. アクセシビリティ

### キーボード操作
- Tab: 次の要素へ移動
- Shift+Tab: 前の要素へ移動
- Enter/Space: 選択実行
- Esc: キャンセル/戻る

### スクリーンリーダー対応
- 適切なaria-labelの設定
- ロール属性の明示
- フォーカス管理

## 9. パフォーマンス最適化

### 目標値
- 初期表示: 1秒以内
- ステップ遷移: 50ms以内
- API応答: 200ms以内

### 最適化手法
- コンポーネントの遅延読み込み
- 画像の最適化
- キャッシュの活用

## 10. 実装チェックリスト

- [ ] 3段階選択フローコンポーネント作成
- [ ] プログレスバーコンポーネント実装
- [ ] サマリー表示機能
- [ ] モバイルレスポンシブ対応
- [ ] アニメーション実装
- [ ] バリデーション処理
- [ ] エラーハンドリング
- [ ] アクセシビリティ対応
- [ ] パフォーマンステスト
- [ ] ユーザビリティテスト

## 11. VoiceDriveとの連携ポイント

### API連携
- 予約可能時間の取得
- 予約確定処理
- キャンセル処理

### データ同期
- 職員マスタの同期
- カレンダー情報の同期
- 通知設定の同期

---

**次のステップ**: この設計書を基に、VoiceDriveチームとのレビューミーティングを実施し、フィードバックを収集する。