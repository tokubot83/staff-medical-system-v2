# å¥åº·æ©Ÿèƒ½å®Ÿè£… ä½œæ¥­å†é–‹æŒ‡ç¤ºæ›¸

**ä½œæˆæ—¥**: 2025å¹´9æœˆ30æ—¥
**å¯¾è±¡**: DBæ§‹ç¯‰å®Œäº†å¾Œã®å®Ÿè£…å†é–‹
**å‰æ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰UIå®Ÿè£…å®Œäº†æ¸ˆã¿

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### å®Ÿè£…çŠ¶æ³
- âœ… **UI/ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: 100%å®Œäº†
- â³ **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰/API**: 0%ï¼ˆDBæ§‹ç¯‰å¾…ã¡ï¼‰
- â³ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: 0%ï¼ˆå…±é€šDBæ§‹ç¯‰å¾…ã¡ï¼‰

### å®Œäº†æ¸ˆã¿ä½œæ¥­ï¼ˆ2025-09-30ï¼‰
1. å¥åº·ãƒšãƒ¼ã‚¸çµ±åˆãƒ»æ•´ç†ï¼ˆ951è¡Œå‰Šæ¸›ï¼‰
2. è·å“¡ã‚«ãƒ«ãƒ†éšå±¤åŒ–ã‚¿ãƒ–æ§‹é€ å®Ÿè£…ï¼ˆ6ã‚«ãƒ†ã‚´ãƒªÃ—17ã‚¿ãƒ–ï¼‰
3. å¥åº·è¨ºæ–­è©³ç´°è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
4. URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é€£æºå®Ÿè£…
5. ã‚¦ã‚§ãƒ«ãƒ“ãƒ¼ã‚¤ãƒ³ã‚°â‡”å¥åº·è¨ºæ–­ã®ç›¸äº’ãƒªãƒ³ã‚¯
6. ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆè¨­å®š

### æ®‹ä½œæ¥­ï¼ˆDBæ§‹ç¯‰å¾Œï¼‰
- **Phase 1 MVP**: CSVå–è¾¼ã€CRUD APIã€çµæœé…ä¿¡ï¼ˆæ¨å®š30æ—¥ï¼‰
- **Phase 2 åŸºæœ¬**: ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯ã€ç—…æ­´ç®¡ç†ï¼ˆæ¨å®š3ãƒ¶æœˆï¼‰
- **Phase 3 æ‹¡å¼µ**: ç”£æ¥­åŒ»æ©Ÿèƒ½ã€çµ±è¨ˆåˆ†æã€ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆæ¨å®š6ãƒ¶æœˆï¼‰

---

## âœ… å®Œäº†æ¸ˆã¿å®Ÿè£…è©³ç´°

### 1. UI/ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

#### âœ… HealthCheckupDetailView ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/health/HealthCheckupDetailView.tsx`
**è¡Œæ•°**: 649è¡Œ
**æ©Ÿèƒ½**:
- å¥åº·è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã®è©³ç´°è¡¨ç¤º
- 5ã‚«ãƒ¼ãƒ‰ã‚µãƒãƒªãƒ¼ï¼ˆæœ€æ–°ã€ç•°å¸¸ã€å‚¾å‘ã€å†æ¤œæŸ»ã€çµ±è¨ˆï¼‰
- 5ã‚¿ãƒ–è©³ç´°ï¼ˆæ¦‚è¦ã€æ¤œæŸ»çµæœã€çµŒå¹´å¤‰åŒ–ã€ç”£æ¥­åŒ»æ‰€è¦‹ã€ã‚¹ãƒˆãƒ¬ã‚¹ï¼‰
- BMIãƒ»è¡€åœ§è‡ªå‹•è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯
- ç•°å¸¸é …ç›®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
- ãƒˆãƒ¬ãƒ³ãƒ‰ã‚°ãƒ©ãƒ•è¡¨ç¤º
- ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
- VoiceDriveã‚¢ãƒ‰ãƒã‚¤ã‚¹è¡¨ç¤ºæº–å‚™

**ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆ`generateMockHealthData()`ï¼‰

#### âœ… è·å“¡ã‚«ãƒ«ãƒ†éšå±¤åŒ–ã‚¿ãƒ–æ§‹é€ 
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/staff-cards/[staffId]/page.tsx`
**å¤‰æ›´å†…å®¹**:
- 6ã‚«ãƒ†ã‚´ãƒªÃ—17ã‚¿ãƒ–ã®2å±¤æ§‹é€ å®Ÿè£…
- URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¯¾å¿œï¼ˆ`?category=health&tab=health-checkup`ï¼‰
- ã‚«ãƒ†ã‚´ãƒªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³UIï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼‰
- `handleTabChange()`é–¢æ•°ã§URLæ›´æ–°
- HealthCheckupDetailViewçµ±åˆ

**ã‚¿ãƒ–æ§‹æˆ**:
```typescript
const tabCategories = {
  basic: { label: 'åŸºæœ¬æƒ…å ±', tabs: ['basic', 'career', 'mindset'] },
  achievements: { label: 'è³‡æ ¼ãƒ»å®Ÿç¸¾', tabs: ['licenses', 'skills', 'awards'] },
  health: { label: 'å¥åº·ç®¡ç†', tabs: ['attendance', 'wellbeing', 'health-checkup'] },
  evaluation: { label: 'è©•ä¾¡ãƒ»é¢è«‡', tabs: ['evaluations', 'interviews', 'disciplinary'] },
  training: { label: 'è‚²æˆ', tabs: ['education', 'onboarding', 'goals'] },
  links: { label: 'é–¢é€£æƒ…å ±', tabs: ['reports', 'relations', 'activity'] }
};
```

#### âœ… ãƒšãƒ¼ã‚¸æ•´ç†ãƒ»ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- `/health/page.tsx` - å‰Šé™¤ï¼ˆ404è¡Œï¼‰
- `/health/Health.module.css` - å‰Šé™¤ï¼ˆ545è¡Œï¼‰
- `/health/staff/[staffId]/page.tsx` - ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒšãƒ¼ã‚¸ã«å¤‰æ›´ï¼ˆ33è¡Œï¼‰
- `MainLayout.tsx` - ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯æ›´æ–°

#### âœ… ã‚¹ã‚¿ã‚¤ãƒ«å®Ÿè£…
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/staff-cards/StaffCards.module.css`
**è¿½åŠ å†…å®¹**:
- ã‚«ãƒ†ã‚´ãƒªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³CSS
- ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯
- ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚¹ã‚¿ã‚¤ãƒ«

---

## â³ æœªå®Ÿè£…é …ç›®ï¼ˆDBæ§‹ç¯‰å¾Œã®ä½œæ¥­ï¼‰

### Phase 1: MVPæ©Ÿèƒ½ï¼ˆæ¨å®š30æ—¥ï¼‰

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆãƒ»æ§‹ç¯‰
**å„ªå…ˆåº¦**: â˜…â˜…â˜…
**æ¨å®šå·¥æ•°**: 5æ—¥

##### å¿…è¦ãªãƒ†ãƒ¼ãƒ–ãƒ«

**â‘  health_checkupsï¼ˆå¥åº·è¨ºæ–­ãƒã‚¹ã‚¿ãƒ¼ï¼‰**
```sql
CREATE TABLE health_checkups (
  id VARCHAR(50) PRIMARY KEY,
  staff_id VARCHAR(50) NOT NULL,
  checkup_date DATE NOT NULL,
  checkup_type ENUM('å®šæœŸ', 'é›‡å…¥æ™‚', 'ç‰¹æ®Š', 'æµ·å¤–æ´¾é£') DEFAULT 'å®šæœŸ',
  facility_name VARCHAR(100),

  -- åŸºæœ¬æ¸¬å®šå€¤
  height DECIMAL(4,1),
  weight DECIMAL(4,1),
  bmi DECIMAL(3,1) GENERATED AS (weight / POWER(height/100, 2)),
  waist_circumference DECIMAL(4,1),

  -- è¡€åœ§
  systolic_bp INT,
  diastolic_bp INT,

  -- è¦–åŠ›
  vision_left DECIMAL(2,1),
  vision_right DECIMAL(2,1),

  -- ç·åˆåˆ¤å®š
  overall_result ENUM('A', 'B', 'C', 'D', 'E'),
  reexamination_required BOOLEAN DEFAULT FALSE,
  reexamination_items JSON,

  -- ç®¡ç†æƒ…å ±
  data_source ENUM('csv_import', 'manual', 'api') DEFAULT 'csv_import',
  created_by VARCHAR(50),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (staff_id) REFERENCES staff_master(id),
  INDEX idx_staff_date (staff_id, checkup_date DESC),
  INDEX idx_result (overall_result, reexamination_required)
);
```

**â‘¡ health_checkup_detailsï¼ˆæ¤œæŸ»çµæœè©³ç´°ï¼‰**
```sql
CREATE TABLE health_checkup_details (
  id VARCHAR(50) PRIMARY KEY,
  checkup_id VARCHAR(50) NOT NULL,
  category ENUM(
    'vision', 'hearing', 'blood', 'urine',
    'liver', 'lipid', 'kidney', 'ecg', 'xray'
  ),
  item_code VARCHAR(50) NOT NULL,
  item_name VARCHAR(100) NOT NULL,
  value VARCHAR(50),
  unit VARCHAR(20),
  reference_min DECIMAL(10,2),
  reference_max DECIMAL(10,2),
  status ENUM('normal', 'attention', 'abnormal'),

  FOREIGN KEY (checkup_id) REFERENCES health_checkups(id) ON DELETE CASCADE,
  INDEX idx_checkup_category (checkup_id, category),
  INDEX idx_abnormal (status, item_code)
);
```

**â‘¢ medical_historiesï¼ˆç—…æ­´ãƒ»æ—¢å¾€æ­´ç®¡ç†ï¼‰**
```sql
CREATE TABLE medical_histories (
  id VARCHAR(50) PRIMARY KEY,
  staff_id VARCHAR(50) NOT NULL,
  report_date DATE NOT NULL,
  report_type ENUM('å…¥è·æ™‚', 'å®šæœŸæ›´æ–°', 'éšæ™‚ç”³å‘Š') DEFAULT 'å®šæœŸæ›´æ–°',

  -- ç—…æ­´æƒ…å ±
  disease_name VARCHAR(200),
  icd10_code VARCHAR(10),
  diagnosis_date DATE,
  treatment_status ENUM('æ²»ç™‚ä¸­', 'çµŒéè¦³å¯Ÿ', 'å®Œæ²»', 'æœªæ²»ç™‚') DEFAULT 'æ²»ç™‚ä¸­',

  -- æ²»ç™‚æƒ…å ±
  medication JSON, -- [{name, dose, frequency}]
  medical_institution VARCHAR(100),
  attending_doctor VARCHAR(50),

  -- å°±æ¥­ã¸ã®å½±éŸ¿
  work_restrictions TEXT,
  accommodation_needed BOOLEAN DEFAULT FALSE,

  -- ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—
  next_checkup_date DATE,
  notes TEXT,

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (staff_id) REFERENCES staff_master(id),
  INDEX idx_staff_status (staff_id, treatment_status),
  INDEX idx_followup (next_checkup_date)
);
```

**â‘£ work_accommodationsï¼ˆå°±æ¥­é…æ…®ç®¡ç†ï¼‰**
```sql
CREATE TABLE work_accommodations (
  id VARCHAR(50) PRIMARY KEY,
  staff_id VARCHAR(50) NOT NULL,

  -- é…æ…®å†…å®¹
  accommodation_type ENUM(
    'å°±æ¥­åˆ¶é™', 'é…ç½®è»¢æ›', 'æ™‚çŸ­å‹¤å‹™',
    'åœ¨å®…å‹¤å‹™', 'å¤œå‹¤å…é™¤', 'ãã®ä»–'
  ),
  start_date DATE NOT NULL,
  end_date DATE,
  is_active BOOLEAN DEFAULT TRUE,

  -- è©³ç´°
  reason VARCHAR(200),
  details TEXT,
  doctor_opinion TEXT,

  -- æ‰¿èªæƒ…å ±
  requested_by VARCHAR(50),
  approved_by VARCHAR(50),
  approved_date DATE,
  status ENUM('ç”³è«‹ä¸­', 'æ‰¿èªæ¸ˆ', 'å®Ÿæ–½ä¸­', 'çµ‚äº†', 'å´ä¸‹') DEFAULT 'ç”³è«‹ä¸­',

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (staff_id) REFERENCES staff_master(id),
  INDEX idx_active (is_active, end_date),
  INDEX idx_staff_accommodation (staff_id, accommodation_type)
);
```

**â‘¤ health_eventsï¼ˆå¥åº·ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´ï¼‰**
```sql
CREATE TABLE health_events (
  id VARCHAR(50) PRIMARY KEY,
  staff_id VARCHAR(50) NOT NULL,
  event_date DATETIME NOT NULL,
  event_type ENUM(
    'å¥åº·è¨ºæ–­å®Ÿæ–½', 'å†æ¤œæŸ»å®Ÿæ–½', 'ç”£æ¥­åŒ»é¢è«‡',
    'ä¿å¥æŒ‡å°', 'ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯', 'äºˆé˜²æ¥ç¨®',
    'ç—…æ­´æ›´æ–°', 'å°±æ¥­åˆ¶é™é–‹å§‹', 'å°±æ¥­åˆ¶é™è§£é™¤',
    'çµæœé€šçŸ¥', 'ãƒªãƒã‚¤ãƒ³ãƒ‰é€ä¿¡'
  ),

  -- ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°
  title VARCHAR(200),
  description TEXT,
  related_id VARCHAR(50), -- é–¢é€£ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ID

  -- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  action_required TEXT,
  action_completed BOOLEAN DEFAULT FALSE,
  follow_up_date DATE,

  -- è¨˜éŒ²æƒ…å ±
  recorded_by VARCHAR(50),
  department ENUM('äººäº‹éƒ¨', 'å¥è¨ºå®¤', 'ç”£æ¥­åŒ»', 'ã‚·ã‚¹ãƒ†ãƒ '),

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (staff_id) REFERENCES staff_master(id),
  INDEX idx_staff_events (staff_id, event_date DESC),
  INDEX idx_followup_pending (follow_up_date, action_completed)
);
```

##### Prismaã‚¹ã‚­ãƒ¼ãƒè¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `prisma/schema.prisma`

```prisma
// å¥åº·è¨ºæ–­ãƒã‚¹ã‚¿ãƒ¼
model HealthCheckup {
  id                   String   @id @default(cuid())
  staffId              String   @map("staff_id")
  checkupDate          DateTime @map("checkup_date") @db.Date
  checkupType          String   @default("å®šæœŸ") @map("checkup_type")
  facilityName         String?  @map("facility_name") @db.VarChar(100)

  // åŸºæœ¬æ¸¬å®šå€¤
  height               Decimal? @db.Decimal(4,1)
  weight               Decimal? @db.Decimal(4,1)
  bmi                  Decimal? @db.Decimal(3,1)
  waistCircumference   Decimal? @map("waist_circumference") @db.Decimal(4,1)

  // è¡€åœ§
  systolicBp           Int?     @map("systolic_bp")
  diastolicBp          Int?     @map("diastolic_bp")

  // è¦–åŠ›
  visionLeft           Decimal? @map("vision_left") @db.Decimal(2,1)
  visionRight          Decimal? @map("vision_right") @db.Decimal(2,1)

  // ç·åˆåˆ¤å®š
  overallResult        String?  @map("overall_result")
  reexaminationRequired Boolean @default(false) @map("reexamination_required")
  reexaminationItems   Json?    @map("reexamination_items")

  // ç®¡ç†æƒ…å ±
  dataSource           String   @default("csv_import") @map("data_source")
  createdBy            String?  @map("created_by") @db.VarChar(50)
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  staff                StaffMaster @relation(fields: [staffId], references: [id])
  details              HealthCheckupDetail[]

  @@map("health_checkups")
  @@index([staffId, checkupDate(sort: Desc)], name: "idx_staff_date")
  @@index([overallResult, reexaminationRequired], name: "idx_result")
}

// æ¤œæŸ»çµæœè©³ç´°
model HealthCheckupDetail {
  id           String   @id @default(cuid())
  checkupId    String   @map("checkup_id")
  category     String
  itemCode     String   @map("item_code") @db.VarChar(50)
  itemName     String   @map("item_name") @db.VarChar(100)
  value        String?  @db.VarChar(50)
  unit         String?  @db.VarChar(20)
  referenceMin Decimal? @map("reference_min") @db.Decimal(10,2)
  referenceMax Decimal? @map("reference_max") @db.Decimal(10,2)
  status       String?

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  checkup      HealthCheckup @relation(fields: [checkupId], references: [id], onDelete: Cascade)

  @@map("health_checkup_details")
  @@index([checkupId, category], name: "idx_checkup_category")
  @@index([status, itemCode], name: "idx_abnormal")
}

// ç—…æ­´ãƒ»æ—¢å¾€æ­´ç®¡ç†
model MedicalHistory {
  id                   String   @id @default(cuid())
  staffId              String   @map("staff_id")
  reportDate           DateTime @map("report_date") @db.Date
  reportType           String   @default("å®šæœŸæ›´æ–°") @map("report_type")

  // ç—…æ­´æƒ…å ±
  diseaseName          String?  @map("disease_name") @db.VarChar(200)
  icd10Code            String?  @map("icd10_code") @db.VarChar(10)
  diagnosisDate        DateTime? @map("diagnosis_date") @db.Date
  treatmentStatus      String   @default("æ²»ç™‚ä¸­") @map("treatment_status")

  // æ²»ç™‚æƒ…å ±
  medication           Json?
  medicalInstitution   String?  @map("medical_institution") @db.VarChar(100)
  attendingDoctor      String?  @map("attending_doctor") @db.VarChar(50)

  // å°±æ¥­ã¸ã®å½±éŸ¿
  workRestrictions     String?  @map("work_restrictions") @db.Text
  accommodationNeeded  Boolean  @default(false) @map("accommodation_needed")

  // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—
  nextCheckupDate      DateTime? @map("next_checkup_date") @db.Date
  notes                String?  @db.Text

  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  staff                StaffMaster @relation(fields: [staffId], references: [id])

  @@map("medical_histories")
  @@index([staffId, treatmentStatus], name: "idx_staff_status")
  @@index([nextCheckupDate], name: "idx_followup")
}

// å°±æ¥­é…æ…®ç®¡ç†
model WorkAccommodation {
  id                 String   @id @default(cuid())
  staffId            String   @map("staff_id")

  // é…æ…®å†…å®¹
  accommodationType  String   @map("accommodation_type")
  startDate          DateTime @map("start_date") @db.Date
  endDate            DateTime? @map("end_date") @db.Date
  isActive           Boolean  @default(true) @map("is_active")

  // è©³ç´°
  reason             String?  @db.VarChar(200)
  details            String?  @db.Text
  doctorOpinion      String?  @map("doctor_opinion") @db.Text

  // æ‰¿èªæƒ…å ±
  requestedBy        String?  @map("requested_by") @db.VarChar(50)
  approvedBy         String?  @map("approved_by") @db.VarChar(50)
  approvedDate       DateTime? @map("approved_date") @db.Date
  status             String   @default("ç”³è«‹ä¸­")

  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  staff              StaffMaster @relation(fields: [staffId], references: [id])

  @@map("work_accommodations")
  @@index([isActive, endDate], name: "idx_active")
  @@index([staffId, accommodationType], name: "idx_staff_accommodation")
}

// å¥åº·ã‚¤ãƒ™ãƒ³ãƒˆå±¥æ­´
model HealthEvent {
  id               String   @id @default(cuid())
  staffId          String   @map("staff_id")
  eventDate        DateTime @map("event_date")
  eventType        String   @map("event_type")

  // ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°
  title            String   @db.VarChar(200)
  description      String?  @db.Text
  relatedId        String?  @map("related_id") @db.VarChar(50)

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  actionRequired   String?  @map("action_required") @db.Text
  actionCompleted  Boolean  @default(false) @map("action_completed")
  followUpDate     DateTime? @map("follow_up_date") @db.Date

  // è¨˜éŒ²æƒ…å ±
  recordedBy       String?  @map("recorded_by") @db.VarChar(50)
  department       String?

  createdAt        DateTime @default(now()) @map("created_at")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  staff            StaffMaster @relation(fields: [staffId], references: [id])

  @@map("health_events")
  @@index([staffId, eventDate(sort: Desc)], name: "idx_staff_events")
  @@index([followUpDate, actionCompleted], name: "idx_followup_pending")
}
```

##### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
# Prismaã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
npx prisma migrate dev --name add_health_tables

# æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
npx prisma migrate deploy
```

---

#### 2. CSVä¸€æ‹¬å–è¾¼æ©Ÿèƒ½
**å„ªå…ˆåº¦**: â˜…â˜…â˜…
**æ¨å®šå·¥æ•°**: 5æ—¥

##### APIå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/health/checkups/import/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { parse } from 'csv-parse/sync';
import { prisma } from '@/lib/prisma';
import { z } from 'zod';

// CSVãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒ
const HealthCheckupCSVSchema = z.object({
  è·å“¡ID: z.string(),
  æ°å: z.string(),
  å¥è¨ºæ—¥: z.string().regex(/^\d{4}-\d{2}-\d{2}$/),
  èº«é•·: z.string().transform(Number).pipe(z.number().positive()),
  ä½“é‡: z.string().transform(Number).pipe(z.number().positive()),
  åç¸®æœŸè¡€åœ§: z.string().transform(Number).pipe(z.number().int()),
  æ‹¡å¼µæœŸè¡€åœ§: z.string().transform(Number).pipe(z.number().int()),
  // ... å…¨15ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
});

export async function POST(request: NextRequest) {
  try {
    const formData = await request.formData();
    const file = formData.get('file') as File;

    if (!file) {
      return NextResponse.json(
        { error: 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“' },
        { status: 400 }
      );
    }

    // CSVãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    const text = await file.text();
    const records = parse(text, {
      columns: true,
      skip_empty_lines: true,
      encoding: 'utf-8',
      bom: true // UTF-8 BOMå¯¾å¿œ
    });

    const results = {
      success: 0,
      failed: 0,
      errors: [] as Array<{ row: number; error: string }>
    };

    // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
    await prisma.$transaction(async (tx) => {
      for (let i = 0; i < records.length; i++) {
        try {
          // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
          const validated = HealthCheckupCSVSchema.parse(records[i]);

          // BMIè‡ªå‹•è¨ˆç®—
          const bmi = validated.ä½“é‡ / Math.pow(validated.èº«é•· / 100, 2);

          // å¥è¨ºãƒ‡ãƒ¼ã‚¿ä½œæˆ
          await tx.healthCheckup.create({
            data: {
              staffId: validated.è·å“¡ID,
              checkupDate: new Date(validated.å¥è¨ºæ—¥),
              checkupType: 'å®šæœŸ',
              height: validated.èº«é•·,
              weight: validated.ä½“é‡,
              bmi: Number(bmi.toFixed(1)),
              systolicBp: validated.åç¸®æœŸè¡€åœ§,
              diastolicBp: validated.æ‹¡å¼µæœŸè¡€åœ§,
              // ... ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
              dataSource: 'csv_import',
              createdBy: 'system'
            }
          });

          // ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
          await tx.healthEvent.create({
            data: {
              staffId: validated.è·å“¡ID,
              eventDate: new Date(),
              eventType: 'å¥åº·è¨ºæ–­å®Ÿæ–½',
              title: `${validated.å¥è¨ºæ—¥} å®šæœŸå¥åº·è¨ºæ–­`,
              department: 'ã‚·ã‚¹ãƒ†ãƒ ',
              recordedBy: 'csv_import'
            }
          });

          results.success++;
        } catch (error) {
          results.failed++;
          results.errors.push({
            row: i + 2, // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’è€ƒæ…®
            error: error instanceof Error ? error.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'
          });
        }
      }
    });

    return NextResponse.json({
      message: 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†',
      results
    });

  } catch (error) {
    console.error('CSV import error:', error);
    return NextResponse.json(
      { error: 'ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' },
      { status: 500 }
    );
  }
}
```

##### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/health/management/page.tsx` (æ—¢å­˜)

ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã®éƒ¨åˆ†ã‚’å®ŸAPIå‘¼ã³å‡ºã—ã«ç½®æ›ï¼š

```typescript
// æ—¢å­˜ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆéƒ¨åˆ†ã‚’å‰Šé™¤ã—ã€ä»¥ä¸‹ã«ç½®æ›
const [isUploading, setIsUploading] = useState(false);

const handleCSVUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
  const file = event.target.files?.[0];
  if (!file) return;

  setIsUploading(true);
  const formData = new FormData();
  formData.append('file', file);

  try {
    const response = await fetch('/api/health/checkups/import', {
      method: 'POST',
      body: formData
    });

    const result = await response.json();

    if (response.ok) {
      alert(`ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†\næˆåŠŸ: ${result.results.success}ä»¶\nå¤±æ•—: ${result.results.failed}ä»¶`);
      // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
      fetchHealthCheckups();
    } else {
      alert(`ã‚¨ãƒ©ãƒ¼: ${result.error}`);
    }
  } catch (error) {
    alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  } finally {
    setIsUploading(false);
  }
};
```

---

#### 3. å¥è¨ºãƒ‡ãƒ¼ã‚¿CRUD API
**å„ªå…ˆåº¦**: â˜…â˜…â˜…
**æ¨å®šå·¥æ•°**: 5æ—¥

##### APIå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/health/checkups/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';

// ä¸€è¦§å–å¾—
export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams;
  const staffId = searchParams.get('staffId');
  const startDate = searchParams.get('startDate');
  const endDate = searchParams.get('endDate');
  const reexamOnly = searchParams.get('reexamOnly') === 'true';

  const where: any = {};
  if (staffId) where.staffId = staffId;
  if (startDate && endDate) {
    where.checkupDate = {
      gte: new Date(startDate),
      lte: new Date(endDate)
    };
  }
  if (reexamOnly) where.reexaminationRequired = true;

  const checkups = await prisma.healthCheckup.findMany({
    where,
    include: {
      staff: {
        select: {
          name: true,
          department: true
        }
      },
      details: true
    },
    orderBy: {
      checkupDate: 'desc'
    }
  });

  return NextResponse.json(checkups);
}

// æ–°è¦ä½œæˆ
export async function POST(request: NextRequest) {
  const body = await request.json();

  const checkup = await prisma.healthCheckup.create({
    data: {
      ...body,
      dataSource: 'manual'
    }
  });

  return NextResponse.json(checkup, { status: 201 });
}
```

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/health/checkups/[id]/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';

// è©³ç´°å–å¾—
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const checkup = await prisma.healthCheckup.findUnique({
    where: { id: params.id },
    include: {
      staff: true,
      details: true
    }
  });

  if (!checkup) {
    return NextResponse.json(
      { error: 'å¥è¨ºãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' },
      { status: 404 }
    );
  }

  return NextResponse.json(checkup);
}

// æ›´æ–°
export async function PUT(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const body = await request.json();

  const checkup = await prisma.healthCheckup.update({
    where: { id: params.id },
    data: body
  });

  return NextResponse.json(checkup);
}

// å‰Šé™¤
export async function DELETE(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  await prisma.healthCheckup.delete({
    where: { id: params.id }
  });

  return NextResponse.json({ message: 'å‰Šé™¤ã—ã¾ã—ãŸ' });
}
```

##### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¿®æ­£

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/health/HealthCheckupDetailView.tsx`

ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆéƒ¨åˆ†ã‚’å®ŸAPIå‘¼ã³å‡ºã—ã«ç½®æ›ï¼š

```typescript
// æ—¢å­˜ã® generateMockHealthData() ã‚’å‰Šé™¤ã—ã€ä»¥ä¸‹ã«ç½®æ›

const [healthData, setHealthData] = useState<HealthData | null>(null);
const [loading, setLoading] = useState(true);

useEffect(() => {
  const fetchHealthData = async () => {
    try {
      setLoading(true);
      const response = await fetch(`/api/health/checkups?staffId=${staffId}`);
      const data = await response.json();

      if (data.length > 0) {
        // æœ€æ–°ã®å¥è¨ºãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
        const latest = data[0];
        setHealthData(transformToHealthData(latest));
      }
    } catch (error) {
      console.error('Failed to fetch health data:', error);
    } finally {
      setLoading(false);
    }
  };

  fetchHealthData();
}, [staffId]);

if (loading) {
  return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;
}

if (!healthData) {
  return <div>å¥è¨ºãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>;
}
```

---

#### 4. çµæœé…ä¿¡ã‚·ã‚¹ãƒ†ãƒ 
**å„ªå…ˆåº¦**: â˜…â˜…â˜…
**æ¨å®šå·¥æ•°**: 7æ—¥

##### ãŠçŸ¥ã‚‰ã›é…ä¿¡ã‚«ãƒ†ã‚´ãƒªæ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `prisma/schema.prisma` (æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ )

```prisma
// notifications ãƒ†ãƒ¼ãƒ–ãƒ«ã« category è¿½åŠ 
model Notification {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  category String @default("general") // 'general', 'health_checkup', 'stress_check'
  isConfidential Boolean @default(false) @map("is_confidential") // æ©Ÿå¯†æ€§ãƒ•ãƒ©ã‚°
  expiryDate DateTime? @map("expiry_date") @db.Date // é–²è¦§æœŸé™
  accessToken String? @unique @map("access_token") // ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹ç”¨ãƒˆãƒ¼ã‚¯ãƒ³
}
```

##### APIå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/notifications/health/send/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import { generateAccessToken, encryptHealthData } from '@/lib/security';

export async function POST(request: NextRequest) {
  const body = await request.json();
  const { checkupIds, templateType, expiryDays = 30 } = body;

  const results = [];

  for (const checkupId of checkupIds) {
    // å¥è¨ºãƒ‡ãƒ¼ã‚¿å–å¾—
    const checkup = await prisma.healthCheckup.findUnique({
      where: { id: checkupId },
      include: { staff: true }
    });

    if (!checkup) continue;

    // ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆï¼ˆã‚»ã‚­ãƒ¥ã‚¢ãƒªãƒ³ã‚¯ç”¨ï¼‰
    const accessToken = generateAccessToken();
    const expiryDate = new Date();
    expiryDate.setDate(expiryDate.getDate() + expiryDays);

    // é€šçŸ¥ä½œæˆ
    const notification = await prisma.notification.create({
      data: {
        type: 'individual',
        category: 'health_checkup',
        title: 'ã€é‡è¦ã€‘å¥åº·è¨ºæ–­çµæœã®ãŠçŸ¥ã‚‰ã›',
        content: generateHealthResultMessage(checkup, accessToken, expiryDate),
        targetStaffIds: [checkup.staffId],
        isConfidential: true,
        accessToken,
        expiryDate,
        createdBy: 'health_system',
        department: 'å¥è¨ºå®¤'
      }
    });

    // ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
    await prisma.healthEvent.create({
      data: {
        staffId: checkup.staffId,
        eventDate: new Date(),
        eventType: 'çµæœé€šçŸ¥',
        title: 'å¥åº·è¨ºæ–­çµæœé€šçŸ¥é€ä¿¡',
        relatedId: notification.id,
        department: 'ã‚·ã‚¹ãƒ†ãƒ '
      }
    });

    results.push({ checkupId, notificationId: notification.id });
  }

  return NextResponse.json({
    message: `${results.length}ä»¶ã®é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ`,
    results
  });
}

function generateHealthResultMessage(checkup: any, token: string, expiry: Date): string {
  return `
${checkup.staff.name} æ§˜

${checkup.checkupDate.toLocaleDateString()}ã«å®Ÿæ–½ã•ã‚ŒãŸå¥åº·è¨ºæ–­ã®çµæœã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚

â– ç·åˆåˆ¤å®š: ${checkup.overallResult}
${checkup.reexaminationRequired ? 'âš ï¸ å†æ¤œæŸ»ãŒå¿…è¦ã§ã™' : 'âœ“ ç•°å¸¸ãªã—'}

è©³ç´°ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã”ç¢ºèªãã ã•ã„ã€‚
${process.env.NEXT_PUBLIC_BASE_URL}/health/secure/${token}

â€»ã“ã®ãƒªãƒ³ã‚¯ã¯${expiry.toLocaleDateString()}ã¾ã§æœ‰åŠ¹ã§ã™ã€‚
â€»çµæœã®é–²è¦§ã«ã¯èªè¨¼ãŒå¿…è¦ã§ã™ã€‚
  `.trim();
}
```

##### ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹ãƒšãƒ¼ã‚¸

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/health/secure/[token]/page.tsx` (æ–°è¦ä½œæˆ)

```typescript
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import HealthCheckupDetailView from '@/components/health/HealthCheckupDetailView';

export default function SecureHealthResultPage() {
  const params = useParams();
  const token = params.token as string;
  const [isValid, setIsValid] = useState(false);
  const [staffId, setStaffId] = useState<string | null>(null);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const verifyToken = async () => {
      try {
        const response = await fetch(`/api/health/secure/verify`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token })
        });

        if (response.ok) {
          const data = await response.json();
          setStaffId(data.staffId);
          setIsValid(true);
        } else {
          setError('ãƒªãƒ³ã‚¯ãŒç„¡åŠ¹ã¾ãŸã¯æœŸé™åˆ‡ã‚Œã§ã™');
        }
      } catch (err) {
        setError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    };

    verifyToken();
  }, [token]);

  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="text-center">
          <p className="text-red-600 text-lg">{error}</p>
          <p className="text-gray-600 mt-2">å¥è¨ºå®¤ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„</p>
        </div>
      </div>
    );
  }

  if (!isValid || !staffId) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-6xl mx-auto">
        <div className="mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <p className="text-yellow-800 text-sm">
            ğŸ”’ ã“ã®æƒ…å ±ã¯æ©Ÿå¯†æ€§ãŒé«˜ã„å€‹äººæƒ…å ±ã§ã™ã€‚ä»–äººã«å…±æœ‰ã—ãªã„ã§ãã ã•ã„ã€‚
          </p>
        </div>
        <HealthCheckupDetailView staffId={staffId} showHeader={false} />
      </div>
    </div>
  );
}
```

---

#### 5. åŸºæœ¬æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
**å„ªå…ˆåº¦**: â˜…â˜…â˜…
**æ¨å®šå·¥æ•°**: 3æ—¥

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/health/management/page.tsx` (æ—¢å­˜)

æ—¢å­˜ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼UIã‚’å®ŸAPIã«æ¥ç¶šï¼š

```typescript
const [filters, setFilters] = useState({
  department: 'all',
  reexamOnly: false,
  dateRange: { start: '', end: '' }
});

const fetchHealthCheckups = async () => {
  const params = new URLSearchParams();
  if (filters.department !== 'all') params.append('department', filters.department);
  if (filters.reexamOnly) params.append('reexamOnly', 'true');
  if (filters.dateRange.start) params.append('startDate', filters.dateRange.start);
  if (filters.dateRange.end) params.append('endDate', filters.dateRange.end);

  const response = await fetch(`/api/health/checkups?${params}`);
  const data = await response.json();
  setCheckups(data);
};

useEffect(() => {
  fetchHealthCheckups();
}, [filters]);
```

---

### Phase 2: åŸºæœ¬æ©Ÿèƒ½ï¼ˆæ¨å®š3ãƒ¶æœˆï¼‰

#### 6. ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
**å„ªå…ˆåº¦**: â˜…â˜…â˜…
**æ¨å®šå·¥æ•°**: 1é€±é–“

##### å®Ÿè£…å†…å®¹
- å¥è¨ºå®Ÿæ–½ç‡ã‚°ãƒ©ãƒ•
- è¦å†æ¤œæŸ»è€…ãƒªã‚¹ãƒˆ
- éƒ¨ç½²åˆ¥çµ±è¨ˆ
- æœŸé™åˆ‡ã‚Œã‚¢ãƒ©ãƒ¼ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/health/dashboard/page.tsx` (æ–°è¦ä½œæˆ)

```typescript
'use client';

import { useEffect, useState } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend } from 'recharts';

export default function HealthDashboard() {
  const [stats, setStats] = useState<any>(null);

  useEffect(() => {
    const fetchStats = async () => {
      const response = await fetch('/api/analytics/health/summary');
      const data = await response.json();
      setStats(data);
    };

    fetchStats();
  }, []);

  if (!stats) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;

  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-6">å¥åº·ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>

      {/* å®Ÿæ–½ç‡ */}
      <div className="bg-white rounded-lg shadow p-6 mb-6">
        <h2 className="text-lg font-semibold mb-4">å¥è¨ºå®Ÿæ–½ç‡</h2>
        <div className="text-4xl font-bold text-blue-600">
          {stats.implementationRate}%
        </div>
        <p className="text-gray-600 mt-2">
          {stats.completed} / {stats.total} å
        </p>
      </div>

      {/* è¦å†æ¤œæŸ»è€… */}
      <div className="bg-white rounded-lg shadow p-6 mb-6">
        <h2 className="text-lg font-semibold mb-4">è¦å†æ¤œæŸ»è€…</h2>
        <div className="text-4xl font-bold text-red-600">
          {stats.reexaminationRequired} å
        </div>
      </div>

      {/* éƒ¨ç½²åˆ¥ã‚°ãƒ©ãƒ• */}
      <div className="bg-white rounded-lg shadow p-6">
        <h2 className="text-lg font-semibold mb-4">éƒ¨ç½²åˆ¥å®Ÿæ–½çŠ¶æ³</h2>
        <BarChart width={800} height={400} data={stats.byDepartment}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="department" />
          <YAxis />
          <Tooltip />
          <Legend />
          <Bar dataKey="completed" fill="#3b82f6" name="å®Ÿæ–½æ¸ˆ" />
          <Bar dataKey="pending" fill="#ef4444" name="æœªå®Ÿæ–½" />
        </BarChart>
      </div>
    </div>
  );
}
```

**API**: `src/app/api/analytics/health/summary/route.ts`

```typescript
export async function GET() {
  const total = await prisma.staffMaster.count({ where: { status: 'åœ¨è·' } });
  const completed = await prisma.healthCheckup.count({
    where: {
      checkupDate: {
        gte: new Date(new Date().getFullYear(), 0, 1) // ä»Šå¹´åº¦
      }
    }
  });

  const reexaminationRequired = await prisma.healthCheckup.count({
    where: {
      reexaminationRequired: true,
      // å†æ¤œæŸ»æœªå®Ÿæ–½ã®æ¡ä»¶
    }
  });

  // éƒ¨ç½²åˆ¥é›†è¨ˆ
  const byDepartment = await prisma.$queryRaw`
    SELECT
      s.department,
      COUNT(DISTINCT s.id) as total,
      COUNT(DISTINCT h.staff_id) as completed
    FROM staff_master s
    LEFT JOIN health_checkups h ON s.id = h.staff_id
      AND YEAR(h.checkup_date) = YEAR(NOW())
    WHERE s.status = 'åœ¨è·'
    GROUP BY s.department
  `;

  return NextResponse.json({
    total,
    completed,
    implementationRate: Math.round((completed / total) * 100),
    reexaminationRequired,
    byDepartment
  });
}
```

---

#### 7. ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯é…ä¿¡
**å„ªå…ˆåº¦**: â˜…â˜…â˜…
**æ¨å®šå·¥æ•°**: 2é€±é–“

##### å®Ÿè£…å†…å®¹
- æ©Ÿå¯†æ€§ã®é«˜ã„å€‹åˆ¥é…ä¿¡
- æœ¬äººã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ç”£æ¥­åŒ»é¢è«‡æ¡ˆå†…ï¼ˆé«˜ã‚¹ãƒˆãƒ¬ã‚¹è€…ã®ã¿ï¼‰
- é›†å›£åˆ†æï¼ˆ10åä»¥ä¸Šã®éƒ¨ç½²ã®ã¿ï¼‰

**é‡è¦**: åŠ´åƒå®‰å…¨è¡›ç”Ÿæ³•ç¬¬66æ¡ã®10ã«åŸºã¥ãå³æ ¼ãªæ©Ÿå¯†ç®¡ç†ãŒå¿…è¦

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/notifications/stress-check/send/route.ts`

```typescript
export async function POST(request: NextRequest) {
  const body = await request.json();
  const { stressCheckResults } = body; // [{staffId, score, isHighRisk}]

  for (const result of stressCheckResults) {
    const accessToken = generateSecureToken();

    await prisma.notification.create({
      data: {
        type: 'individual',
        category: 'stress_check',
        title: 'ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿæ–½çµæœã«ã¤ã„ã¦',
        content: generateStressCheckMessage(result, accessToken),
        targetStaffIds: [result.staffId],
        isConfidential: true, // æœ€é«˜æ©Ÿå¯†
        accessToken,
        expiryDate: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), // 90æ—¥
        // ç®¡ç†è€…ãƒ»ä¸Šå¸ã«ã¯éå…¬é–‹
        excludeManagement: true
      }
    });

    // é«˜ã‚¹ãƒˆãƒ¬ã‚¹è€…ã¸ã®é¢è«‡æ¡ˆå†…
    if (result.isHighRisk) {
      await prisma.notification.create({
        data: {
          type: 'individual',
          category: 'stress_check',
          title: 'ç”£æ¥­åŒ»é¢è«‡ã®ã”æ¡ˆå†…ï¼ˆä»»æ„ï¼‰',
          content: 'é«˜ã‚¹ãƒˆãƒ¬ã‚¹ã¨åˆ¤å®šã•ã‚Œã¾ã—ãŸã€‚ã”å¸Œæœ›ã®æ–¹ã¯ç”£æ¥­åŒ»é¢è«‡ã‚’å®Ÿæ–½ã§ãã¾ã™...',
          targetStaffIds: [result.staffId],
          isConfidential: true
        }
      });
    }
  }

  return NextResponse.json({ message: 'é…ä¿¡å®Œäº†' });
}
```

---

#### 8-10. ãã®ä»–Phase 2æ©Ÿèƒ½
- **8. ãƒªãƒã‚¤ãƒ³ãƒ‰æ©Ÿèƒ½**: æœªç¢ºèªè€…ã¸ã®3æ—¥å¾Œè‡ªå‹•ãƒªãƒã‚¤ãƒ³ãƒ‰
- **9. ç—…æ­´ç®¡ç†**: `medical_histories` ãƒ†ãƒ¼ãƒ–ãƒ«ã®CRUDå®Ÿè£…
- **10. å°±æ¥­é…æ…®è¨­å®š**: `work_accommodations` ãƒ†ãƒ¼ãƒ–ãƒ«ã®CRUDå®Ÿè£…

è©³ç´°ã¯ `docs/å¥åº·é–¢é€£æƒ…å ±å®Ÿè£…è¨ˆç”»æ›¸_çµ±åˆç‰ˆ.md` å‚ç…§

---

### Phase 3: æ‹¡å¼µæ©Ÿèƒ½ï¼ˆæ¨å®š6ãƒ¶æœˆï¼‰

#### 11. ç”£æ¥­åŒ»æ©Ÿèƒ½
- é¢è«‡è¨˜éŒ²å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
- å°±æ¥­åˆ¤å®šï¼ˆé€šå¸¸å‹¤å‹™/è¦è¦³å¯Ÿ/è¦ç²¾å¯†æ¤œæŸ»/å°±æ¥­åˆ¶é™ï¼‰
- åŒ»å­¦çš„æ‰€è¦‹è¨˜éŒ²

#### 12-13. çµ±è¨ˆãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- éƒ¨ç½²åˆ¥ãƒ»å¹´é½¢åˆ¥ãƒ»æ€§åˆ¥åˆ†æ
- çµŒå¹´å¤‰åŒ–ã‚°ãƒ©ãƒ•ï¼ˆä½“é‡ã€è¡€åœ§ã€BMIç­‰ï¼‰
- ç•°å¸¸å€¤äºˆæ¸¬ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

#### 14. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- åŠ´åƒåŸºæº–ç›£ç£ç½²æå‡ºç”¨æ›¸é¡è‡ªå‹•ä½œæˆ
- å¥è¨ºçµæœå ±å‘Šæ›¸PDFç”Ÿæˆ

#### 15. ã‚·ã‚¹ãƒ†ãƒ é€£æº
- å‹¤æ€ ãƒ‡ãƒ¼ã‚¿ã¨ã®é€£æºï¼ˆæ®‹æ¥­æ™‚é–“ã¨å¥åº·çŠ¶æ…‹ã®ç›¸é–¢åˆ†æï¼‰
- ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº
- VoiceDrive AI ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ

---

## ğŸ”„ ä½œæ¥­å†é–‹æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ç’°å¢ƒç¢ºèªï¼ˆ1æ—¥ï¼‰

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªæœ€æ–°åŒ–
git checkout main
git pull origin main

# 2. ä¾å­˜é–¢ä¿‚æ›´æ–°
npm install

# 3. ç’°å¢ƒå¤‰æ•°ç¢ºèª
cat .env
# DATABASE_URL ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

# 4. Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ
npx prisma generate

# 5. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèª
npm run dev
```

### ã‚¹ãƒ†ãƒƒãƒ—2: DBæ§‹ç¯‰ï¼ˆ5æ—¥ï¼‰

```bash
# 1. Prismaã‚¹ã‚­ãƒ¼ãƒã«å¥åº·é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
# prisma/schema.prisma ã‚’ç·¨é›†ï¼ˆä¸Šè¨˜å‚ç…§ï¼‰

# 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
npx prisma migrate dev --name add_health_tables

# 3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
npx prisma studio
# 5ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

# 4. åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
npx prisma db seed
```

### ã‚¹ãƒ†ãƒƒãƒ—3: CSVå–è¾¼å®Ÿè£…ï¼ˆ5æ—¥ï¼‰

```bash
# 1. APIãƒ«ãƒ¼ãƒˆä½œæˆ
mkdir -p src/app/api/health/checkups/import
touch src/app/api/health/checkups/import/route.ts

# 2. å®Ÿè£…ï¼ˆä¸Šè¨˜ã‚³ãƒ¼ãƒ‰å‚ç…§ï¼‰

# 3. ãƒ†ã‚¹ãƒˆ
curl -X POST http://localhost:3000/api/health/checkups/import \
  -F "file=@test-data.csv"

# 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ¥ç¶š
# src/app/health/management/page.tsx ã‚’ä¿®æ­£
```

### ã‚¹ãƒ†ãƒƒãƒ—4: CRUD APIå®Ÿè£…ï¼ˆ5æ—¥ï¼‰

```bash
# 1. ä¸€è¦§ãƒ»ä½œæˆAPI
touch src/app/api/health/checkups/route.ts

# 2. è©³ç´°ãƒ»æ›´æ–°ãƒ»å‰Šé™¤API
mkdir src/app/api/health/checkups/[id]
touch src/app/api/health/checkups/[id]/route.ts

# 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ¥ç¶š
# src/components/health/HealthCheckupDetailView.tsx ã‚’ä¿®æ­£
```

### ã‚¹ãƒ†ãƒƒãƒ—5: çµæœé…ä¿¡å®Ÿè£…ï¼ˆ7æ—¥ï¼‰

```bash
# 1. é€šçŸ¥APIæ‹¡å¼µ
touch src/app/api/notifications/health/send/route.ts

# 2. ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹ãƒšãƒ¼ã‚¸
mkdir -p src/app/health/secure/[token]
touch src/app/health/secure/[token]/page.tsx

# 3. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼API
touch src/app/api/health/secure/verify/route.ts

# 4. çµ±åˆãƒ†ã‚¹ãƒˆ
```

### ã‚¹ãƒ†ãƒƒãƒ—6: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ3æ—¥ï¼‰

```bash
# 1. E2Eãƒ†ã‚¹ãƒˆ
npm run test:e2e

# 2. CSVå–è¾¼ãƒ†ã‚¹ãƒˆ
npm run test:csv-import

# 3. é€šçŸ¥é…ä¿¡ãƒ†ã‚¹ãƒˆ
npm run test:notifications

# 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
npm run test:security
```

### ã‚¹ãƒ†ãƒƒãƒ—7: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ2æ—¥ï¼‰

```bash
# 1. æœ¬ç•ªç’°å¢ƒãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npx prisma migrate deploy

# 2. ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run build

# 3. ãƒ‡ãƒ—ãƒ­ã‚¤
vercel --prod

# 4. æœ¬ç•ªç’°å¢ƒå‹•ä½œç¢ºèª
```

---

## ğŸ“Š é€²æ—ç®¡ç†

### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### Phase 1 MVPï¼ˆ30æ—¥ï¼‰
- [ ] DBè¨­è¨ˆãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒè¿½åŠ 
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] CSVå–è¾¼APIå®Ÿè£…
- [ ] CSVå–è¾¼ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- [ ] ä¸€è¦§å–å¾—APIå®Ÿè£…
- [ ] è©³ç´°å–å¾—APIå®Ÿè£…
- [ ] ä½œæˆAPIå®Ÿè£…
- [ ] æ›´æ–°APIå®Ÿè£…
- [ ] å‰Šé™¤APIå®Ÿè£…
- [ ] HealthCheckupDetailView APIæ¥ç¶š
- [ ] å¥è¨ºçµæœé…ä¿¡APIå®Ÿè£…
- [ ] ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹ãƒšãƒ¼ã‚¸å®Ÿè£…
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼APIå®Ÿè£…
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
- [ ] æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

#### Phase 2 åŸºæœ¬æ©Ÿèƒ½ï¼ˆ3ãƒ¶æœˆï¼‰
- [ ] ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰APIå®Ÿè£…
- [ ] ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰UIå®Ÿè£…
- [ ] ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯é…ä¿¡APIå®Ÿè£…
- [ ] ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯ã‚»ã‚­ãƒ¥ã‚¢ãƒšãƒ¼ã‚¸å®Ÿè£…
- [ ] ãƒªãƒã‚¤ãƒ³ãƒ‰æ©Ÿèƒ½å®Ÿè£…
- [ ] ç—…æ­´ç®¡ç†CRUDå®Ÿè£…
- [ ] å°±æ¥­é…æ…®ç®¡ç†CRUDå®Ÿè£…

#### Phase 3 æ‹¡å¼µæ©Ÿèƒ½ï¼ˆ6ãƒ¶æœˆï¼‰
- [ ] ç”£æ¥­åŒ»æ©Ÿèƒ½å®Ÿè£…
- [ ] çµ±è¨ˆåˆ†æAPIå®Ÿè£…
- [ ] ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æå®Ÿè£…
- [ ] ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ©Ÿèƒ½å®Ÿè£…
- [ ] å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºå®Ÿè£…

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [å¥åº·é–¢é€£æƒ…å ±å®Ÿè£…è¨ˆç”»æ›¸ï¼ˆçµ±åˆç‰ˆï¼‰](./å¥åº·é–¢é€£æƒ…å ±å®Ÿè£…è¨ˆç”»æ›¸_çµ±åˆç‰ˆ.md) - è©³ç´°ä»•æ§˜
- [é–‹ç™ºãƒ¡ãƒ¢](../src/app/admin/dev-notes/page.tsx) - æ—¥ã€…ã®ä½œæ¥­è¨˜éŒ²
- [Phase3å®Ÿè£…ä½œæ¥­å®Œäº†å ±å‘Šæ›¸](./Phase3_å®Ÿè£…ä½œæ¥­å®Œäº†å ±å‘Šæ›¸_FINAL.md) - æ–½è¨­åˆ¥æ¨©é™ç®¡ç†ã®å®Œäº†å ±å‘Š

---

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
1. **å¥åº·æƒ…å ±ã¯è¦é…æ…®å€‹äººæƒ…å ±** - æœ€é«˜ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–å¿…é ˆ
2. **ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯çµæœ** - å®Ÿæ–½è€…ï¼ˆç”£æ¥­åŒ»ï¼‰ä»¥å¤–ã¯é–²è¦§ä¸å¯
3. **ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°** - å…¨ã¦ã®é–²è¦§ãƒ»æ›´æ–°ã‚’ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²
4. **ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–** - DBä¿å­˜æ™‚ã¯AES-256ã§æš—å·åŒ–

### æ³•ä»¤éµå®ˆ
1. **åŠ´åƒå®‰å…¨è¡›ç”Ÿæ³•** - å¹´1å›å®Ÿæ–½ã€5å¹´é–“ä¿ç®¡
2. **å€‹äººæƒ…å ±ä¿è­·æ³•** - ç›®çš„å¤–åˆ©ç”¨ç¦æ­¢ã€ç¬¬ä¸‰è€…æä¾›åˆ¶é™
3. **ã‚¹ãƒˆãƒ¬ã‚¹ãƒã‚§ãƒƒã‚¯åˆ¶åº¦** - æœ¬äººåŒæ„ãªã—ã®äº‹æ¥­è€…æä¾›ç¦æ­¢

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
1. **å¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ** - 1,250åÃ—éå»5å¹´åˆ† = 6,250ä»¶ä»¥ä¸Š
2. **CSVå–è¾¼** - 1,000ä»¶ã‚’30ç§’ä»¥å†…ã§å‡¦ç†
3. **æ¤œç´¢ãƒ¬ã‚¹ãƒãƒ³ã‚¹** - 500msä»¥å†…

---

## ğŸ“ å•ã„åˆã‚ã›å…ˆ

### æŠ€è¡“çš„è³ªå•
- VoiceDriveãƒãƒ¼ãƒ ï¼ˆ`mcp-shared/` çµŒç”±ã§é€£æºï¼‰
- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…

### æ¥­å‹™çš„è³ªå•
- å¥è¨ºå®¤é•·
- ç”£æ¥­ä¿å¥å¸«

### æ³•ä»¤ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹
- äººäº‹éƒ¨é•·
- ç”£æ¥­åŒ»

---

**æ–‡æ›¸æƒ…å ±**
- ä½œæˆæ—¥: 2025å¹´9æœˆ30æ—¥
- æœ€çµ‚æ›´æ–°: 2025å¹´9æœˆ30æ—¥
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0
- å¯¾è±¡è€…: é–‹ç™ºè€…ã€VoiceDriveãƒãƒ¼ãƒ 
- æ©Ÿå¯†ãƒ¬ãƒ™ãƒ«: ç¤¾å†…é™å®š

---

ä»¥ä¸Š