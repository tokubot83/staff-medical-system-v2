# 面談サマリ閲覧UI 実装依頼書

**作成日**: 2025年10月2日
**送信元**: 医療システムチーム（Claude Code）
**宛先**: VoiceDriveチーム
**件名**: 職員向け面談サマリ閲覧UI実装のお願い

---

## 📋 依頼概要

面談サマリ送受信機能の統合テストが完全成功したことを受け、**VoiceDrive側での職員向け面談サマリ閲覧UI**の実装をお願いします。

### 背景
- ✅ 医療システム側: 面談サマリ送信機能実装済み
- ✅ VoiceDrive側: 面談サマリ受信・保存機能実装済み
- ✅ 統合テスト: 完全成功（データ整合性100%）
- ❌ **未実装**: 職員がVoiceDriveアプリで面談サマリを閲覧するUI

---

## 🎯 実装目的

### 職員の利便性向上
- 面談後、VoiceDriveアプリで面談サマリを確認できる
- いつでも過去の面談履歴を振り返ることができる
- フォローアップが必要な面談を把握できる

### 透明性の確保
- 人事部からのフィードバックを明確に共有
- 面談内容の記録を職員自身が確認可能
- 次回面談の推奨事項を事前に確認

---

## 📊 送信データ仕様（再掲）

### 医療システムから送信されるデータ

```typescript
interface InterviewResultData {
  // 識別情報
  requestId: string;              // VoiceDrive側の申込ID
  interviewId: string;            // 医療システム側の面談ID

  // 実施情報
  completedAt: Date;              // 面談実施日時
  duration: number;               // 実施時間（分）

  // 面談内容
  summary: string;                // 面談サマリ（主な内容）
  keyPoints: string[];            // 重要ポイント（配列）
  actionItems: Array<{            // アクションアイテム
    description: string;
    dueDate?: Date;
  }>;

  // フォローアップ情報
  followUpRequired: boolean;      // フォローアップ要否
  followUpDate?: Date;            // フォローアップ予定日

  // 職員フィードバック
  feedbackToEmployee: string;     // 職員向けフィードバック文

  // 次回推奨事項
  nextRecommendations: {
    suggestedNextInterview?: Date;  // 次回面談推奨日
    suggestedTopics: string[];      // 推奨トピック
  };
}
```

### VoiceDrive側データベース（既存）

**テーブル**: `InterviewResult`

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | String | 内部管理用ID |
| requestId | String (Unique) | VoiceDrive申込ID |
| interviewId | String (Unique) | 医療システム面談ID |
| completedAt | DateTime | 面談実施日時 |
| duration | Int | 実施時間（分） |
| summary | String | 面談サマリ |
| keyPoints | Json | 重要ポイント（配列） |
| actionItems | Json | アクションアイテム |
| followUpRequired | Boolean | フォローアップ要否 |
| followUpDate | DateTime? | フォローアップ予定日 |
| feedbackToEmployee | String | 職員向けフィードバック |
| nextRecommendations | Json | 次回推奨情報 |
| receivedAt | DateTime | 受信日時 |
| status | String | 状態（received/processed） |

---

## 🎨 UI実装提案

### 1. 面談サマリ一覧画面

**画面名**: 「面談履歴・サマリ」または「My面談記録」

**表示内容**:
```
┌─────────────────────────────────────────┐
│  面談履歴・サマリ                       │
├─────────────────────────────────────────┤
│                                         │
│  📅 2025年10月2日 実施                  │
│  ⏱️  45分                               │
│  📝 定期面談                            │
│  ✅ 完了                                │
│  ────────────────────────────────────   │
│  【サマリ】                             │
│  面談サマリの要約文（最初の100文字...） │
│  ────────────────────────────────────   │
│  💡 フォローアップ: 2025年11月1日       │
│                                         │
│  [詳細を見る] ボタン                    │
│                                         │
├─────────────────────────────────────────┤
│  📅 2025年9月15日 実施                  │
│  ⏱️  30分                               │
│  ...                                    │
└─────────────────────────────────────────┘
```

**実装要素**:
- 面談日時（completedAt）
- 実施時間（duration）
- サマリ要約（summaryの最初100文字）
- フォローアップ予定（followUpRequired, followUpDate）
- 詳細表示ボタン

### 2. 面談サマリ詳細画面

**画面名**: 「面談サマリ詳細」

**表示内容**:
```
┌─────────────────────────────────────────┐
│  ← 戻る    面談サマリ詳細               │
├─────────────────────────────────────────┤
│                                         │
│  📅 面談日時                            │
│  2025年10月2日 10:00 実施               │
│  実施時間: 45分                         │
│                                         │
│  ────────────────────────────────────   │
│                                         │
│  📝 面談サマリ                          │
│  {summary}                              │
│  統合テスト用の面談サマリです。         │
│  職員の状況は良好で、業務遂行能力も     │
│  向上しています。                       │
│                                         │
│  ────────────────────────────────────   │
│                                         │
│  🔑 重要ポイント                        │
│  • {keyPoints[0]}                       │
│    業務遂行能力の向上                   │
│  • {keyPoints[1]}                       │
│    コミュニケーション能力の向上         │
│                                         │
│  ────────────────────────────────────   │
│                                         │
│  ✅ アクションアイテム                  │
│  □ {actionItems[0].description}         │
│    キャリアプラン作成                   │
│    期限: 2025年10月9日                  │
│                                         │
│  ────────────────────────────────────   │
│                                         │
│  💬 フィードバック                      │
│  {feedbackToEmployee}                   │
│  テストフィードバック: 良好な状態です   │
│                                         │
│  ────────────────────────────────────   │
│                                         │
│  💡 フォローアップ                      │
│  必要: あり                             │
│  予定日: 2025年11月1日                  │
│                                         │
│  ────────────────────────────────────   │
│                                         │
│  🎯 次回面談の推奨                      │
│  推奨日: 2026年1月1日                   │
│  推奨トピック:                          │
│  • キャリア開発                         │
│  • スキルアップ                         │
│                                         │
└─────────────────────────────────────────┘
```

**実装要素**:
- **面談日時**: completedAt（日時フォーマット）、duration
- **面談サマリ**: summary（全文表示）
- **重要ポイント**: keyPoints（箇条書き）
- **アクションアイテム**: actionItems（チェックボックス、期限付き）
- **フィードバック**: feedbackToEmployee
- **フォローアップ**: followUpRequired, followUpDate
- **次回推奨**: nextRecommendations.suggestedNextInterview, suggestedTopics

### 3. フォローアップ通知機能（オプション）

**機能**: フォローアップ予定日が近づいたら通知

**実装例**:
```
┌─────────────────────────────────────────┐
│  🔔 通知                                │
├─────────────────────────────────────────┤
│  💡 フォローアップ面談のお知らせ        │
│                                         │
│  2025年10月2日実施の面談について、      │
│  フォローアップ予定日（11月1日）が      │
│  近づいています。                       │
│                                         │
│  [詳細を見る] [面談予約]                │
└─────────────────────────────────────────┘
```

---

## 🔧 実装技術仕様

### API設計提案

#### 1. 職員の面談サマリ一覧取得

**エンドポイント**: `GET /api/my/interview-results`

**リクエスト**:
```typescript
Headers:
  Authorization: Bearer {USER_TOKEN}
```

**レスポンス**:
```json
{
  "success": true,
  "data": [
    {
      "id": "cmg8sbpnb0000s5dg38txzvms",
      "interviewId": "test-int-001",
      "completedAt": "2025-10-02T10:00:00.000Z",
      "duration": 45,
      "summary": "面談サマリの内容...",
      "summaryPreview": "面談サマリの内容...（最初100文字）",
      "followUpRequired": true,
      "followUpDate": "2025-11-01T00:00:00.000Z",
      "receivedAt": "2025-10-02T03:01:54.602Z"
    },
    // ...
  ],
  "count": 5
}
```

**実装コード例**:
```typescript
// VoiceDrive側 API実装例
app.get('/api/my/interview-results', authenticateUser, async (req, res) => {
  const userId = req.user.id; // ログイン中のユーザーID

  // ユーザーの職員IDを取得
  const employee = await prisma.user.findUnique({
    where: { id: userId },
    select: { employeeId: true }
  });

  // 該当職員のrequestIdを取得（Interview申込から）
  const requests = await prisma.interview.findMany({
    where: { employeeId: employee.employeeId },
    select: { id: true }
  });

  const requestIds = requests.map(r => r.id);

  // requestIdに紐づく面談サマリを取得
  const results = await prisma.interviewResult.findMany({
    where: {
      requestId: { in: requestIds }
    },
    orderBy: { completedAt: 'desc' }
  });

  // サマリプレビュー生成
  const data = results.map(r => ({
    ...r,
    summaryPreview: r.summary.substring(0, 100) + (r.summary.length > 100 ? '...' : '')
  }));

  res.json({
    success: true,
    data,
    count: data.length
  });
});
```

#### 2. 面談サマリ詳細取得

**エンドポイント**: `GET /api/my/interview-results/:interviewId`

**リクエスト**:
```typescript
Headers:
  Authorization: Bearer {USER_TOKEN}

Params:
  interviewId: string
```

**レスポンス**:
```json
{
  "success": true,
  "data": {
    "id": "cmg8sbpnb0000s5dg38txzvms",
    "interviewId": "test-int-001",
    "completedAt": "2025-10-02T10:00:00.000Z",
    "duration": 45,
    "summary": "統合テスト用の面談サマリです。職員の状況は良好で、業務遂行能力も向上しています。",
    "keyPoints": [
      "業務遂行能力の向上",
      "コミュニケーション能力の向上"
    ],
    "actionItems": [
      {
        "description": "キャリアプラン作成",
        "dueDate": "2025-10-09T00:00:00.000Z"
      }
    ],
    "followUpRequired": true,
    "followUpDate": "2025-11-01T00:00:00.000Z",
    "feedbackToEmployee": "良好な状態です",
    "nextRecommendations": {
      "suggestedNextInterview": "2026-01-01T00:00:00.000Z",
      "suggestedTopics": ["キャリア開発", "スキルアップ"]
    },
    "receivedAt": "2025-10-02T03:01:54.602Z"
  }
}
```

**実装コード例**:
```typescript
app.get('/api/my/interview-results/:interviewId', authenticateUser, async (req, res) => {
  const userId = req.user.id;
  const { interviewId } = req.params;

  // ユーザーの職員IDを取得
  const employee = await prisma.user.findUnique({
    where: { id: userId },
    select: { employeeId: true }
  });

  // 該当面談サマリを取得
  const result = await prisma.interviewResult.findUnique({
    where: { interviewId }
  });

  if (!result) {
    return res.status(404).json({
      success: false,
      error: 'Interview result not found'
    });
  }

  // 該当職員のデータか確認（セキュリティ）
  const request = await prisma.interview.findUnique({
    where: { id: result.requestId }
  });

  if (request.employeeId !== employee.employeeId) {
    return res.status(403).json({
      success: false,
      error: 'Forbidden'
    });
  }

  res.json({
    success: true,
    data: result
  });
});
```

---

## 🎨 UI/UXデザイン提案

### デザインガイドライン

**1. カラースキーム**
- **プライマリ**: #3b82f6（青）- 面談関連
- **セカンダリ**: #10b981（緑）- フォローアップ
- **アクセント**: #f59e0b（オレンジ）- アクションアイテム
- **背景**: #f3f4f6（グレー）

**2. アイコン使用**
- 📅 面談日時
- ⏱️ 実施時間
- 📝 サマリ
- 🔑 重要ポイント
- ✅ アクションアイテム
- 💬 フィードバック
- 💡 フォローアップ
- 🎯 次回推奨

**3. レスポンシブ対応**
- モバイル優先設計
- タブレット・PC対応
- スマホでの閲覧性重視

### サンプルコンポーネント構成

```typescript
// React/React Nativeコンポーネント例
import React from 'react';

interface InterviewResultDetailProps {
  interviewId: string;
}

export const InterviewResultDetail: React.FC<InterviewResultDetailProps> = ({ interviewId }) => {
  const [result, setResult] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch(`/api/my/interview-results/${interviewId}`, {
      headers: {
        'Authorization': `Bearer ${userToken}`
      }
    })
      .then(res => res.json())
      .then(data => {
        setResult(data.data);
        setLoading(false);
      });
  }, [interviewId]);

  if (loading) return <Loading />;
  if (!result) return <NotFound />;

  return (
    <div className="interview-result-detail">
      {/* 面談日時 */}
      <Section icon="📅" title="面談日時">
        <p>{formatDate(result.completedAt)}</p>
        <p>実施時間: {result.duration}分</p>
      </Section>

      {/* 面談サマリ */}
      <Section icon="📝" title="面談サマリ">
        <p>{result.summary}</p>
      </Section>

      {/* 重要ポイント */}
      <Section icon="🔑" title="重要ポイント">
        <ul>
          {result.keyPoints.map((point, i) => (
            <li key={i}>{point}</li>
          ))}
        </ul>
      </Section>

      {/* アクションアイテム */}
      <Section icon="✅" title="アクションアイテム">
        {result.actionItems.map((item, i) => (
          <div key={i} className="action-item">
            <input type="checkbox" />
            <span>{item.description}</span>
            {item.dueDate && (
              <span className="due-date">期限: {formatDate(item.dueDate)}</span>
            )}
          </div>
        ))}
      </Section>

      {/* フィードバック */}
      <Section icon="💬" title="フィードバック">
        <p>{result.feedbackToEmployee}</p>
      </Section>

      {/* フォローアップ */}
      {result.followUpRequired && (
        <Section icon="💡" title="フォローアップ">
          <p>予定日: {formatDate(result.followUpDate)}</p>
        </Section>
      )}

      {/* 次回推奨 */}
      <Section icon="🎯" title="次回面談の推奨">
        <p>推奨日: {formatDate(result.nextRecommendations.suggestedNextInterview)}</p>
        <p>推奨トピック:</p>
        <ul>
          {result.nextRecommendations.suggestedTopics.map((topic, i) => (
            <li key={i}>{topic}</li>
          ))}
        </ul>
      </Section>
    </div>
  );
};
```

---

## 🔐 セキュリティ・権限設計

### アクセス制御

**1. 職員本人のみ閲覧可能**
- ログイン中のユーザーIDから職員IDを取得
- 該当職員の面談サマリのみ取得
- 他人の面談サマリは閲覧不可（403 Forbidden）

**2. 認証必須**
- 全APIエンドポイントでBearer Token認証
- 未ログイン時は401 Unauthorized

**3. データ検証**
- interviewIdの形式検証
- SQLインジェクション対策（Prisma使用で自動対応）

---

## 📅 実装スケジュール提案

### Phase 1: API実装（1-2週間）
- [ ] `/api/my/interview-results` エンドポイント実装
- [ ] `/api/my/interview-results/:interviewId` エンドポイント実装
- [ ] 認証・権限チェック実装
- [ ] エラーハンドリング実装

### Phase 2: UI実装（2-3週間）
- [ ] 面談サマリ一覧画面
- [ ] 面談サマリ詳細画面
- [ ] レスポンシブデザイン対応
- [ ] ローディング・エラー表示

### Phase 3: テスト・調整（1週間）
- [ ] 統合テスト
- [ ] UI/UXレビュー
- [ ] パフォーマンス最適化

### Phase 4: 本番リリース
- [ ] 本番環境デプロイ
- [ ] モニタリング設定
- [ ] ユーザーフィードバック収集

**総所要時間**: 約4-6週間

---

## 📊 期待される効果

### 職員側メリット
- ✅ いつでも面談内容を振り返ることができる
- ✅ 人事部からのフィードバックを明確に把握
- ✅ アクションアイテムの進捗管理が容易
- ✅ 次回面談の準備がしやすい

### 人事部側メリット
- ✅ 面談内容の透明性向上
- ✅ 職員との信頼関係構築
- ✅ フォローアップ管理の効率化

### 組織全体メリット
- ✅ 人材育成の透明性向上
- ✅ PDCAサイクルの強化
- ✅ コミュニケーション品質向上

---

## 📞 連絡・サポート

### 医療システム側の対応
- API仕様の詳細説明
- テストデータ提供
- 統合テストサポート
- 技術的な質問対応

### VoiceDrive側への依頼
1. 実装可否の回答
2. 実装スケジュールの提示
3. 技術的な質問・確認事項
4. UI/UXデザインの最終決定

---

## 📎 参考資料

### 既存ドキュメント
- `mcp-shared/docs/面談サマリ統合テスト_最終完了報告_20251002.md` - 統合テスト結果
- `mcp-shared/docs/面談サマリ受信体制_実装確認完了報告_20251002.md` - 受信機能実装確認
- VoiceDrive側Prismaスキーマ: `InterviewResult`モデル

### データベース確認コマンド
```typescript
// 統合テストで送信されたデータを確認
const results = await InterviewResultService.list({ limit: 10 });
console.log(results.data);

// 特定データの詳細確認
const detail = await InterviewResultService.getByInterviewId('test-int-001');
console.log(detail.data);
```

---

## 🎯 まとめ

### 実装内容
1. **API実装**: 職員向け面談サマリ取得API（2エンドポイント）
2. **UI実装**: 一覧画面・詳細画面
3. **セキュリティ**: 本人のみ閲覧可能な権限設計

### 提供データ
- 面談日時・時間
- 面談サマリ
- 重要ポイント
- アクションアイテム
- フィードバック
- フォローアップ情報
- 次回推奨事項

### 期待効果
- 職員の満足度向上
- 人事部との信頼関係構築
- 透明性のある人材育成

---

**VoiceDriveチームでの面談サマリ閲覧UI実装をお願いいたします。**

医療システムチームは、実装サポート・技術的な質問対応・統合テストに全面協力いたします。

---

*作成: 医療システムチーム（Claude Code）*
*作成日: 2025年10月2日*
*ファイル: `mcp-shared/docs/面談サマリ閲覧UI_実装依頼書_20251002.md`*
