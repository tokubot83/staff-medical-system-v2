# VoiceDrive アイデアボイス投稿 コンテンツモデレーション提案書

**文書番号**: PROPOSAL-2025-1004-001
**作成日**: 2025年10月4日
**作成者**: 医療職員管理システムチーム
**宛先**: VoiceDriveチーム 様
**件名**: 共通ローカルLLMを活用した投稿コンテンツモデレーション機能の提案

---

## エグゼクティブサマリー

VoiceDriveシステムの「アイデアボイス投稿機能（改善提案投稿）」において、**個人攻撃や誹謗中傷を自動検知するコンテンツモデレーション機能**の実装をご提案いたします。

本提案では、**AWS Lightsail上に構築予定の共通ローカルLLM基盤**を活用することで、VoiceDriveチームに追加開発負担をかけることなく、高精度かつプライバシー保護された安全な投稿環境を実現します。

### 🎯 核心メリット

- ✅ **VoiceDrive側の開発負担ゼロ**: 医療システム側でAPI提供
- ✅ **プライバシー完全保護**: 投稿内容は外部送信なし・完全ローカル処理
- ✅ **リアルタイム検知**: 投稿時に即座に判定（< 2秒）
- ✅ **誤検知最小化**: 医療現場特有の表現を学習済み
- ✅ **運用コストゼロ**: 既存ローカルLLM基盤の活用

---

## 目次

1. [背景と課題](#背景と課題)
2. [ローカルLLM基盤の概要](#ローカルllm基盤の概要)
3. [提案するコンテンツモデレーション機能](#提案するコンテンツモデレーション機能)
4. [技術仕様](#技術仕様)
5. [実装スケジュール](#実装スケジュール)
6. [期待効果とKPI](#期待効果とkpi)
7. [リスクと対策](#リスクと対策)
8. [次のアクション](#次のアクション)

---

## 背景と課題

### 1.1 アイデアボイス投稿機能の重要性

VoiceDriveの「アイデアボイス投稿」は、職員が自由に改善提案を行える重要な機能です。しかし、匿名性が高い環境では、以下のリスクが存在します：

#### 想定されるリスク

| リスク分類 | 具体例 | 影響度 |
|-----------|--------|--------|
| **個人攻撃** | 「○○さんは仕事ができない」「△△師長は無能」 | 高 |
| **誹謗中傷** | 「あの人はいつもサボっている」「人格に問題がある」 | 高 |
| **ハラスメント表現** | 性別・年齢・容姿に関する不適切発言 | 高 |
| **機密情報漏洩** | 患者情報・個人情報の不適切な記載 | 極高 |
| **部署間対立煽動** | 「あの部署は楽をしている」等の対立発言 | 中 |

### 1.2 現行の課題

**手動モデレーションの限界**：
- ❌ 投稿後の事後チェックでは被害拡大の可能性
- ❌ 人的リソース不足（24時間対応不可）
- ❌ 主観的判断によるブレ
- ❌ 緊急対応の遅延

**外部AIサービスの課題**：
- ❌ 職員の投稿内容が外部企業に送信される（プライバシーリスク）
- ❌ 医療現場特有の表現を誤検知（例：「この手技は厳しい」→誤って誹謗中傷判定）
- ❌ ランニングコスト増加

---

## ローカルLLM基盤の概要

### 2.1 医療システム側の既存基盤

医療職員管理システムでは、AWS Lightsail上に**ローカルLLM基盤**を構築予定です。この基盤は以下の用途で活用されています：

#### 既存実装済み・予定機能

| 機能ID | 機能名 | 用途 | 実装状況 |
|--------|--------|------|----------|
| `interview.analysis` | 面談内容分析 | 感情分析、リスク検出、推奨アクション生成 | ✅ 実装済み |
| `interview.summary` | フィードバックサマリ生成 | 面談後のサマリ自動作成 | ✅ 実装済み |
| `evaluation.comment` | 評価コメント生成 | 人事評価コメントの下書き生成 | 🔄 実装中 |
| `report.monthly` | 月次レポート作成 | 部門別月次レポートの自動生成 | 📅 予定 |
| `smartsuggest.navigation` | スマートサジェスト | 画面遷移の予測提案 | ✅ 実装済み |
| **`voicedrive.moderation`** | **投稿コンテンツ検証** | **個人攻撃・誹謗中傷検知** | **🆕 今回提案** |

### 2.2 技術アーキテクチャ

```
┌────────────────────────────────────────────────────────┐
│       AWS Lightsail サーバー（8GB RAM, 2vCPU）         │
├────────────────────────────────────────────────────────┤
│                                                        │
│  🧠 ローカルLLM基盤（Ollama）                           │
│  ├─ Llama 3.2 8B 日本語版（汎用）                      │
│  ├─ ELYZA Japanese Llama 13B（医療特化）               │
│  └─ Phi-3 Mini（高速応答用）                           │
│                                                        │
│  📊 既存AI機能                                         │
│  ├─ 面談内容分析エンジン                               │
│  ├─ 評価コメント生成                                   │
│  ├─ スマートサジェスト                                 │
│  └─ 月次レポート生成                                   │
│                                                        │
│  🆕 新規提案機能                                       │
│  └─ コンテンツモデレーションエンジン ★                 │
│     ├─ 個人攻撃検知                                    │
│     ├─ 誹謗中傷検知                                    │
│     ├─ ハラスメント表現検知                            │
│     ├─ 機密情報漏洩検知                                │
│     └─ 建設的提案判定                                  │
│                                                        │
│  🗄️ PostgreSQL（共通データベース）                    │
│  └─ 学習データ・検知履歴保存                           │
│                                                        │
│  🔒 セキュリティ                                       │
│  ├─ 完全オンプレミス処理                               │
│  ├─ データ外部送信ゼロ                                 │
│  └─ 監査ログ完全管理                                   │
└────────────────────────────────────────────────────────┘
```

### 2.3 データフロー

**完全ローカル処理の保証**：

```
VoiceDrive → [投稿内容] → 医療システムLightsail
                              ↓
                        [ローカルLLM分析]
                        （外部送信なし）
                              ↓
                        [判定結果生成]
                              ↓
VoiceDrive ← [OK/警告/NG] ← 医療システム
```

---

## 提案するコンテンツモデレーション機能

### 3.1 機能概要

#### 投稿時のリアルタイム検証

```typescript
// VoiceDrive → 医療システムAPI呼び出し
POST /api/v1/voicedrive/moderation/check

Request:
{
  "postId": "POST-20251004-001",
  "content": "夜勤のシフト調整方法を改善すべきです。現状は〇〇の問題があります。",
  "authorId": "STAFF-001234",  // 匿名でも内部IDは保持
  "category": "業務改善提案",
  "metadata": {
    "department": "看護部",
    "timestamp": "2025-10-04T14:30:00Z"
  }
}

Response (< 2秒):
{
  "postId": "POST-20251004-001",
  "status": "approved",  // "approved" | "warning" | "rejected"
  "confidence": 95,
  "analysis": {
    "personalAttack": {
      "detected": false,
      "score": 0.02
    },
    "defamation": {
      "detected": false,
      "score": 0.01
    },
    "harassment": {
      "detected": false,
      "score": 0.00
    },
    "privacyLeak": {
      "detected": false,
      "score": 0.00
    },
    "constructiveLevel": 85  // 建設的提案度（0-100）
  },
  "reasoning": {
    "summary": "業務改善に関する建設的な提案です。",
    "strengths": [
      "具体的な問題点の指摘",
      "改善策の提案を含む"
    ],
    "suggestions": []
  },
  "processingTime": 1.2  // 秒
}
```

#### 警告・拒否時の例

```json
{
  "postId": "POST-20251004-002",
  "status": "warning",
  "confidence": 87,
  "analysis": {
    "personalAttack": {
      "detected": true,
      "score": 0.72,
      "detectedPhrases": ["○○さんは～", "あの人は～"]
    },
    "defamation": {
      "detected": false,
      "score": 0.15
    }
  },
  "reasoning": {
    "summary": "特定の個人を名指しする表現が含まれています。",
    "warnings": [
      "個人名の言及は避けてください",
      "一般的な問題として記述することを推奨します"
    ],
    "suggestions": [
      "「特定の職員」→「部署全体として」",
      "個人の行動ではなく、システムや制度の課題として記述してください"
    ]
  },
  "allowResubmit": true,
  "suggestedRevision": "夜勤のシフト調整方法を改善すべきです。部署全体として〇〇の課題があります。"
}
```

### 3.2 検知カテゴリ

#### レベル1：即時拒否（投稿不可）

| 検知項目 | 具体例 | 閾値 |
|---------|--------|------|
| 個人攻撃 | 「○○さんは無能」「△△師長はダメ」 | スコア > 0.7 |
| 誹謗中傷 | 「あの人は人間性に問題がある」 | スコア > 0.7 |
| 差別的表現 | 性別・年齢・容姿・国籍等への不適切言及 | スコア > 0.6 |
| 機密情報 | 患者名・職員の個人情報・給与等 | スコア > 0.5 |

#### レベル2：警告表示（修正推奨）

| 検知項目 | 具体例 | 閾値 |
|---------|--------|------|
| 個人名言及 | 「○○さんの対応」（悪意なし） | スコア 0.4-0.7 |
| 部署間対立 | 「あの部署は～」 | スコア 0.3-0.6 |
| 感情的表現 | 過度に攻撃的な表現 | スコア 0.3-0.6 |

#### レベル3：承認（投稿可能）

| 検知項目 | 具体例 |
|---------|--------|
| 建設的提案 | 「～を改善すべき」「～の方法を検討してほしい」 |
| 具体的問題指摘 | 「現在の○○システムには△△の課題がある」 |
| 代替案提示 | 「□□のように変更すれば改善できる」 |

### 3.3 医療現場特有の表現への対応

**誤検知防止のための学習済みパターン**：

| 表現例 | 一般AIの判定 | 本システムの判定 |
|--------|-------------|-----------------|
| 「この手技は厳しい」 | ❌ 誹謗中傷（誤検知） | ✅ 業務の難易度表現 |
| 「夜勤は体力的にきつい」 | ❌ 攻撃的表現（誤検知） | ✅ 労働環境の指摘 |
| 「急性期病棟は過酷」 | ❌ ネガティブ判定（誤検知） | ✅ 業務特性の記述 |
| 「○○医師の指示が不明確」 | ⚠️ 個人攻撃の可能性 | ⚠️ 警告表示・修正提案 |

---

## 技術仕様

### 4.1 APIエンドポイント

#### 投稿内容チェックAPI

```typescript
POST /api/v1/voicedrive/moderation/check
Content-Type: application/json
Authorization: Bearer {VOICEDRIVE_API_KEY}

interface ModerationCheckRequest {
  postId: string;
  content: string;
  authorId?: string;  // 匿名でも内部IDは保持
  category?: string;
  metadata?: {
    department?: string;
    facilityId?: string;
    timestamp?: string;
  };
}

interface ModerationCheckResponse {
  postId: string;
  status: 'approved' | 'warning' | 'rejected';
  confidence: number;  // 0-100
  analysis: {
    personalAttack: DetectionResult;
    defamation: DetectionResult;
    harassment: DetectionResult;
    privacyLeak: DetectionResult;
    constructiveLevel: number;
  };
  reasoning: {
    summary: string;
    strengths?: string[];
    warnings?: string[];
    suggestions?: string[];
  };
  allowResubmit?: boolean;
  suggestedRevision?: string;
  processingTime: number;  // 秒
}

interface DetectionResult {
  detected: boolean;
  score: number;  // 0.0-1.0
  detectedPhrases?: string[];
}
```

#### バッチチェックAPI（複数投稿の一括チェック）

```typescript
POST /api/v1/voicedrive/moderation/batch-check

Request:
{
  "posts": [
    { "postId": "POST-001", "content": "..." },
    { "postId": "POST-002", "content": "..." }
  ]
}

Response:
{
  "results": [
    { "postId": "POST-001", "status": "approved", ... },
    { "postId": "POST-002", "status": "warning", ... }
  ],
  "totalProcessingTime": 3.5
}
```

### 4.2 パフォーマンス仕様

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| **レスポンス時間** | < 2秒 | 95パーセンタイル |
| **精度（正解率）** | > 90% | 人間判定との一致率 |
| **誤検知率（False Positive）** | < 5% | 正常投稿をNGとする率 |
| **見逃し率（False Negative）** | < 3% | 不適切投稿をOKとする率 |
| **同時処理能力** | 50件/分 | 通常時 |
| **ピーク処理能力** | 100件/分 | 急増時 |
| **可用性** | 99.5% | 月間稼働率 |

### 4.3 セキュリティとプライバシー

#### 完全ローカル処理の保証

✅ **外部送信ゼロ**：
- 投稿内容は医療システムのLightsailサーバー内のみで処理
- OpenAI、Claude等の外部AIサービスは使用しない
- インターネット経由の外部通信なし

✅ **データ保持ポリシー**：
```javascript
const DATA_RETENTION_POLICY = {
  // 処理後の即時削除
  contentText: {
    retentionPeriod: 0,  // 処理完了後即座に削除
    encryption: true
  },

  // 検知結果のみ保存（匿名化）
  detectionResult: {
    retentionPeriod: 90,  // 90日間保存（改善のため）
    anonymized: true,     // 投稿者特定情報は削除
    purpose: '検知精度向上のための学習データ'
  },

  // 監査ログ
  auditLog: {
    retentionPeriod: 365,  // 1年間保存
    content: 'メタデータのみ（投稿内容は含まず）'
  }
};
```

✅ **アクセス制御**：
- APIキー認証（VoiceDrive専用キー発行）
- IPアドレス制限（VoiceDriveサーバーからのみアクセス可）
- リクエストレート制限（DDoS対策）

---

## 実装スケジュール

### 5.1 開発フェーズ（全8週間）

#### Phase 1: 基盤拡張（Week 1-2）

| 日程 | 作業内容 | 担当 | 成果物 |
|------|---------|------|--------|
| Day 1-3 | コンテンツモデレーション用LLMモデル選定 | 医療チーム | モデル仕様書 |
| Day 4-7 | 学習データセット作成（医療現場の表現パターン） | 医療チーム | 学習データ1000件 |
| Day 8-10 | LLMファインチューニング | 医療チーム | カスタムモデル |
| Day 11-14 | 精度テスト・調整 | 医療チーム | 精度90%達成 |

#### Phase 2: API実装（Week 3-4）

| 日程 | 作業内容 | 担当 | 成果物 |
|------|---------|------|--------|
| Day 15-18 | API開発（単一チェック） | 医療チーム | APIエンドポイント |
| Day 19-21 | バッチチェック機能 | 医療チーム | バッチAPI |
| Day 22-24 | パフォーマンス最適化 | 医療チーム | 2秒以内達成 |
| Day 25-28 | セキュリティ実装 | 医療チーム | 認証・暗号化 |

#### Phase 3: VoiceDrive連携（Week 5-6）

| 日程 | 作業内容 | 担当 | 成果物 |
|------|---------|------|--------|
| Day 29-31 | API仕様確定・共有 | 両チーム | API仕様書 |
| Day 32-35 | VoiceDrive側実装サポート | 医療チーム | 連携サンプルコード |
| Day 36-38 | 統合テスト | 両チーム | テスト結果レポート |
| Day 39-42 | 調整・バグ修正 | 両チーム | 修正完了 |

#### Phase 4: 運用開始（Week 7-8）

| 日程 | 作業内容 | 担当 | 成果物 |
|------|---------|------|--------|
| Day 43-45 | パイロット運用（限定公開） | 両チーム | パイロット結果 |
| Day 46-49 | フィードバック反映 | 医療チーム | 改善版デプロイ |
| Day 50-52 | 本番運用開始 | 両チーム | 運用開始報告 |
| Day 53-56 | 初期モニタリング | 医療チーム | 運用レポート |

### 5.2 マイルストーン

| マイルストーン | 予定日 | 判定基準 |
|--------------|--------|----------|
| Phase 1完了 | Week 2終了時 | 精度90%以上達成 |
| Phase 2完了 | Week 4終了時 | API応答2秒以内達成 |
| Phase 3完了 | Week 6終了時 | 統合テスト100%合格 |
| **本番運用開始** | **Week 7開始** | **パイロット成功** |

---

## 期待効果とKPI

### 6.1 定量的効果

#### コスト削減

| 項目 | 従来方式 | 本提案 | 削減効果 |
|------|---------|--------|---------|
| **初期開発費** | 外部委託：300-500万円 | 0円（既存LLM活用） | **100%削減** |
| **月額運用費** | 外部API：5-10万円 | 0円（既存基盤活用） | **100%削減** |
| **年間運用費** | 60-120万円 | 0円 | **100%削減** |
| **人件費削減** | 手動チェック：月20時間 | 自動化：月2時間 | **90%削減** |

#### 業務効率化

| 指標 | 改善前 | 改善後 | 効果 |
|------|--------|--------|------|
| 投稿チェック時間 | 平均5分/件 | < 2秒/件 | **99.3%短縮** |
| 不適切投稿の検知率 | 60%（人力） | 95%（AI） | **58%向上** |
| 職員への迅速フィードバック | 24時間以内 | リアルタイム | **即時化** |

### 6.2 定性的効果

✅ **安全な投稿環境**：
- 個人攻撃・誹謗中傷の未然防止
- 職員の心理的安全性の向上

✅ **建設的な提案文化の醸成**：
- 攻撃的表現の自動修正提案により、建設的な記述を促進
- より具体的で実行可能な改善提案の増加

✅ **管理者負担の軽減**：
- 24時間365日の自動モデレーション
- 人的リソースの戦略的業務への再配置

✅ **プライバシー保護**：
- 投稿内容の外部漏洩リスクゼロ
- 職員の信頼向上

### 6.3 KPI（運用開始後6ヶ月）

| KPI | 目標値 | 測定方法 |
|-----|--------|----------|
| 不適切投稿の検知率 | > 95% | 人間判定との一致率 |
| 誤検知率 | < 5% | 正常投稿を誤ってNGとする率 |
| システム応答時間 | < 2秒 | 95パーセンタイル |
| 投稿件数の増加 | +30% | 安全環境により投稿意欲向上 |
| 建設的提案の割合 | > 80% | AI評価スコア |
| 職員満足度 | > 4.0/5.0 | 四半期アンケート |

---

## リスクと対策

### 7.1 技術的リスク

| リスク | 発生確率 | 影響度 | 対策 |
|--------|---------|--------|------|
| AI判定の誤り | 中 | 中 | 人間による最終確認フロー整備 |
| システム障害 | 低 | 高 | フェイルセーフ機能（障害時は全投稿を保留し人間確認） |
| 処理速度の低下 | 低 | 中 | 負荷分散・スケールアウト対応 |

### 7.2 運用リスク

| リスク | 発生確率 | 影響度 | 対策 |
|--------|---------|--------|------|
| 過度な検閲との批判 | 中 | 中 | 透明性の確保・判定理由の明示 |
| 表現の萎縮 | 低 | 中 | 建設的な修正提案を重視 |
| 悪用（検知回避） | 低 | 中 | 継続的な学習・パターン更新 |

### 7.3 対策の詳細

#### 誤検知への対応

```
【人間確認フロー】
AI判定: 警告 or 拒否
    ↓
職員: 「異議申し立て」ボタン
    ↓
管理者: 人間による再判定（24時間以内）
    ↓
結果: 投稿承認 or 修正依頼
```

#### 透明性の確保

```javascript
// 判定理由の明示
const moderationResult = {
  status: 'warning',
  reasoning: {
    summary: '特定の個人を名指しする表現が含まれています',
    detectedPhrases: ['○○さんは～'],
    suggestions: [
      '個人名を伏せて「ある職員」と記述してください',
      '問題を一般化して記述することを推奨します'
    ]
  }
};
```

---

## 次のアクション

### 8.1 VoiceDriveチームへのお願い事項

#### 確認事項（今週中）

1. **提案内容の合意確認**
   - コンテンツモデレーション機能の必要性について
   - API連携方式の適切性について

2. **技術仕様の確認**
   - API仕様（エンドポイント、リクエスト/レスポンス形式）
   - レスポンス時間要件（2秒で問題ないか）
   - エラーハンドリング方式

3. **UI/UX設計の調整**
   - 警告メッセージの表示方法
   - 修正提案の表示形式
   - 異議申し立て機能の必要性

#### 今後のスケジュール調整

| 日程 | アクション | 参加者 |
|------|-----------|--------|
| 10/7（月） | キックオフミーティング | 両チーム |
| 10/8-10/9 | API仕様最終確定 | 技術担当者 |
| 10/10（木） | 開発開始承認 | プロジェクトリーダー |

### 8.2 医療システムチーム側の準備事項

- ✅ ローカルLLM基盤の拡張準備完了
- ✅ 学習データセット作成開始（医療現場の表現1000パターン）
- ✅ API開発環境の準備完了
- ⏳ VoiceDriveチームからの承認待ち

---

## 補足資料

### A. 参考文献

- [LLMモデル管理仕様書](../../docs/LLMモデル管理仕様書.md)
- [AI制御センター設計書](../../docs/AI制御センター設計書.md)
- [AWS Lightsail統合実装マスタープラン](./lightsail-integration-master-plan-integrated-20251003.md)

### B. 関連ドキュメント

- **既存実装**:
  - [面談予約AI最適化機能：技術詳細補足書](./AI_Optimization_Implementation_Details_20250913.md)
  - [AI分析デモ操作手順書](../../docs/AI分析デモ操作手順書.md)

- **実装コード**:
  - [ai-optimization-engine.ts](../../src/services/ai-optimization-engine.ts)
  - [ModelManagementPanel.tsx](../../src/components/admin/ModelManagementPanel.tsx)

### C. 問い合わせ先

**医療職員管理システムチーム**
- プロジェクトリーダー: medical-lead@example.com
- AI/LLM担当: ai-team@example.com
- 技術サポート: tech-support@example.com

---

## 承認欄

| 役職 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| 医療システムチーム リーダー | | | |
| VoiceDriveチーム リーダー | | | |
| 情報システム部長 | | | |
| 事務局長 | | | |

---

**文書終了**

*本提案書は両チームの協議のもと、適宜更新される予定です。*
*ご質問・ご要望がございましたら、お気軽にお声がけください。*

**🤖 医療職員管理システムチーム**
**AI・機械学習担当**
2025年10月4日
