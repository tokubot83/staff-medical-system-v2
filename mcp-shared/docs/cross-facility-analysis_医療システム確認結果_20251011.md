# Cross Facility Analysis åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ

**æ–‡æ›¸ç•ªå·**: MEDICAL-CONFIRMATION-2025-1011-003
**ä½œæˆæ—¥**: 2025å¹´10æœˆ11æ—¥
**ä½œæˆè€…**: åŒ»ç™‚è·å“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ 
**å¯¾è±¡ãƒšãƒ¼ã‚¸**: https://voicedrive-v100.vercel.app/cross-facility-analysis
**å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- cross-facility-analysis_DBè¦ä»¶åˆ†æ_20251011.mdï¼ˆVoiceDriveãƒãƒ¼ãƒ ä½œæˆï¼‰
- cross-facility-analysisæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251011.mdï¼ˆVoiceDriveãƒãƒ¼ãƒ ä½œæˆï¼‰

---

## ğŸ“‹ ç¢ºèªçµæœã‚µãƒãƒªãƒ¼

### ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã®ç¢ºèª

**Cross Facility Analysisãƒšãƒ¼ã‚¸ã¯å®Œå…¨ã«VoiceDriveã‚·ã‚¹ãƒ†ãƒ å´ã§å®Ÿè£…ãƒ»é‹ç”¨ã•ã‚Œã¾ã™**

```
VoiceDriveå´ã§å®Ÿè£…:
- æ–½è¨­æ¨ªæ–­å…±é€šèª²é¡Œã®è‡ªå‹•æ¤œå‡ºï¼ˆ100%ï¼‰
- æˆåŠŸäº‹ä¾‹ã®è‡ªå‹•æŠ½å‡ºï¼ˆ100%ï¼‰
- æˆ¦ç•¥çš„æ©Ÿä¼šã®è‡ªå‹•ç”Ÿæˆï¼ˆ100%ï¼‰
- æ¨ªå±•é–‹çŠ¶æ³ã®ç®¡ç†ï¼ˆ100%ï¼‰
- ãƒãƒƒãƒå‡¦ç†ï¼ˆæ—¥æ¬¡ãƒ»é€±æ¬¡ãƒ»æœˆæ¬¡ï¼‰ï¼ˆ100%ï¼‰

åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§å®Ÿè£…:
- æ–½è¨­ãƒã‚¹ã‚¿APIï¼ˆæ—¢å­˜å®Ÿè£…æ¸ˆã¿âœ…ï¼‰
```

### ğŸ‰ è‰¯ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹

**åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§å¿…è¦ãªAPIï¼ˆ1ä»¶ï¼‰ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ã§ã™ï¼**

- âœ… **GET /api/v2/facilities** - **å®Ÿè£…æ¸ˆã¿**ï¼ˆPhase 3å®Ÿè£…æ™‚ã€2025å¹´9æœˆ28æ—¥å®Œäº†ï¼‰

---

## ğŸ“ æ—¢å­˜è¨ˆç”»æ›¸ã¨ã®æ•´åˆæ€§è©•ä¾¡

### âœ… ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸ã¨ã®æ•´åˆæ€§

**çµè«–**: âœ… **å®Œå…¨ã«æ•´åˆã—ã¦ã„ã‚‹**

| ãƒ‡ãƒ¼ã‚¿é …ç›® | VoiceDrive | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  | æä¾›æ–¹æ³• |
|-----------|-----------|-------------|---------|
| **æ–½è¨­ãƒã‚¹ã‚¿** | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âœ… ãƒã‚¹ã‚¿ | **APIæä¾›** |
| **å…±é€šèª²é¡Œæ¤œå‡º** | âœ… ãƒã‚¹ã‚¿ | âŒ ç®¡è½„å¤– | VoiceDriveå´ã§ç®¡ç† |
| **æˆåŠŸäº‹ä¾‹æŠ½å‡º** | âœ… ãƒã‚¹ã‚¿ | âŒ ç®¡è½„å¤– | VoiceDriveå´ã§ç®¡ç† |
| **æˆ¦ç•¥çš„æ©Ÿä¼šç”Ÿæˆ** | âœ… ãƒã‚¹ã‚¿ | âŒ ç®¡è½„å¤– | VoiceDriveå´ã§ç®¡ç† |
| **æ¨ªå±•é–‹çŠ¶æ³ç®¡ç†** | âœ… ãƒã‚¹ã‚¿ | âŒ ç®¡è½„å¤– | VoiceDriveå´ã§ç®¡ç† |

**åŸå‰‡ã«æ²¿ã£ãŸè¨­è¨ˆ**:
- âœ… Single Source of Truth: æ–½è¨­æƒ…å ±ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãŒçœŸå®Ÿã®æƒ…å ±æº
- âœ… APIé€£æº: æ—¢å­˜ã®æ–½è¨­ãƒã‚¹ã‚¿APIã‚’åˆ©ç”¨
- âœ… æœ€å°é‡è¤‡: VoiceDriveå´ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã¿ï¼ˆè¡¨ç¤ºç”¨ï¼‰
- âœ… æ˜ç¢ºãªå¢ƒç•Œ: æ–½è¨­æ¨ªæ–­åˆ†æã¯VoiceDriveç®¡è½„

### âœ… DBæ§‹ç¯‰è¨ˆç”»æ›¸å‰æº–å‚™ã¨ã®æ•´åˆæ€§

**çµè«–**: âœ… **å®Œå…¨æ•´åˆï¼ˆCross Facility Analysisé–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ã¯å…¨ã¦VoiceDriveå´ã§ç®¡ç†ï¼‰**

æ—¢å­˜ã®[DBæ§‹ç¯‰è¨ˆç”»æ›¸å‰æº–å‚™_ä¸è¶³é …ç›®æ•´ç†_20251008.md](../../docs/DBæ§‹ç¯‰è¨ˆç”»æ›¸å‰æº–å‚™_ä¸è¶³é …ç›®æ•´ç†_20251008.md)ã«ã¯ä»¥ä¸‹ãŒ**å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“**ï¼š

âŒ **æœªè¨˜è¼‰é …ç›®**:
1. CrossFacilityCommonIssueï¼ˆæ–½è¨­æ¨ªæ–­å…±é€šèª²é¡Œï¼‰
2. CrossFacilitySuccessCaseï¼ˆæ¨ªå±•é–‹å¯èƒ½ãªæˆåŠŸäº‹ä¾‹ï¼‰
3. SuccessCaseReplicationï¼ˆæˆåŠŸäº‹ä¾‹ã®æ¨ªå±•é–‹çŠ¶æ³ï¼‰
4. StrategicOpportunityï¼ˆæ³•äººå…¨ä½“ã§ã®æˆ¦ç•¥çš„æ©Ÿä¼šï¼‰

**ç†ç”±**: Cross Facility Analysisãƒšãƒ¼ã‚¸ã¯å®Œå…¨ã«VoiceDriveãƒãƒ¼ãƒ ãŒç®¡ç†ã™ã‚‹åˆ†æãƒ»é›†è¨ˆæ©Ÿèƒ½ã®ãŸã‚ã€åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®DBè¨­è¨ˆã«åæ˜ ã•ã‚Œã¦ã„ãªã„

**å½±éŸ¿**: âœ… **å½±éŸ¿ãªã—ï¼ˆè¿½åŠ ä¸è¦ï¼‰**

ç†ç”±ï¼š
- æ–½è¨­æ¨ªæ–­åˆ†æã¯VoiceDriveå´ã®è²¬ä»»ç¯„å›²ï¼ˆãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸ã«æº–æ‹ ï¼‰
- åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã¯æ–½è¨­ãƒã‚¹ã‚¿APIã‚’æä¾›ã™ã‚‹ã®ã¿ï¼ˆæ—¢ã«å®Ÿè£…æ¸ˆã¿ï¼‰
- DBæ§‹ç¯‰è¨ˆç”»æ›¸ã¸ã®è¿½åŠ ã¯**ä¸è¦**

### âœ… å…±é€šDBæ§‹ç¯‰å¾Œ_ä½œæ¥­å†é–‹æŒ‡ç¤ºæ›¸ã¨ã®æ•´åˆæ€§

**çµè«–**: âœ… **æ•´åˆã—ã¦ã„ã‚‹**

æ—¢å­˜ã®[å…±é€šDBæ§‹ç¯‰å¾Œ_ä½œæ¥­å†é–‹æŒ‡ç¤ºæ›¸_20250928.md](../../docs/å…±é€šDBæ§‹ç¯‰å¾Œ_ä½œæ¥­å†é–‹æŒ‡ç¤ºæ›¸_20250928.md)ã«ã¯ä»¥ä¸‹ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ï¼š

- âœ… æ–½è¨­åˆ¥æ¨©é™ãƒ¬ãƒ™ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆPhase 3å®Œäº†ï¼‰
- âœ… OrganizationAnalytics APIçµ±åˆãƒ†ã‚¹ãƒˆæ‰‹é †ï¼ˆ6.3ç¯€ï¼‰
- âœ… ExecutiveReports/BoardPreparation/CorporateAgendaDashboard VoiceDriveå®Ÿè£…ã‚¿ã‚¹ã‚¯

**Cross Facility Analysisã¸ã®å¯¾å¿œ**:
- åŒã˜APIï¼ˆ`GET /api/v2/facilities`ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€æ—¢å­˜ã®çµ±åˆãƒ†ã‚¹ãƒˆæ‰‹é †ã‚’æµç”¨å¯èƒ½
- è¿½åŠ ã®çµ±åˆãƒ†ã‚¹ãƒˆé …ç›®ã¯ä¸è¦

### ğŸ“Š æ•´åˆæ€§è©•ä¾¡ã‚µãƒãƒªãƒ¼

| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | æ•´åˆæ€§ | å¯¾å¿œè¦å¦ | å‚™è€ƒ |
|------------|--------|---------|------|
| **ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸** | âœ… å®Œå…¨æ•´åˆ | ä¸è¦ | è²¬ä»»åˆ†æ‹…ãŒæ˜ç¢º |
| **DBæ§‹ç¯‰è¨ˆç”»æ›¸å‰æº–å‚™_ä¸è¶³é …ç›®æ•´ç†** | âœ… å®Œå…¨æ•´åˆ | **ä¸è¦** | VoiceDriveå´ã§ç®¡ç† |
| **å…±é€šDBæ§‹ç¯‰å¾Œ_ä½œæ¥­å†é–‹æŒ‡ç¤ºæ›¸** | âœ… æ•´åˆ | ä¸è¦ | æ—¢å­˜æ‰‹é †ã‚’æµç”¨å¯èƒ½ |

**çµè«–**: âœ… **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§è¿½åŠ ã®DBè¨­è¨ˆãƒ»å®Ÿè£…ã¯ä¸è¦**

---

## ğŸ” è©³ç´°ç¢ºèªçµæœ

### 1. APIæä¾›çŠ¶æ³ã®ç¢ºèª

#### âœ… API-1: æ–½è¨­ãƒã‚¹ã‚¿å–å¾—APIï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**VoiceDriveãƒãƒ¼ãƒ ã®è¦æ±‚**:
```
GET /api/v2/facilities
```

**å®Ÿè£…çŠ¶æ³**: âœ… **å®Œå…¨å®Ÿè£…æ¸ˆã¿**

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/api/v2/facilities/route.ts`

**å®Ÿè£…å®Œäº†æ—¥**: 2025å¹´9æœˆ28æ—¥ï¼ˆPhase 3å®Ÿè£…æ™‚ï¼‰

**ç¾åœ¨ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**:
```json
{
  "data": {
    "facilities": [
      {
        "facilityId": "obara-hospital",
        "facilityCode": "OB-HOSP",
        "facilityName": "åŒ»ç™‚æ³•äºº åšç”Ÿä¼š å°åŸç—…é™¢",
        "facilityType": "acute",
        "isActive": true,
        "staffCount": 420
      },
      {
        "facilityId": "tategami-rehabilitation",
        "facilityCode": "TG-REHAB",
        "facilityName": "ç«‹ç¥ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ¸©æ³‰ç—…é™¢",
        "facilityType": "rehabilitation",
        "isActive": true,
        "staffCount": 180
      },
      {
        "facilityId": "espoir-tategami",
        "facilityCode": "ES-CARE",
        "facilityName": "ä»‹è­·è€äººä¿å¥æ–½è¨­ã‚¨ã‚¹ãƒãƒ¯ãƒ¼ãƒ«ç«‹ç¥",
        "facilityType": "geriatric_health_facility",
        "isActive": true,
        "staffCount": 150
      }
    ]
  },
  "meta": {
    "totalCount": 3,
    "timestamp": "2025-10-11T00:00:00Z"
  }
}
```

**VoiceDriveãƒãƒ¼ãƒ ãŒè¦æ±‚ã—ãŸå½¢å¼**:
```json
{
  "facilities": [
    {
      "id": "string",
      "name": "string",
      "type": "string"
    }
  ]
}
```

**äº’æ›æ€§ã®è©•ä¾¡**:

| é …ç›® | ç¾åœ¨ã®API | VoiceDriveè¦æ±‚ | äº’æ›æ€§ | å¯¾å¿œæ–¹æ³• |
|------|----------|---------------|--------|---------|
| **æ–½è¨­ID** | `facilityId` | `id` | âš ï¸ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åç›¸é• | VoiceDriveå´ã§ãƒãƒƒãƒ”ãƒ³ã‚° |
| **æ–½è¨­å** | `facilityName` | `name` | âš ï¸ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åç›¸é• | VoiceDriveå´ã§ãƒãƒƒãƒ”ãƒ³ã‚° |
| **æ–½è¨­ã‚¿ã‚¤ãƒ—** | `facilityType` | `type` | âš ï¸ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åç›¸é• | VoiceDriveå´ã§ãƒãƒƒãƒ”ãƒ³ã‚° |
| **ç¨¼åƒçŠ¶æ³** | `isActive` | å¿…è¦ | âœ… å®Ÿè£…æ¸ˆã¿ | ãã®ã¾ã¾åˆ©ç”¨å¯èƒ½ |
| **è·å“¡æ•°** | `staffCount` | ä»»æ„ | âœ… å®Ÿè£…æ¸ˆã¿ | ãã®ã¾ã¾åˆ©ç”¨å¯èƒ½ |

**çµè«–**: âœ… **APIã¯å®Ÿè£…æ¸ˆã¿ã€‚VoiceDriveå´ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚Œã°åˆ©ç”¨å¯èƒ½**

---

## ğŸ“Š åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®å¯¾å¿œçŠ¶æ³

### âœ… å¯¾å¿œå®Œäº†ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

1. **æ–½è¨­ãƒã‚¹ã‚¿å–å¾—API** - `GET /api/v2/facilities`
   - ãƒ•ã‚¡ã‚¤ãƒ«: `src/app/api/v2/facilities/route.ts`
   - å®Ÿè£…æ—¥: 2025å¹´9æœˆ28æ—¥
   - ãƒ†ã‚¹ãƒˆ: Phase 3çµ±åˆãƒ†ã‚¹ãƒˆæˆåŠŸ
   - æ‰¿èªç•ªå·: PHASE3-FACILITY-API-001

### âŒ å¯¾å¿œä¸è¦

| é …ç›® | ç†ç”± |
|------|------|
| **æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆï¼ˆ4ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰** | VoiceDriveå´ã§ç®¡ç† |
| **å…±é€šèª²é¡Œè‡ªå‹•æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯** | VoiceDriveå´ã§å®Ÿè£… |
| **æˆåŠŸäº‹ä¾‹è‡ªå‹•æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯** | VoiceDriveå´ã§å®Ÿè£… |
| **æˆ¦ç•¥çš„æ©Ÿä¼šè‡ªå‹•ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯** | VoiceDriveå´ã§å®Ÿè£… |
| **ãƒãƒƒãƒå‡¦ç†å®Ÿè£…ï¼ˆ3ãƒãƒƒãƒï¼‰** | VoiceDriveå´ã§å®Ÿè£… |
| **æ¨ªå±•é–‹çŠ¶æ³ç®¡ç†** | VoiceDriveå´ã§å®Ÿè£… |

---

## ğŸ¯ VoiceDriveãƒãƒ¼ãƒ ã¸ã®æ¨å¥¨äº‹é …

### 1. æ–½è¨­ãƒã‚¹ã‚¿APIåˆ©ç”¨æ–¹æ³•

**æ—¢å­˜APIã‚’ãã®ã¾ã¾åˆ©ç”¨ã§ãã¾ã™**:

```typescript
// VoiceDriveå´ã®å®Ÿè£…ä¾‹
async function getFacilities() {
  const response = await fetch('/api/v2/facilities', {
    headers: {
      'Authorization': `Bearer ${process.env.MEDICAL_SYSTEM_API_TOKEN}`,
      'X-API-Key': process.env.MEDICAL_SYSTEM_API_KEY
    }
  });

  const data = await response.json();

  // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åå¤‰æ›
  return data.data.facilities.map(facility => ({
    id: facility.facilityId,
    name: facility.facilityName,
    type: facility.facilityType,
    isActive: facility.isActive,
    staffCount: facility.staffCount
  }));
}
```

### 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ¨å¥¨

**æ–½è¨­ãƒã‚¹ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥**:
```typescript
// Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¨å¥¨è¨­å®š
await redis.setex(
  'medical:facilities',
  86400,  // 24æ™‚é–“
  JSON.stringify(facilities)
);
```

**ç†ç”±**:
- æ–½è¨­ãƒã‚¹ã‚¿ã¯é »ç¹ã«å¤‰æ›´ã•ã‚Œãªã„ãŸã‚ã€24æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒé©åˆ‡
- Cross Facility Analysisã®ãƒãƒƒãƒå‡¦ç†ã¯è² è·ãŒé«˜ã„ãŸã‚ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¿…é ˆ

### 3. å…±é€šèª²é¡Œæ¤œå‡ºã®å®Ÿè£…æ¨å¥¨

VoiceDriveå´ã§å®Ÿè£…ã™ã‚‹å…±é€šèª²é¡Œæ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ã®æ¨å¥¨äº‹é …ï¼š

```typescript
// å…±é€šèª²é¡Œæ¤œå‡ºã®åŸºæœ¬ãƒ­ã‚¸ãƒƒã‚¯
async function detectCommonIssues(): Promise<CrossFacilityCommonIssue[]> {
  // 1. ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  const issuesByCategory = await prisma.post.groupBy({
    by: ['category', 'facilityId'],
    where: {
      status: 'active',
      createdAt: { gte: oneMonthAgo }
    },
    _count: { id: true }
  });

  // 2. 2æ–½è¨­ä»¥ä¸Šã§ç™ºç”Ÿã—ã¦ã„ã‚‹èª²é¡Œã‚’æŠ½å‡º
  const categoryStats = new Map<string, Set<string>>();

  for (const issue of issuesByCategory) {
    if (issue._count.id >= 20) {  // é–¾å€¤: 1æ–½è¨­ã‚ãŸã‚Š20ä»¶ä»¥ä¸Š
      if (!categoryStats.has(issue.category)) {
        categoryStats.set(issue.category, new Set());
      }
      categoryStats.get(issue.category)!.add(issue.facilityId);
    }
  }

  // 3. å…±é€šèª²é¡Œã‚’ç”Ÿæˆ
  const commonIssues: CrossFacilityCommonIssue[] = [];

  for (const [category, facilities] of categoryStats.entries()) {
    if (facilities.size >= 2) {  // 2æ–½è¨­ä»¥ä¸Š
      const affectedFacilities = Array.from(facilities);
      const totalVoices = await prisma.post.count({
        where: {
          category,
          facilityId: { in: affectedFacilities },
          status: 'active'
        }
      });

      commonIssues.push({
        title: `${category}ã«é–¢ã™ã‚‹èª²é¡Œ`,
        category,
        affectedFacilities,
        affectedFacilityCount: facilities.size,
        totalVoices,
        severity: calculateSeverity(facilities.size, totalVoices),
        // ... ãã®ä»–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
      });
    }
  }

  return commonIssues;
}
```

### 4. æˆåŠŸäº‹ä¾‹æŠ½å‡ºã®å®Ÿè£…æ¨å¥¨

```typescript
// æˆåŠŸäº‹ä¾‹æŠ½å‡ºã®åŸºæœ¬ãƒ­ã‚¸ãƒƒã‚¯
async function identifySuccessCases(): Promise<CrossFacilitySuccessCase[]> {
  // 1. é«˜è©•ä¾¡ã®resolvedPostã‚’æŠ½å‡º
  const highRatedPosts = await prisma.post.findMany({
    where: {
      status: 'resolved',
      resolutionRating: { gte: 4.0 },  // 4.0ä»¥ä¸Š
      votes: { some: {} },
      _count: {
        votes: { gte: 30 }  // 30äººä»¥ä¸Šã®è³›åŒ
      }
    },
    include: {
      votes: true,
      comments: true,
      facility: true
    }
  });

  // 2. æ¨ªå±•é–‹å¯èƒ½æ€§ã‚’è©•ä¾¡
  const successCases: CrossFacilitySuccessCase[] = [];

  for (const post of highRatedPosts) {
    // ä»–æ–½è¨­ã§é¡ä¼¼èª²é¡ŒãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
    const similarIssuesCount = await prisma.post.count({
      where: {
        category: post.category,
        facilityId: { not: post.facilityId },
        status: { in: ['active', 'in-progress'] }
      }
    });

    if (similarIssuesCount >= 2) {
      const replicability = calculateReplicability(
        post,
        similarIssuesCount,
        'low'  // å®Ÿè£…ã®è¤‡é›‘åº¦ï¼ˆè¦æ‰‹å‹•åˆ¤å®šï¼‰
      );

      successCases.push({
        facilityId: post.facilityId,
        title: post.title,
        category: post.category,
        description: post.content,
        impact: extractImpact(post),
        replicability,
        sourcePostId: post.id,
        // ... ãã®ä»–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
      });
    }
  }

  return successCases;
}
```

### 5. ãƒãƒƒãƒå‡¦ç†ã®å®Ÿè£…æ¨å¥¨

```typescript
// 3ã¤ã®ãƒãƒƒãƒã‚¸ãƒ§ãƒ–
import cron from 'node-cron';

// æ—¥æ¬¡ãƒãƒƒãƒ: å…±é€šèª²é¡Œè‡ªå‹•æ¤œå‡ºï¼ˆåˆå‰3æ™‚ï¼‰
cron.schedule('0 3 * * *', async () => {
  logger.info('[Batch] Detecting common issues...');
  const issues = await crossFacilityService.detectCommonIssues();
  logger.info(`[Batch] Detected ${issues.length} common issues`);
});

// é€±æ¬¡ãƒãƒƒãƒ: æˆåŠŸäº‹ä¾‹è‡ªå‹•æŠ½å‡ºï¼ˆæœˆæ›œåˆå‰4æ™‚ï¼‰
cron.schedule('0 4 * * 1', async () => {
  logger.info('[Batch] Identifying success cases...');
  const cases = await crossFacilityService.identifySuccessCases();
  logger.info(`[Batch] Identified ${cases.length} success cases`);
});

// æœˆæ¬¡ãƒãƒƒãƒ: æˆ¦ç•¥çš„æ©Ÿä¼šè‡ªå‹•ç”Ÿæˆï¼ˆ1æ—¥åˆå‰5æ™‚ï¼‰
cron.schedule('0 5 1 * *', async () => {
  logger.info('[Batch] Generating strategic opportunities...');
  const opportunities = await crossFacilityService.generateStrategicOpportunities();
  logger.info(`[Batch] Generated ${opportunities.length} opportunities`);
});
```

---

## âœ… ç¢ºèªå®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´
- [x] æ–½è¨­ãƒã‚¹ã‚¿APIå®Ÿè£…ç¢ºèª
- [x] APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ç¢ºèª
- [x] ç¢ºèªçµæœãƒ¬ãƒãƒ¼ãƒˆä½œæˆ

### VoiceDriveãƒãƒ¼ãƒ å´ï¼ˆæ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- [ ] æ—¢å­˜APIï¼ˆGET /api/v2/facilitiesï¼‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãƒãƒƒãƒ”ãƒ³ã‚°å®Ÿè£…
- [ ] 4ã¤ã®æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆãƒ»å®Ÿè£…
  - [ ] CrossFacilityCommonIssue
  - [ ] CrossFacilitySuccessCase
  - [ ] SuccessCaseReplication
  - [ ] StrategicOpportunity
- [ ] Userãƒ»Postãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ
- [ ] CrossFacilityAnalysisServiceå®Ÿè£…
  - [ ] detectCommonIssues()
  - [ ] identifySuccessCases()
  - [ ] generateStrategicOpportunities()
- [ ] 9ã¤ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
- [ ] 3ã¤ã®ãƒãƒƒãƒã‚¸ãƒ§ãƒ–å®Ÿè£…ï¼ˆæ—¥æ¬¡ãƒ»é€±æ¬¡ãƒ»æœˆæ¬¡ï¼‰
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ4ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
- [ ] Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥å®Ÿè£…
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½

---

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ 
1. âœ… ç¢ºèªçµæœã‚’VoiceDriveãƒãƒ¼ãƒ ã«å…±æœ‰
2. â³ VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®è¿½åŠ è³ªå•å¯¾å¿œï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
3. â³ çµ±åˆãƒ†ã‚¹ãƒˆå”åŠ›ï¼ˆPhase 4å®Ÿè£…å®Œäº†å¾Œï¼‰

### VoiceDriveãƒãƒ¼ãƒ 
1. æ–½è¨­ãƒã‚¹ã‚¿APIåˆ©ç”¨å®Ÿè£…ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰
2. CrossFacilityAnalysisServiceå®Ÿè£…ï¼ˆå…±é€šèª²é¡Œæ¤œå‡ºãƒ»æˆåŠŸäº‹ä¾‹æŠ½å‡ºãƒ»æˆ¦ç•¥çš„æ©Ÿä¼šç”Ÿæˆï¼‰
3. ãƒãƒƒãƒå‡¦ç†å®Ÿè£…ï¼ˆæ—¥æ¬¡ãƒ»é€±æ¬¡ãƒ»æœˆæ¬¡ï¼‰
4. Phase 4å®Œäº†å¾Œã€åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ ã¨çµ±åˆãƒ†ã‚¹ãƒˆ

---

## ğŸ“ å‚è€ƒè³‡æ–™

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…æ¸ˆã¿API
- [GET /api/v2/facilities](../../src/app/api/v2/facilities/route.ts)
- [Phase 3å®Ÿè£…å®Œäº†å ±å‘Šæ›¸](../../docs/Phase3_å®Ÿè£…ä½œæ¥­å®Œäº†å ±å‘Šæ›¸_FINAL.md)

### VoiceDriveå´ä½œæˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [cross-facility-analysis_DBè¦ä»¶åˆ†æ_20251011.md](./cross-facility-analysis_DBè¦ä»¶åˆ†æ_20251011.md)
- [cross-facility-analysisæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251011.md](./cross-facility-analysisæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251011.md)

### æ•´åˆæ€§è©•ä¾¡å¯¾è±¡ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸_20251008.md](./ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»åˆ†ç•Œç‚¹å®šç¾©æ›¸_20251008.md)
- [DBæ§‹ç¯‰è¨ˆç”»æ›¸å‰æº–å‚™_ä¸è¶³é …ç›®æ•´ç†_20251008.md](../../docs/DBæ§‹ç¯‰è¨ˆç”»æ›¸å‰æº–å‚™_ä¸è¶³é …ç›®æ•´ç†_20251008.md)
- [å…±é€šDBæ§‹ç¯‰å¾Œ_ä½œæ¥­å†é–‹æŒ‡ç¤ºæ›¸_20250928.md](../../docs/å…±é€šDBæ§‹ç¯‰å¾Œ_ä½œæ¥­å†é–‹æŒ‡ç¤ºæ›¸_20250928.md)

### é–¢é€£ãƒšãƒ¼ã‚¸ç¢ºèªçµæœ
- [corporate-agenda-dashboard_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251011.md](./corporate-agenda-dashboard_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251011.md)
- [board-preparation_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251011.md](./board-preparation_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251011.md)
- [executive-reports_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251011.md](./executive-reports_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251011.md)

---

**æ–‡æ›¸çµ‚äº†**

**ä½œæˆè€…**: åŒ»ç™‚è·å“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ 
**ä½œæˆæ—¥**: 2025å¹´10æœˆ11æ—¥
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ11æ—¥
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å—é ˜å¾Œ
