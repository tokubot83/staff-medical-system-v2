# HomePageçµ±åˆã«é–¢ã™ã‚‹åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´å®Ÿè£…çŠ¶æ³å›ç­”æ›¸

**æ–‡æ›¸ç•ªå·**: MED-RESP-2025-1027-004
**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥
**ä½œæˆè€…**: ClaudeCodeï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ ï¼‰
**å®›å…ˆ**: VoiceDriveãƒãƒ¼ãƒ 
**ä»¶å**: HomePageã«é–¢ã™ã‚‹4ã¤ã®ç¢ºèªäº‹é …ã¸ã®å›ç­”
**å‚ç…§æ–‡æ›¸**:
- [HomePage_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251027.md](./HomePage_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251027.md)
- VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®è³ªå•ï¼ˆmcp-sharedçµŒç”±ï¼‰

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®4ã¤ã®ç¢ºèªäº‹é …ã«å¯¾ã™ã‚‹åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®å®Ÿè£…çŠ¶æ³ã‚’å ±å‘Šã—ã¾ã™ã€‚

### çµè«–: âœ… **å…¨ã¦å®Ÿè£…å®Œäº†ã€HomePageé€£æºæº–å‚™å®Œäº†**

| è³ªå• | çŠ¶æ…‹ | è©³ç´° |
|------|------|------|
| **è³ªå•1**: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£… | âœ… **å®Œå…¨å®Ÿè£…æ¸ˆã¿** | Phase 1å®Ÿè£…å®Œäº†ï¼ˆ2025å¹´9æœˆ20æ—¥ï¼‰ |
| **è³ªå•2**: professionCategoryæä¾› | âœ… **æœ¬æ—¥å®Ÿè£…å®Œäº†** | Phase 2.18ã§å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ï¼ˆ2025å¹´10æœˆ27æ—¥ï¼‰ |
| **è³ªå•3**: Webhookå®Ÿè£… | âœ… **å®Œå…¨å®Ÿè£…æ¸ˆã¿** | Phase 3å®Ÿè£…å®Œäº†ï¼ˆ2025å¹´10æœˆ2æ—¥ï¼‰ |
| **è³ªå•4**: ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ç¢ºèª | âœ… **å…¨ã¦å­˜åœ¨** | Prisma schemaã§ç¢ºèªæ¸ˆã¿ |

---

## è³ªå•1: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…ç¢ºèª

### å›ç­”: âœ… **ä¸¡æ–¹ã¨ã‚‚å®Ÿè£…æ¸ˆã¿**

ä»¥ä¸‹ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

#### 1-1. å€‹åˆ¥è·å“¡æƒ…å ±å–å¾—API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/v2/employees/:employeeId`

**å®Ÿè£…çŠ¶æ³**: âœ… **Phase 1å®Ÿè£…æ¸ˆã¿**ï¼ˆ2025å¹´9æœˆ20æ—¥ï¼‰

**å®Ÿè£…ç®‡æ‰€**: [src/app/api/v2/employees/[employeeId]/route.ts](../../src/app/api/v2/employees/[employeeId]/route.ts)

**èªè¨¼æ–¹å¼**: Bearer Tokenï¼ˆJWTï¼‰

**å¿…è¦æ¨©é™**: Level 99ï¼ˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**:
```json
{
  "employeeId": "E001",
  "name": "å±±ç”°å¤ªéƒ",
  "email": "yamada@example.com",
  "department": "åŒ»ç™‚ç™‚é¤Šç—…æ£Ÿ",
  "position": "çœ‹è­·å¸«é•·",
  "professionCategory": "nursing",  // â† Phase 2.18ã§å®Ÿè£…å®Œäº†
  "facilityId": "tategami-hospital",
  "permissionLevel": 7,
  "accountType": "NURSE",
  "canPerformLeaderDuty": false,
  "parentId": "sup-001",
  "isActive": true,
  "isRetired": false,
  "retirementDate": null,
  "hireDate": "2020-04-01T00:00:00Z",
  "yearsOfService": 5.6,
  "updatedAt": "2025-10-27T10:00:00Z"
}
```

**ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å˜ä½“ãƒ†ã‚¹ãƒˆ100%ãƒ‘ã‚¹

---

#### 1-2. å…¨è·å“¡ãƒªã‚¹ãƒˆå–å¾—API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/v2/employees`

**å®Ÿè£…çŠ¶æ³**: âœ… **Phase 1å®Ÿè£…æ¸ˆã¿**ï¼ˆ2025å¹´9æœˆ20æ—¥ï¼‰

**å®Ÿè£…ç®‡æ‰€**: [src/app/api/v2/employees/route.ts](../../src/app/api/v2/employees/route.ts)

**èªè¨¼æ–¹å¼**: Bearer Tokenï¼ˆJWTï¼‰

**å¿…è¦æ¨©é™**: Level 99ï¼ˆã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ï¼‰

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `updatedSince`: ISO 8601 DateTimeï¼ˆæŒ‡å®šæ—¥æ™‚ä»¥é™ã«æ›´æ–°ã•ã‚ŒãŸè·å“¡ã®ã¿å–å¾—ï¼‰
- `page`: Numberï¼ˆãƒšãƒ¼ã‚¸ç•ªå·ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1ï¼‰
- `limit`: Numberï¼ˆ1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100ã€æœ€å¤§: 500ï¼‰
- `facilityId`: Stringï¼ˆæ–½è¨­IDã§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
- `status`: Stringï¼ˆ'active', 'leave', 'retired'ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**:
```json
{
  "employees": [
    {
      "employeeId": "E001",
      "name": "å±±ç”°å¤ªéƒ",
      "email": "yamada@example.com",
      "department": "åŒ»ç™‚ç™‚é¤Šç—…æ£Ÿ",
      "position": "çœ‹è­·å¸«é•·",
      "professionCategory": "nursing",  // â† Phase 2.18ã§å®Ÿè£…å®Œäº†
      "facilityId": "tategami-hospital",
      "permissionLevel": 7,
      "accountType": "NURSE",
      "canPerformLeaderDuty": false,
      "parentId": "sup-001",
      "isActive": true,
      "isRetired": false,
      "retirementDate": null,
      "hireDate": "2020-04-01T00:00:00Z",
      "updatedAt": "2025-10-27T10:00:00Z"
    }
    // ... ä»–ã®è·å“¡ãƒ‡ãƒ¼ã‚¿
  ],
  "pagination": {
    "page": 1,
    "limit": 100,
    "totalCount": 245,
    "totalPages": 3,
    "hasNext": true
  }
}
```

**ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å˜ä½“ãƒ†ã‚¹ãƒˆ100%ãƒ‘ã‚¹

---

## è³ªå•2: professionCategory ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æä¾›

### å›ç­”: âœ… **æœ¬æ—¥å®Ÿè£…å®Œäº†**ï¼ˆPhase 2.18 - 2025å¹´10æœˆ27æ—¥ï¼‰

#### å®Ÿè£…å†…å®¹

**å¤‰æ›é–¢æ•°å®Ÿè£…ç®‡æ‰€**:
- [src/app/api/v2/employees/[employeeId]/route.ts](../../src/app/api/v2/employees/[employeeId]/route.ts) 19-71è¡Œç›®
- [src/app/api/v2/employees/route.ts](../../src/app/api/v2/employees/route.ts) 19-71è¡Œç›®

**å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯**: `Position.accountType` â†’ `professionCategory`

#### ã‚µãƒãƒ¼ãƒˆã™ã‚‹ professionCategory å€¤

| professionCategory | èª¬æ˜ | å¯¾å¿œã™ã‚‹ accountType |
|-------------------|------|-------------------|
| `'nursing'` | çœ‹è­·è· | NURSE, NURSE_MANAGER, NURSING_DIRECTOR, CARE_WORKER, CARE_MANAGER |
| `'medical'` | åŒ»å¸« | DOCTOR, MEDICAL_DIRECTOR, PHARMACIST, RADIOLOGIST, LAB_TECHNICIAN |
| `'rehabilitation'` | ãƒªãƒãƒ“ãƒªè· | THERAPIST, PHYSICAL_THERAPIST, OCCUPATIONAL_THERAPIST, SPEECH_THERAPIST |
| `'administrative'` | äº‹å‹™è· | ADMIN, CLERK |
| `'support'` | ã‚µãƒãƒ¼ãƒˆè· | DIETITIAN, MEDICAL_SOCIAL_WORKER |
| `'management'` | ç®¡ç†è· | CHAIRMAN, DIRECTOR, DEPARTMENT_HEAD, MANAGER |
| `'other'` | ãã®ä»– | ä¸Šè¨˜ä»¥å¤–ã®accountType |

#### å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ä¾‹

```typescript
function convertAccountTypeToProfessionCategory(accountType: string): string {
  const mapping: Record<string, string> = {
    // çœ‹è­·è·
    'NURSE': 'nursing',
    'NURSE_MANAGER': 'nursing',
    'NURSING_DIRECTOR': 'nursing',

    // åŒ»å¸«
    'DOCTOR': 'medical',
    'MEDICAL_DIRECTOR': 'medical',

    // ä»‹è­·è·
    'CARE_WORKER': 'nursing',
    'CARE_MANAGER': 'nursing',

    // ãƒªãƒãƒ“ãƒªè·
    'THERAPIST': 'rehabilitation',
    'PHYSICAL_THERAPIST': 'rehabilitation',
    'OCCUPATIONAL_THERAPIST': 'rehabilitation',
    'SPEECH_THERAPIST': 'rehabilitation',

    // åŒ»ç™‚æŠ€è¡“è·
    'PHARMACIST': 'medical',
    'RADIOLOGIST': 'medical',
    'LAB_TECHNICIAN': 'medical',
    'DIETITIAN': 'support',
    'MEDICAL_SOCIAL_WORKER': 'support',

    // äº‹å‹™è·
    'ADMIN': 'administrative',
    'CLERK': 'administrative',

    // çµŒå–¶å±¤
    'CHAIRMAN': 'management',
    'DIRECTOR': 'management',
    'DEPARTMENT_HEAD': 'management',
    'MANAGER': 'management',
  };

  return mapping[accountType] || 'other';
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç¢ºèª

**å€‹åˆ¥è·å“¡å–å¾—API**ï¼ˆGET /api/v2/employees/:employeeIdï¼‰:
```json
{
  "professionCategory": "nursing"  // â† 97è¡Œç›®ã§å®Ÿè£…å®Œäº†
}
```

**å…¨è·å“¡å–å¾—API**ï¼ˆGET /api/v2/employeesï¼‰:
```json
{
  "employees": [
    {
      "professionCategory": "nursing"  // â† 161è¡Œç›®ã§å®Ÿè£…å®Œäº†
    }
  ]
}
```

#### VoiceDriveãƒãƒ¼ãƒ ã¸ã®ç¢ºèªäº‹é …

**è³ªå•**: VoiceDriveå´ã®æœŸå¾…å€¤ã¨åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®å®Ÿè£…å€¤ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚

VoiceDriveãƒãƒ¼ãƒ ãŒæœŸå¾…ã—ã¦ã„ã‚‹ professionCategory å€¤:
```typescript
// VoiceDriveå´ã®å‹å®šç¾©ï¼ˆæ¨æ¸¬ï¼‰
type ProfessionCategory =
  | 'nursing'
  | 'medical'
  | 'administrative'
  | 'rehabilitation'
  | 'support'
  | 'management'
  | 'other';
```

åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®å®Ÿè£…å€¤:
- âœ… `'nursing'` - çœ‹è­·è·
- âœ… `'medical'` - åŒ»å¸«
- âœ… `'administrative'` - äº‹å‹™è·
- âœ… `'rehabilitation'` - ãƒªãƒãƒ“ãƒªè·
- âœ… `'support'` - ã‚µãƒãƒ¼ãƒˆè·
- âœ… `'management'` - ç®¡ç†è·
- âœ… `'other'` - ãã®ä»–

**ç¢ºèªçµæœ**: âœ… **å®Œå…¨ä¸€è‡´**

---

## è³ªå•3: Webhookå®Ÿè£…ã®ç¢ºèª

### å›ç­”: âœ… **Phase 3ã§å®Ÿè£…å®Œäº†**ï¼ˆ2025å¹´10æœˆ2æ—¥ï¼‰

#### å®Ÿè£…çŠ¶æ³

**å®Ÿè£…ç®‡æ‰€**: [src/services/webhook-notification.service.ts](../../src/services/webhook-notification.service.ts)

**å®Ÿè£…å†…å®¹**:
1. âœ… `employee.created` - è·å“¡æ–°è¦ç™»éŒ²æ™‚
2. âœ… `employee.updated` - è·å“¡æƒ…å ±å¤‰æ›´æ™‚
3. âœ… `employee.deleted` - è·å“¡é€€è·æ™‚
4. âœ… ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•: 1ç§’ â†’ 2ç§’ â†’ 3ç§’ï¼‰
5. âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡ï¼ˆ5ç§’ï¼‰
6. âœ… ãƒãƒƒãƒé€ä¿¡å¯¾å¿œï¼ˆæœ€å¤§10ä»¶ä¸¦åˆ—ï¼‰

#### Webhooké€ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**VoiceDriveå´ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST https://voicedrive.ai/api/webhooks/employee-updated`

**ç’°å¢ƒå¤‰æ•°è¨­å®š**:
```env
VOICEDRIVE_WEBHOOK_URL=https://voicedrive.ai/api/webhooks/employee-updated
WEBHOOK_API_KEY=<VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰æä¾›ã•ã‚Œã‚‹APIã‚­ãƒ¼>
```

#### Webhookãƒšã‚¤ãƒ­ãƒ¼ãƒ‰å½¢å¼

**employee.updated ã‚¤ãƒ™ãƒ³ãƒˆ**:
```json
{
  "eventType": "employee.updated",
  "timestamp": "2025-10-27T10:30:00Z",
  "data": {
    "staffId": "E001",
    "facilityId": "tategami-hospital",
    "changes": {
      "position": "çœ‹è­·å¸«é•·",
      "accountLevel": 7,
      "effectiveDate": "2025-10-27T00:00:00Z"
    },
    "previousState": {
      "facilityId": "tategami-hospital",
      "position": "çœ‹è­·å¸«",
      "accountLevel": 5
    }
  }
}
```

**employee.created ã‚¤ãƒ™ãƒ³ãƒˆ**:
```json
{
  "eventType": "employee.created",
  "timestamp": "2025-10-27T10:30:00Z",
  "data": {
    "staffId": "E002",
    "facilityId": "obara-hospital",
    "changes": {
      "position": "çœ‹è­·å¸«",
      "accountLevel": 5,
      "effectiveDate": "2025-10-27T00:00:00Z"
    }
  }
}
```

**employee.deleted ã‚¤ãƒ™ãƒ³ãƒˆ**:
```json
{
  "eventType": "employee.deleted",
  "timestamp": "2025-10-27T10:30:00Z",
  "data": {
    "staffId": "E001",
    "facilityId": "tategami-hospital"
  }
}
```

#### èªè¨¼æ–¹å¼

**ãƒ˜ãƒƒãƒ€ãƒ¼**:
```http
Content-Type: application/json
Authorization: Bearer <WEBHOOK_API_KEY>
X-Webhook-Version: 1.0
X-Event-Type: employee.updated
```

#### ãƒªãƒˆãƒ©ã‚¤ãƒãƒªã‚·ãƒ¼

**æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°**: 3å›

**ãƒªãƒˆãƒ©ã‚¤é–“éš”**:
- 1å›ç›®: 1ç§’å¾Œ
- 2å›ç›®: 2ç§’å¾Œ
- 3å›ç›®: 3ç§’å¾Œ

**ãƒªãƒˆãƒ©ã‚¤ã—ãªã„æ¡ä»¶**:
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ 4xxï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ï¼‰

#### ãƒ†ã‚¹ãƒˆçµæœ

**Phase 3çµ±åˆãƒ†ã‚¹ãƒˆ**: âœ… **15/15æˆåŠŸ**ï¼ˆ100%ï¼‰

**ãƒ†ã‚¹ãƒˆé …ç›®**:
1. âœ… è·å“¡æ–°è¦ç™»éŒ²æ™‚ã®Webhooké€ä¿¡
2. âœ… è·å“¡æƒ…å ±å¤‰æ›´æ™‚ã®Webhooké€ä¿¡
3. âœ… éƒ¨ç½²ç•°å‹•æ™‚ã®Webhooké€ä¿¡
4. âœ… å½¹è·å¤‰æ›´æ™‚ã®Webhooké€ä¿¡
5. âœ… æ¨©é™ãƒ¬ãƒ™ãƒ«å¤‰æ›´æ™‚ã®Webhooké€ä¿¡
6. âœ… æ–½è¨­é–“ç•°å‹•æ™‚ã®Webhooké€ä¿¡
7. âœ… è·å“¡é€€è·æ™‚ã®Webhooké€ä¿¡
8. âœ… ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹ã®å‹•ä½œç¢ºèª
9. âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡ã®å‹•ä½œç¢ºèª
10. âœ… ãƒãƒƒãƒé€ä¿¡ã®å‹•ä½œç¢ºèª

**å‚ç…§**: [docs/Phase3_å®Ÿè£…ä½œæ¥­å®Œäº†å ±å‘Šæ›¸_FINAL.md](../../docs/Phase3_å®Ÿè£…ä½œæ¥­å®Œäº†å ±å‘Šæ›¸_FINAL.md)

#### VoiceDriveãƒãƒ¼ãƒ ã¸ã®ç¢ºèªäº‹é …

**è³ªå•1**: Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ
- VoiceDriveå´: `POST /api/webhooks/employee-updated`

**è³ªå•2**: Webhookç½²åæ¤œè¨¼ã¯å¿…è¦ã§ã™ã‹ï¼Ÿ
- åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§HMAC-SHA256ç½²åã‚’è¿½åŠ å®Ÿè£…å¯èƒ½ã§ã™ï¼ˆPhase 2.5å®Ÿè£…æ¸ˆã¿ã®æ–¹å¼ï¼‰

**è³ªå•3**: APIã‚­ãƒ¼ï¼ˆWEBHOOK_API_KEYï¼‰ã¯ã©ã“ã§å–å¾—ã§ãã¾ã™ã‹ï¼Ÿ

---

## è³ªå•4: ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®ç¢ºèª

### å›ç­”: âœ… **å…¨ã¦å­˜åœ¨**

åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã®Prisma Schemaã§ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å­˜åœ¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

#### 4-1. Employeeãƒ†ãƒ¼ãƒ–ãƒ«

**å®Ÿè£…ç®‡æ‰€**: [prisma/schema.prisma](../../prisma/schema.prisma) 65-111è¡Œç›®

**å­˜åœ¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ | VoiceDriveãƒãƒƒãƒ”ãƒ³ã‚° |
|-----------|-----|------|-------------------|
| `employeeCode` | String | è·å“¡ã‚³ãƒ¼ãƒ‰ï¼ˆuniqueï¼‰ | âœ… `User.employeeId` |
| `name` | String | æ°å | âœ… `User.name` |
| `email` | String | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | âœ… `User.email` |
| `departmentId` | String | éƒ¨ç½²ID | âœ… `User.department`ï¼ˆJOINï¼‰ |
| `positionId` | String | å½¹è·ID | âœ… `User.professionCategory`ï¼ˆå¤‰æ›ï¼‰ |
| `permissionLevel` | Int | æ¨©é™ãƒ¬ãƒ™ãƒ«ï¼ˆ1-25ï¼‰ | âœ… `User.permissionLevel` |
| `facilityId` | String | æ–½è¨­ID | âœ… `User.facilityId` |
| `supervisorId` | String | ä¸Šå¸ID | âœ… `User.parentId` |
| `status` | String | 'active', 'leave', 'retired' | âœ… `User.isActive`, `User.isRetired` |
| `retiredAt` | DateTime | é€€è·æ—¥ | âœ… `User.retirementDate` |
| `hireDate` | DateTime | å…¥ç¤¾æ—¥ | âœ… `User.hireDate` |
| `updatedAt` | DateTime | æ›´æ–°æ—¥æ™‚ | âœ… `User.updatedAt` |

**Prisma SchemaæŠœç²‹**:
```prisma
model Employee {
  id              String    @id @default(cuid())
  employeeCode    String    @unique              // â†’ VoiceDrive User.employeeId
  name            String                         // â†’ VoiceDrive User.name
  email           String    @unique              // â†’ VoiceDrive User.email
  departmentId    String                         // â†’ Department.name
  positionId      String                         // â†’ Position.accountType â†’ professionCategory
  facilityId      String
  supervisorId    String?                        // â†’ VoiceDrive User.parentId
  permissionLevel Int       @default(1)          // â†’ VoiceDrive User.permissionLevel
  status          String    @default("active")   // active, leave, retired
  retiredAt       DateTime?
  hireDate        DateTime
  updatedAt       DateTime  @updatedAt

  department   Department @relation(fields: [departmentId], references: [id])
  position     Position   @relation(fields: [positionId], references: [id])
  facility     Facility   @relation(fields: [facilityId], references: [id])
  supervisor   Employee?  @relation("EmployeeHierarchy", fields: [supervisorId], references: [id])
}
```

---

#### 4-2. Departmentãƒ†ãƒ¼ãƒ–ãƒ«

**å®Ÿè£…ç®‡æ‰€**: [prisma/schema.prisma](../../prisma/schema.prisma) 31-47è¡Œç›®

**å­˜åœ¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ | VoiceDriveãƒãƒƒãƒ”ãƒ³ã‚° |
|-----------|-----|------|-------------------|
| `id` | String | éƒ¨ç½²ID | - |
| `code` | String | éƒ¨ç½²ã‚³ãƒ¼ãƒ‰ï¼ˆuniqueï¼‰ | - |
| `name` | String | éƒ¨ç½²å | âœ… `User.department` |
| `facilityId` | String | æ–½è¨­ID | - |
| `parentId` | String | è¦ªéƒ¨ç½²ID | - |
| `level` | Int | éšå±¤ãƒ¬ãƒ™ãƒ« | - |

**Prisma SchemaæŠœç²‹**:
```prisma
model Department {
  id         String   @id @default(cuid())
  code       String   @unique
  name       String                            // â†’ VoiceDrive User.department
  facilityId String
  parentId   String?  // è¦ªéƒ¨ç½²IDï¼ˆéšå±¤æ§‹é€ ï¼‰
  level      Int      // éšå±¤ãƒ¬ãƒ™ãƒ«

  facility   Facility     @relation(fields: [facilityId], references: [id])
  parent     Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children   Department[] @relation("DepartmentHierarchy")
  employees  Employee[]   // æ‰€å±è·å“¡ãƒªã‚¹ãƒˆ
}
```

---

#### 4-3. Positionãƒ†ãƒ¼ãƒ–ãƒ«

**å®Ÿè£…ç®‡æ‰€**: [prisma/schema.prisma](../../prisma/schema.prisma) 49-62è¡Œç›®

**å­˜åœ¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ | VoiceDriveãƒãƒƒãƒ”ãƒ³ã‚° |
|-----------|-----|------|-------------------|
| `id` | String | å½¹è·ID | - |
| `code` | String | å½¹è·ã‚³ãƒ¼ãƒ‰ï¼ˆuniqueï¼‰ | - |
| `name` | String | å½¹è·å | âœ… `User.position` |
| `accountType` | String | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¨®åˆ¥ | âœ… `User.professionCategory`ï¼ˆå¤‰æ›ï¼‰ |
| `level` | Int | è·ä½ãƒ¬ãƒ™ãƒ« | - |

**Prisma SchemaæŠœç²‹**:
```prisma
model Position {
  id           String   @id @default(cuid())
  code         String   @unique
  name         String                         // â†’ VoiceDrive User.position
  level        Int      // è·ä½ãƒ¬ãƒ™ãƒ«ï¼ˆæ¨©é™ç®¡ç†ç”¨ï¼‰
  accountType  String   // CHAIRMAN, DIRECTOR, NURSEç­‰ â†’ professionCategoryå¤‰æ›

  employees Employee[]
}
```

**accountType â†’ professionCategory å¤‰æ›ä¾‹**:
- `'NURSE'` â†’ `'nursing'`
- `'DOCTOR'` â†’ `'medical'`
- `'ADMIN'` â†’ `'administrative'`
- `'THERAPIST'` â†’ `'rehabilitation'`
- `'DIETITIAN'` â†’ `'support'`
- `'DIRECTOR'` â†’ `'management'`

---

## ğŸ“Š å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼

### å®Ÿè£…å®Œäº†äº‹é …

| é …ç›® | çŠ¶æ…‹ | å®Ÿè£…æ—¥ | å‚™è€ƒ |
|------|------|--------|------|
| APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£… | âœ… **å®Œäº†** | 2025/09/20 | Phase 1å®Ÿè£…å®Œäº† |
| professionCategoryå®Ÿè£… | âœ… **å®Œäº†** | 2025/10/27 | Phase 2.18ã§å®Ÿè£…å®Œäº† |
| Webhookå®Ÿè£… | âœ… **å®Œäº†** | 2025/10/02 | Phase 3å®Ÿè£…å®Œäº† |
| ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ç¢ºèª | âœ… **å®Œäº†** | æ—¢å­˜å®Ÿè£… | Prisma Schemaã§ç¢ºèª |

### ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å­˜åœ¨ç¢ºèª

| ãƒ†ãƒ¼ãƒ–ãƒ« | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | çŠ¶æ…‹ | VoiceDriveãƒãƒƒãƒ”ãƒ³ã‚° |
|---------|-----------|------|-------------------|
| Employee | employeeCode | âœ… å­˜åœ¨ | User.employeeId |
| Employee | permissionLevel | âœ… å­˜åœ¨ | User.permissionLevel |
| Department | name | âœ… å­˜åœ¨ | User.department |
| Position | accountType | âœ… å­˜åœ¨ | User.professionCategoryï¼ˆå¤‰æ›ï¼‰ |

### APIå®Ÿè£…çŠ¶æ³

| API | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | çŠ¶æ…‹ | professionCategory |
|-----|--------------|------|--------------------|
| å€‹åˆ¥è·å“¡å–å¾— | GET /api/v2/employees/:id | âœ… å®Ÿè£…æ¸ˆã¿ | âœ… æä¾›ä¸­ |
| å…¨è·å“¡å–å¾— | GET /api/v2/employees | âœ… å®Ÿè£…æ¸ˆã¿ | âœ… æä¾›ä¸­ |

### Webhookå®Ÿè£…çŠ¶æ³

| ã‚¤ãƒ™ãƒ³ãƒˆ | çŠ¶æ…‹ | ãƒ†ã‚¹ãƒˆçµæœ |
|---------|------|-----------|
| employee.created | âœ… å®Ÿè£…æ¸ˆã¿ | âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ |
| employee.updated | âœ… å®Ÿè£…æ¸ˆã¿ | âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ |
| employee.deleted | âœ… å®Ÿè£…æ¸ˆã¿ | âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ |

---

## ğŸ“ VoiceDriveãƒãƒ¼ãƒ ã¸ã®ç¢ºèªä¾é ¼äº‹é …

### 1. Webhookå—ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æº–å‚™

VoiceDriveå´ã§ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…æ¸ˆã¿ã‹ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/webhooks/employee-updated`

**æœŸå¾…ã™ã‚‹å‡¦ç†**:
1. HMAC-SHA256ç½²åæ¤œè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
2. `User`ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
3. HomePageãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼

### 2. ç’°å¢ƒå¤‰æ•°ã®å…±æœ‰

åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```env
VOICEDRIVE_WEBHOOK_URL=https://voicedrive.ai/api/webhooks/employee-updated
WEBHOOK_API_KEY=<VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰æä¾›>
```

**è³ªå•**: `WEBHOOK_API_KEY`ã¯ã©ã“ã§å–å¾—ã§ãã¾ã™ã‹ï¼Ÿ

### 3. professionCategoryå€¤ã®ç¢ºèª

VoiceDriveå´ã®å‹å®šç¾©ã¨åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã®å®Ÿè£…å€¤ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚

**åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´å®Ÿè£…å€¤**:
- `'nursing'` - çœ‹è­·è·
- `'medical'` - åŒ»å¸«
- `'rehabilitation'` - ãƒªãƒãƒ“ãƒªè·
- `'administrative'` - äº‹å‹™è·
- `'support'` - ã‚µãƒãƒ¼ãƒˆè·
- `'management'` - ç®¡ç†è·
- `'other'` - ãã®ä»–

**è³ªå•**: VoiceDriveå´ã®æœŸå¾…å€¤ã¨ä¸€è‡´ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ

### 4. çµ±åˆãƒ†ã‚¹ãƒˆæ—¥ç¨‹ã®èª¿æ•´

**ææ¡ˆæ—¥ç¨‹**: 2025å¹´11æœˆ1æ—¥ï¼ˆé‡‘ï¼‰ã€œ 11æœˆ8æ—¥ï¼ˆé‡‘ï¼‰

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
1. è·å“¡æƒ…å ±å–å¾—ãƒ†ã‚¹ãƒˆï¼ˆAPIå‹•ä½œç¢ºèªï¼‰
2. HomePageåˆå›è¡¨ç¤ºãƒ†ã‚¹ãƒˆï¼ˆVoiceDriveå®Ÿè£…å¾Œï¼‰
3. Webhooké€£æºãƒ†ã‚¹ãƒˆï¼ˆè·å“¡æƒ…å ±å¤‰æ›´ â†’ HomePageå³æ™‚æ›´æ–°ï¼‰
4. æŠ•ç¨¿ãƒ»æŠ•ç¥¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆVoiceDriveå˜ç‹¬ï¼‰

**æ¨å®šå·¥æ•°**: 1æ—¥

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
1. [Phase3_å®Ÿè£…ä½œæ¥­å®Œäº†å ±å‘Šæ›¸_FINAL.md](../../docs/Phase3_å®Ÿè£…ä½œæ¥­å®Œäº†å ±å‘Šæ›¸_FINAL.md) - Webhookå®Ÿè£…è©³ç´°
2. [prisma/schema.prisma](../../prisma/schema.prisma) - åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ DBã‚¹ã‚­ãƒ¼ãƒ
3. [src/app/api/v2/employees/[employeeId]/route.ts](../../src/app/api/v2/employees/[employeeId]/route.ts) - è·å“¡APIå®Ÿè£…
4. [src/services/webhook-notification.service.ts](../../src/services/webhook-notification.service.ts) - Webhookå®Ÿè£…

### VoiceDriveå®Ÿè£…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆå‚ç…§ï¼‰
1. [HomePageæš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ](./HomePage_æš«å®šãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆ_20251027.md) - ãƒ‡ãƒ¼ã‚¿é …ç›®å®šç¾©
2. [HomePage_DBè¦ä»¶åˆ†æ_20251027.md](./HomePage_DBè¦ä»¶åˆ†æ_20251027.md) - DBè¦ä»¶åˆ†æ
3. [HomePage_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251027.md](./HomePage_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251027.md) - ç¢ºèªçµæœå ±å‘Šæ›¸

---

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ ã®å¯¾å¿œ

âœ… **å¯¾å¿œå®Œäº†**: professionCategoryå®Ÿè£…å®Œäº†ï¼ˆ2025å¹´10æœˆ27æ—¥ï¼‰

**å®Ÿæ–½äº‹é …**:
1. âœ… professionCategoryå¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
2. âœ… å€‹åˆ¥è·å“¡å–å¾—APIä¿®æ­£
3. âœ… å…¨è·å“¡å–å¾—APIä¿®æ­£
4. âœ… æœ¬å›ç­”æ›¸ã®VoiceDriveãƒãƒ¼ãƒ ã¸ã®é€ä»˜

---

### VoiceDriveãƒãƒ¼ãƒ ã®å¯¾å¿œï¼ˆå‚è€ƒï¼‰

**æ¨å¥¨å®Ÿè£…**:
1. â³ Webhookå—ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
2. â³ Userã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…
3. â³ HomePageãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰è§£é™¤ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿åˆ‡ã‚Šæ›¿ãˆï¼‰

**æ¨å®šå·¥æ•°**: 2-3æ—¥

---

### çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆä¸¡ãƒãƒ¼ãƒ åˆåŒï¼‰

**ãƒ†ã‚¹ãƒˆæ—¥ç¨‹**: 2025å¹´11æœˆ1æ—¥ï¼ˆé‡‘ï¼‰ã€œ 11æœˆ8æ—¥ï¼ˆé‡‘ï¼‰

**æ¨å®šå·¥æ•°**: 1æ—¥

---

**æ–‡æ›¸çµ‚äº†**

æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ27æ—¥
ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0
æ‰¿èª: æœªæ‰¿èªï¼ˆVoiceDriveãƒãƒ¼ãƒ ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ï¼‰
æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼: VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å—é ˜å¾Œ
