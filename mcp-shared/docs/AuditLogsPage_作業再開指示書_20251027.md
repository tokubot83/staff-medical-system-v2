# admin/audit-logs 作業再開指示書

**文書番号**: MED-RESUME-2025-1027-010
**作成日**: 2025年10月27日
**作成者**: 医療システムチーム
**宛先**: VoiceDriveチーム
**件名**: admin/audit-logs Phase 4 作業再開依頼および環境変数提供
**重要度**: 🟡 中（マスタープラン実行時に発行）

---

## 📋 目次

1. [作業再開指示の背景](#作業再開指示の背景)
2. [提供する環境変数情報](#提供する環境変数情報)
3. [作業再開スケジュール](#作業再開スケジュール)
4. [動作確認依頼事項](#動作確認依頼事項)
5. [連絡体制](#連絡体制)

---

## 作業再開指示の背景

### 現在の状況（2025年10月27日時点）

**VoiceDrive側の実装状況**:
- ✅ Phase 1（基本機能）: 完了（10/27）
- ✅ Phase 2（セキュリティ）: 完了（10/28-10/31）
- ✅ Phase 3（最適化+通知）: 完了（11/1-11/4）
- ⏳ Phase 4（総合テスト）: **作業再開待ち**

**医療システム側の実装状況**:
- ✅ 基本対応完了（既存AuditLog継続運用）
- ⏳ 通知設定作業: **マスタープラン実行時に実施予定**

### 延期判断の理由（10/27時点）

1. **実際のニーズに基づいた設定**
   - VoiceDrive側のPhase 4完了後に実施が効率的
   - 実際の通知頻度・内容を確認してから本格設定

2. **優先度の整理**
   - 他のPhase実装を優先
   - admin/audit-logsは優先度🟢最低

3. **工数の効率化**
   - 本番環境デプロイ前に設定しても使われない

---

## 提供する環境変数情報

### 作業再開時に提供する情報

医療システムチームは、以下の環境変数情報をVoiceDriveチームへ提供します。

#### 1. Slack Webhook URL（必須）

**環境変数名**: `MEDICAL_SYSTEM_SLACK_WEBHOOK_URL`

**取得方法**:
1. Slackワークスペース管理画面へアクセス
2. Apps > Incoming Webhooks を追加
3. 通知先チャンネル（`#security-alerts`）を選択
4. Webhook URLを取得

**形式例**:
```
https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
```

**工数**: 0.5時間（無料）

---

#### 2. セキュリティ担当メールアドレス（必須）

**環境変数名**: `MEDICAL_SYSTEM_SECURITY_EMAIL`

**設定内容**:
- セキュリティ専用メールアドレスまたはメーリングリスト
- 推奨: `security-alerts@medical-system.example.com`

**形式例**:
```
security-alerts@medical-system.example.com
```

**工数**: 0.5時間

---

#### 3. Critical Alert追加受信者（任意）

**環境変数名**: `MEDICAL_SYSTEM_CRITICAL_ALERT_EMAILS`

**設定内容**:
- Critical severityのみの追加通知先
- CTO、セキュリティリードなど重要役職者向け
- カンマ区切りで複数指定可能

**形式例**:
```
cto@medical-system.com,security-lead@medical-system.com,admin@medical-system.com
```

**工数**: 0.5時間（任意）

---

### 情報提供テンプレート

```
==================================================
VoiceDrive監査ログ通知設定情報
==================================================

【必須】1. Slack Webhook URL
MEDICAL_SYSTEM_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...

【必須】2. セキュリティ担当メールアドレス
MEDICAL_SYSTEM_SECURITY_EMAIL=security-alerts@medical-system.example.com

【任意】3. Critical Alert追加受信者（カンマ区切り）
MEDICAL_SYSTEM_CRITICAL_ALERT_EMAILS=cto@medical-system.com,security-lead@medical-system.com

==================================================
提供日: [日付]
担当者: [医療システムチーム担当者名]
==================================================
```

---

### 提供方法

**推奨方法**: Slackダイレクトメッセージ
- VoiceDrive開発チーム担当者へDMで送信
- セキュリティ上、公開チャンネルは避ける

**代替方法**:
- 暗号化メール（PGP/GPG推奨）
- 社内セキュアファイル共有（`mcp-shared/logs/` フォルダ）

---

## 作業再開スケジュール

### 医療システム側の作業（合計3時間）

| # | 作業内容 | 工数 | 実施タイミング |
|---|---------|------|-------------|
| 1 | Slack Webhook URL発行 | 0.5時間 | マスタープラン実行決定後 |
| 2 | セキュリティメールアドレス設定 | 0.5時間 | マスタープラン実行決定後 |
| 3 | Critical Alert追加受信者決定 | 0.5時間 | マスタープラン実行決定後（任意） |
| 4 | 環境変数情報をVoiceDriveへ提供 | 0.5時間 | 上記完了後即座 |
| 5 | 通知テスト実施（受信確認） | 0.5時間 | VoiceDrive設定後 |
| 6 | インシデント対応フロー策定 | 2時間 | 通知テスト成功後 |

**合計工数**: 4.5時間（うち必須3.5時間）

---

### VoiceDrive側の作業（Phase 4再開）

| # | 作業内容 | 工数 | 前提条件 |
|---|---------|------|---------|
| 1 | 環境変数設定（`.env` ファイル） | 0.5時間 | 医療システムから情報受領 |
| 2 | Slack接続テスト | 0.5時間 | 環境変数設定完了 |
| 3 | メール接続テスト | 0.5時間 | 環境変数設定完了 |
| 4 | 統合テスト（実アラート送信） | 1日 | 接続テスト成功 |
| 5 | アーカイブ機能テスト | 1日 | - |
| 6 | パフォーマンステスト（100万件） | 1日 | - |
| 7 | 本番環境デプロイ準備 | 1日 | 全テスト成功 |

**合計工数**: 4日

---

### 統合スケジュール（マスタープラン実行時）

```
Week 1: 環境変数設定・接続テスト
┌─────────────────────────────────────────────┐
│ Day 1                                       │
│ - 医療システム: Slack/メール設定（3時間）      │
│ - 医療システム: 環境変数提供                 │
│ - VoiceDrive: 環境変数設定（0.5時間）        │
│ - VoiceDrive: 接続テスト（1時間）            │
└─────────────────────────────────────────────┘

Week 2: 統合テスト
┌─────────────────────────────────────────────┐
│ Day 2-3                                     │
│ - VoiceDrive: 実アラート送信テスト           │
│ - 医療システム: 通知受信確認（0.5時間）       │
│ - 医療システム: インシデント対応フロー策定（2時間）│
└─────────────────────────────────────────────┘

Week 3: パフォーマンステスト
┌─────────────────────────────────────────────┐
│ Day 4-5                                     │
│ - VoiceDrive: アーカイブ機能テスト           │
│ - VoiceDrive: パフォーマンステスト（100万件） │
└─────────────────────────────────────────────┘

Week 4: 本番デプロイ準備
┌─────────────────────────────────────────────┐
│ Day 6-7                                     │
│ - VoiceDrive: ドキュメント最終化             │
│ - VoiceDrive: 本番環境デプロイ準備           │
│ - 両チーム: デプロイ前レビュー               │
└─────────────────────────────────────────────┘

Week 5: 監視期間
┌─────────────────────────────────────────────┐
│ Day 8-14                                    │
│ - VoiceDrive: 本番環境デプロイ               │
│ - 両チーム: 監視期間（誤検知調整）           │
└─────────────────────────────────────────────┘
```

**合計期間**: 2-3週間

---

## 動作確認依頼事項

### VoiceDrive側で実施していただく動作確認

#### Step 1: Slack接続テスト

**実行コマンド**:
```bash
npx tsx -e "import('./src/services/SlackNotificationService').then(m => m.default.testConnection())"
```

**期待結果**:
- 医療システムの `#security-alerts` チャンネルにテストメッセージが表示される

**医療システム側確認事項**:
- ✅ Slackチャンネルにメッセージが届いているか
- ✅ メッセージ内容が読みやすいか
- ✅ フォーマットが適切か

---

#### Step 2: メール接続テスト

**実行コマンド**:
```bash
npx tsx -e "import('./src/services/EmailNotificationService').then(m => m.default.testConnection())"
```

**期待結果**:
- コンソールに設定されたメールアドレスが表示される
- 本番環境では実際にテストメールが送信される

**医療システム側確認事項**:
- ✅ テストメールが届いているか（本番環境のみ）
- ✅ メール内容が読みやすいか
- ✅ HTML形式が正しく表示されているか

---

#### Step 3: 統合テスト

**実行コマンド**:
```bash
npx tsx -e "import('./src/services/SecurityNotificationService').then(m => m.default.testAllChannels())"
```

**期待結果**:
```
[SecurityNotification] Testing all notification channels...
[SlackNotification] Test message sent successfully
[EmailNotification] Test email sent to: security@...
[SecurityNotification] Test results: Slack: true, Email: true
```

**医療システム側確認事項**:
- ✅ Slackとメール両方に届いているか
- ✅ 通知タイミングが適切か

---

#### Step 4: 実アラート送信テスト

VoiceDrive開発チームが実際のセキュリティアラートをテスト送信します。

**テストシナリオ**:
1. **Medium severity アラート** → Slackのみ
2. **High severity アラート** → Slack + メール
3. **Critical severity アラート** → Slack + メール（複数宛先）

**医療システム側確認事項**:
1. ✅ 各重要度で通知が正しく届いているか
2. ✅ 通知内容が適切か
3. ✅ アラート情報が十分か
4. ✅ リンクが正しく機能しているか（VoiceDrive管理画面への遷移）

---

### 医療システム側で実施する動作確認

#### 確認1: 通知受信テスト

**チェックリスト**:
```
[ ] Slackチャンネルにテストメッセージが届いた
[ ] Slackメッセージのフォーマットが適切
[ ] メールにテストメッセージが届いた（本番環境のみ）
[ ] メールのHTML形式が正しく表示された
[ ] Critical Alert追加受信者にメールが届いた（設定した場合）
```

---

#### 確認2: 実運用シミュレーション

**シナリオ**:
1. VoiceDrive側でCritical Alertを発生させる
2. 医療システムチームがSlack/メールで受信
3. インシデント対応フローに従って対応を記録
4. 対応完了をVoiceDriveチームへ連絡

**チェックリスト**:
```
[ ] 通知を5分以内に確認できた
[ ] 通知内容から重要度が判断できた
[ ] 推奨対応アクションが明確だった
[ ] VoiceDriveチームへの連絡がスムーズだった
[ ] 対応記録が適切に残せた
```

---

## 連絡体制

### VoiceDrive開発チーム

**技術担当**: [担当者名]
**Email**: [メールアドレス]
**Slack**: @voicedrive-dev

**対応時間**: 平日 9:00 - 18:00

---

### 医療システムチーム

**技術担当**: [担当者名]
**Email**: [メールアドレス]
**Slack**: @medical-system-team

**対応時間**: 平日 9:00 - 18:00

---

### 緊急連絡先（Critical Alert対応用）

**医療システム側**:
- セキュリティ責任者: [氏名] - [電話番号]
- 副責任者: [氏名] - [電話番号]

**VoiceDrive側**:
- 開発リード: [氏名] - [電話番号]

---

## 作業再開チェックリスト

### 医療システムチーム（再開前）

```
[ ] マスタープラン実行決定
[ ] Slack Webhook URL発行（0.5時間）
[ ] セキュリティメールアドレス設定（0.5時間）
[ ] Critical Alert追加受信者決定（0.5時間・任意）
[ ] 環境変数情報をVoiceDriveチームへ提供
[ ] 通知テスト実施日程の調整
```

---

### VoiceDriveチーム（再開時）

```
[ ] 医療システムから環境変数情報を受領
[ ] .envファイルに環境変数を設定
[ ] Slack接続テスト実施
[ ] メール接続テスト実施
[ ] 統合テスト実施
[ ] 実アラート送信テスト実施
[ ] 医療システムチームへ結果報告
```

---

### 両チーム（動作確認後）

```
[ ] 通知テスト結果の相互確認
[ ] インシデント対応フローの策定（医療システム側・2時間）
[ ] 運用マニュアルの最終化
[ ] 本番デプロイ日程の調整
[ ] cronスケジュール設定の確認
```

---

## 参照文書

### VoiceDrive側実装ドキュメント

1. **[admin_audit-logs_Phase2-3実装完了報告書_20251027.md](./admin_audit-logs_Phase2-3実装完了報告書_20251027.md)**
   - Phase 2-3実装の詳細報告
   - 統合テスト結果（13/13成功）

2. **[admin_audit-logs_最終実装計画書_20251027.md](./admin_audit-logs_最終実装計画書_20251027.md)**
   - Phase 1-4の詳細実装計画
   - 実装スケジュール

3. **[admin_audit-logs_環境変数設定ガイド_20251027.md](./admin_audit-logs_環境変数設定ガイド_20251027.md)**
   - 環境変数設定の詳細手順
   - トラブルシューティング

---

### 医療システム側確認ドキュメント

4. **[AuditLogsPage_医療システム確認結果_20251027.md](./AuditLogsPage_医療システム確認結果_20251027.md)**
   - 医療システム側の要件確認結果
   - 実装不要の判断根拠

5. **[Response_AuditLogsPage_VoiceDrive_Confirmation_20251027.md](./Response_AuditLogsPage_VoiceDrive_Confirmation_20251027.md)**
   - VoiceDriveチームからの質問への回答
   - Slack/メール通知詳細設定

---

### マスタープラン

6. **[lightsail-integration-master-plan-20251005-updated.md](./lightsail-integration-master-plan-20251005-updated.md)**
   - Phase 2.20: admin/audit-logs連携
   - バージョン 2.56（通知設定作業の延期決定）

---

## まとめ

### 作業再開の条件

1. ✅ **マスタープラン実行の決定**
2. ✅ **医療システム側の準備完了**（3時間の設定作業）
3. ✅ **環境変数情報のVoiceDriveチームへの提供**

### 作業再開後のスケジュール

**合計期間**: 2-3週間
- Week 1: 環境変数設定・接続テスト
- Week 2: 統合テスト
- Week 3: パフォーマンステスト
- Week 4: 本番デプロイ準備
- Week 5: 監視期間

### 連絡フロー

```
【マスタープラン実行決定】
        ↓
【医療システム: Slack/メール設定（3時間）】
        ↓
【医療システム → VoiceDrive: 環境変数提供】
        ↓
【VoiceDrive: 環境変数設定 → 接続テスト】
        ↓
【両チーム: 統合テスト実施】
        ↓
【医療システム: インシデント対応フロー策定（2時間）】
        ↓
【VoiceDrive: Phase 4完了 → 本番デプロイ】
```

---

## 発行タイミング

**この指示書は、マスタープラン実行決定時にVoiceDriveチームへ正式発行します。**

現時点（2025年10月27日）では、作業再開の準備資料として保管します。

---

**作成日**: 2025年10月27日
**作成者**: 医療システムチーム
**バージョン**: 1.0（ドラフト）
**次回更新**: マスタープラン実行決定時（正式発行）
