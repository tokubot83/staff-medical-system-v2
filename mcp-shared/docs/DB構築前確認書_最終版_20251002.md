# 職員カルテシステム データベース構築前 最終確認書

**文書番号**: DB-CHECK-2025-1002-001
**作成日**: 2025年10月2日
**作成者**: 医療システムチーム（Claude Code）
**対象**: 医療法人厚生会 事務局・VoiceDriveチーム
**重要度**: 🔴 最重要

---

## 📋 エグゼクティブサマリー

本文書は、職員カルテシステムのデータベース構築を開始する前に、**必ず確認・決定すべき事項**をまとめた最終確認書です。

### 🎯 目的
- データベース構築の可否判断
- 事務局からの職員情報提供依頼
- VoiceDriveチームとのDB統合方針確認
- 構築手順の合意形成

### ✅ 現在の準備状況
- **フロントエンド開発**: 80%完了（面談・評価・キャリアコースUI完成）
- **データベース設計**: 100%完了（ER図・テーブル定義・マイグレーション準備済み）
- **Phase 3実装**: 100%完了（施設別権限管理・テスト成功）
- **Phase 5実装**: データ構造100%完了（キャリアコース選択制度）

### 🚨 構築判断
**結論**: **段階的構築であれば実施可能**
**推奨アプローチ**: マスターデータから順次構築（Week 1-8計画）

---

## 第1部：システム概要（素人向け説明）

### 1.1 職員カルテシステムとは？

**簡単に言うと**：
「職員一人ひとりの情報を電子カルテのように管理するシステム」です。

#### 📊 管理する情報の種類

| カテゴリ | 具体例 | 紙の場合の問題 | システム化のメリット |
|---------|--------|---------------|---------------------|
| **基本情報** | 氏名、生年月日、連絡先、入職日 | 紙のファイルが散在、更新が大変 | 一元管理、即座に検索可能 |
| **配属情報** | 所属施設、部署、職位 | 異動のたびに書類作成 | 履歴が自動で残る |
| **面談記録** | 月次面談、キャリア相談の内容 | ファイルキャビネットに保管、探すのが大変 | いつでも過去の面談を振り返り可能 |
| **人事評価** | 年2回の評価結果、成長記録 | 評価シートを紙で保管 | グラフで成長が見える、比較分析可能 |
| **健康情報** | 健康診断、ストレスチェック結果 | 産業医の記録と別管理 | 健康リスクを早期発見 |
| **研修履歴** | 受講した研修、資格取得状況 | Excel管理、漏れが発生 | 自動でリマインド、計画的育成 |
| **キャリアコース** | A～Dコース選択（異動の可否等） | 紙の申請書 | オンライン申請、自動承認フロー |

#### 🏥 医療法人厚生会の3施設対応

```
医療法人厚生会
├─ 小原病院（obara-hospital）
│  └─ 9役職マッピング
├─ 立神リハビリテーション温泉病院（tategami-rehabilitation）
│  └─ 12役職マッピング（統括主任レベル7調整済み）
└─ エスポワール立神（espoir-tategami）
   └─ 統合作業完了
```

### 1.2 データベースとは？（超初心者向け説明）

**簡単に言うと**：
「Excelの超強力版」です。ただし、Excelと違って：

#### Excelとの違い

| 項目 | Excel | データベース（MySQL） |
|-----|-------|---------------------|
| **データ量** | 数千行まで（重くなる） | 数百万行でも高速 |
| **同時利用** | 1人が編集中は他の人が待つ | 500名が同時にアクセス可能 |
| **関連づけ** | 手動でVLOOKUP | 自動で関連データを取得 |
| **データの安全性** | 上書き保存で元に戻せない | 全ての変更履歴が残る |
| **検索速度** | フィルタで遅い | 瞬時に検索 |
| **バックアップ** | 手動でコピー | 自動で毎日バックアップ |

#### データベースのイメージ図

```
┌─────────────────────────────────────────────┐
│  職員カルテデータベース（staff_medical_system） │
├─────────────────────────────────────────────┤
│                                             │
│  📁 マスターデータ（基本情報）                 │
│  ├─ facilities（施設マスター）                │
│  ├─ departments（部署マスター）               │
│  └─ positions（職位マスター）                 │
│                                             │
│  👤 職員情報                                  │
│  ├─ staff_basic（基本情報：500名分）          │
│  ├─ staff_assignments（配属履歴）             │
│  └─ staff_career_courses（キャリアコース）    │
│                                             │
│  📝 面談・評価                                │
│  ├─ interviews（面談記録）                    │
│  ├─ interview_records（面談詳細）             │
│  ├─ evaluations（人事評価）                   │
│  └─ two_axis_evaluations（2軸評価）          │
│                                             │
│  🏥 健康管理                                  │
│  ├─ health_checkups（健康診断）               │
│  ├─ stress_checks（ストレスチェック）         │
│  └─ occupational_health_records（産業医記録） │
│                                             │
│  📚 研修・スキル                              │
│  ├─ training_programs（研修プログラム）       │
│  ├─ training_records（研修受講履歴）          │
│  └─ staff_skills（保有スキル）                │
│                                             │
└─────────────────────────────────────────────┘
```

### 1.3 なぜ今、データベースを構築するのか？

#### 現状の課題

1. **情報が散在**：紙・Excel・人事システム・VoiceDriveアプリがバラバラ
2. **二重入力**：同じ情報を複数箇所に入力（手間＋入力ミス）
3. **検索困難**：「過去の面談記録を見たい」→ファイルキャビネットを探す
4. **分析不可能**：「離職リスクが高い職員は？」→手作業で集計

#### データベース構築後のメリット

```mermaid
graph LR
    A[事務局が職員情報を1回入力] --> B[データベースに保存]
    B --> C[医療システムで表示]
    B --> D[VoiceDriveアプリで表示]
    B --> E[自動で分析レポート作成]
    B --> F[面談予約時に自動参照]
```

**結果**：
- ✅ 入力作業が80%削減
- ✅ 職員も自分のスマホで面談履歴を確認可能
- ✅ 人事部は離職リスク分析が自動化
- ✅ 紙のファイルキャビネットが不要に

---

## 第2部：DB構築前の確認事項（チェックリスト）

### 2.1 技術的確認事項

#### ✅ チェックリスト（開発チーム向け）

| No. | 確認項目 | 現状 | 必要なアクション | 担当 | 期限 |
|-----|---------|------|----------------|------|------|
| 1 | データベースサーバーの準備 | ⬜ 未確認 | AWS Lightsail申請または既存サーバー確認 | 医療チーム | 10/7 |
| 2 | MySQLバージョン確認 | ⬜ 未確認 | MySQL 8.0以上を推奨 | 医療チーム | 10/7 |
| 3 | データベース接続設定（.env） | ⬜ 未確認 | DATABASE_URLの設定 | 医療チーム | 10/9 |
| 4 | Prismaスキーマ確認 | ⬜ 未確認 | schema.prismaファイルの存在確認 | 医療チーム | 10/9 |
| 5 | バックアップ体制 | ⬜ 未確認 | 毎日自動バックアップの設定 | 医療チーム | 10/14 |
| 6 | ロールバック手順 | ⬜ 未作成 | 問題発生時の復旧手順書作成 | 医療チーム | 10/14 |
| 7 | VoiceDriveとの接続方法 | ⬜ 未確定 | 共通DBか独立DBか決定 | 両チーム | 10/9 |
| 8 | API実装状況確認 | ⬜ 未確認 | 未実装エンドポイントのリストアップ | 医療チーム | 10/11 |

#### 📋 詳細説明

##### 1. データベースサーバーの準備

**選択肢**：

**Option A: AWS Lightsail（推奨）**
```yaml
料金: 月額約$30（約¥4,500）
スペック:
  - Managed MySQL 8.0
  - 1GB RAM、40GB Storage
  - 自動バックアップ
  - SSL/TLS暗号化
  - 99.9%可用性保証
```

**Option B: 既存サーバー利用**
```
条件:
  - MySQL 8.0以上
  - 最低1GB RAM
  - 50GB以上の空き容量
  - 外部アクセス可能
  - バックアップ機能あり
```

**確認すべきこと**：
```bash
# MySQLバージョン確認
mysql --version

# 空き容量確認
df -h

# MySQL起動確認
sudo systemctl status mysql
```

##### 2. データベース接続設定（.env）

**必要な設定項目**：

```env
# データベース接続URL
DATABASE_URL="mysql://ユーザー名:パスワード@ホスト:3306/staff_medical_system"

# 例（開発環境）
DATABASE_URL="mysql://admin:password123@localhost:3306/staff_medical_system"

# 例（本番環境・AWS Lightsail）
DATABASE_URL="mysql://admin:SecureP@ssw0rd!@ls-abc123.xxx.rds.amazonaws.com:3306/staff_medical_system"

# バックアップ設定
BACKUP_PATH="/var/backups/staff_medical_system"
BACKUP_RETENTION_DAYS=90

# VoiceDrive連携設定
VOICEDRIVE_DB_URL="postgresql://voicedrive_user:password@voicedrive-db.local:5432/voicedrive"
VOICEDRIVE_API_KEY="vd_prod_key_XXXXX"
```

**セキュリティチェック**：
- ✅ パスワードは16文字以上
- ✅ 英数字+記号の組み合わせ
- ✅ `.env`ファイルは`.gitignore`に追加（GitHubにアップロードしない）
- ✅ 本番環境と開発環境で別のパスワード

##### 3. VoiceDriveとの接続方法

**選択肢**：

**パターンA: 共通データベース（マスタープラン推奨）**
```
┌──────────────────────────────────────┐
│   AWS Lightsail共通データベース      │
│   （MySQL 8.0）                      │
├──────────────────────────────────────┤
│  ↑                            ↑     │
│  │                            │     │
│  医療システム              VoiceDrive│
│  (Next.js)                (React)   │
└──────────────────────────────────────┘

メリット:
✅ データが1箇所に集約
✅ リアルタイム同期不要
✅ データ不整合が発生しない

デメリット:
⚠️ 両システムのDB設計統一が必要
⚠️ 移行作業が必要
```

**パターンB: 独立データベース + API連携（現状）**
```
┌─────────────────┐      API      ┌─────────────────┐
│  医療システムDB  │◄──────────────►│ VoiceDriveDB    │
│  (MySQL)        │   Webhook     │ (PostgreSQL?)   │
└─────────────────┘               └─────────────────┘

メリット:
✅ 既存システムをそのまま利用
✅ 段階的移行が可能

デメリット:
⚠️ データ同期ズレのリスク
⚠️ API開発コストが高い
```

**🎯 推奨**：まずパターンBで構築開始、Phase 4で共通DBに移行

### 2.2 事務局への職員情報提供依頼

#### 📊 必要な職員情報一覧

以下の情報を**Excelファイル**または**CSV形式**で提供してください。

##### 【必須項目】基本情報（全職員）

| No. | 項目名 | 説明 | 例 | 備考 |
|-----|--------|------|-----|------|
| 1 | 職員番号 | 社員番号・職員ID | EMP001 | **重複不可**・一意である必要 |
| 2 | 氏名（姓） | 姓 | 山田 | 全角カタカナ・漢字 |
| 3 | 氏名（名） | 名 | 太郎 | 全角カタカナ・漢字 |
| 4 | 氏名カナ（姓） | セイ | ヤマダ | 全角カタカナ |
| 5 | 氏名カナ（名） | メイ | タロウ | 全角カタカナ |
| 6 | 性別 | 性別 | 男 / 女 / その他 | いずれか選択 |
| 7 | 生年月日 | 生年月日 | 1985-04-15 | YYYY-MM-DD形式 |
| 8 | メールアドレス | 業務用メール | yamada@kosei.jp | **重複不可** |
| 9 | 電話番号 | 携帯電話 | 090-1234-5678 | ハイフン付き |
| 10 | 入職日 | 入社日 | 2020-04-01 | YYYY-MM-DD形式 |

##### 【必須項目】配属情報（全職員）

| No. | 項目名 | 説明 | 例 | 備考 |
|-----|--------|------|-----|------|
| 11 | 所属施設 | 現在の勤務施設 | 小原病院 | 施設名 |
| 12 | 所属部署 | 現在の所属部署 | 3階病棟 | 部署名 |
| 13 | 職位 | 現在の役職 | 看護師 | 職種・役職名 |
| 14 | 職位レベル | 権限レベル | 5 | 1～10の数字（下記参照） |
| 15 | 雇用形態 | 雇用形態 | 正社員 | 正社員/パート/契約/派遣 |
| 16 | 雇用状態 | 在籍状況 | 在籍中 | 在籍中/休職中/退職済み |

**職位レベル対応表**：

| レベル | 小原病院 | 立神リハビリ | 権限内容 |
|--------|---------|-------------|---------|
| L1 | 看護助手 | 看護助手 | 自分の情報のみ閲覧 |
| L2 | 看護師 | 看護師 | 自分の情報のみ閲覧 |
| L3 | 主任看護師 | 主任看護師 | 自分の情報のみ閲覧 |
| L4 | 課長 | 課長 | 自分の情報のみ閲覧 |
| L5 | 戦略企画部門員 | 戦略企画部門員 | 予約管理・スケジュール調整 |
| L6 | キャリア支援部門員 | キャリア支援部門員 | 面談実施・記録作成 |
| L7 | 看護部長 | **統括主任** | 部門職員の情報閲覧 |
| L8 | 統括管理部門長 | 統括管理部門長 | 全職員情報閲覧 |
| L9 | 副院長 | 副院長 | システム全体管理 |
| L10 | 院長 | 院長 | システム全体管理 |

##### 【任意項目】追加情報（可能な範囲で）

| No. | 項目名 | 説明 | 例 | 備考 |
|-----|--------|------|-----|------|
| 17 | 郵便番号 | 自宅住所の郵便番号 | 123-4567 | ハイフン付き |
| 18 | 住所 | 自宅住所 | 東京都渋谷区... | 都道府県から |
| 19 | 緊急連絡先氏名 | 緊急時の連絡先 | 山田花子（妻） | 続柄も記載 |
| 20 | 緊急連絡先電話 | 緊急時の連絡先電話 | 080-9876-5432 | ハイフン付き |
| 21 | 緊急連絡先続柄 | 続柄 | 配偶者 | 配偶者/親/子/兄弟等 |

##### 【Phase 5用】キャリアコース情報（可能な範囲で）

| No. | 項目名 | 説明 | 例 | 備考 |
|-----|--------|------|-----|------|
| 22 | 現在のキャリアコース | A～Dコース | B | A/B/C/Dのいずれか |
| 23 | コース選択日 | コース適用開始日 | 2024-04-01 | YYYY-MM-DD形式 |

**キャリアコース説明**：
- **Aコース（全面協力型）**: 施設間異動・転居可、管理職候補、基本給係数1.2
- **Bコース（施設内協力型）**: 施設内異動のみ、管理職候補、基本給係数1.1
- **Cコース（専門職型）**: 異動なし、夜勤選択可、基本給係数1.0
- **Dコース（時短・制約あり型）**: 育児・介護対応、夜勤なし、基本給係数0.9

#### 📥 データ提供形式

**推奨フォーマット**：Excel形式（.xlsx）

**サンプルファイル構造**：

```
職員マスターデータ.xlsx
├─ シート1: 基本情報
│  ├─ A列: 職員番号
│  ├─ B列: 姓
│  ├─ C列: 名
│  ├─ D列: 姓カナ
│  └─ ...（全22列）
│
├─ シート2: 施設マスター
│  ├─ A列: 施設コード（obara-hospital等）
│  ├─ B列: 施設名
│  └─ C列: 施設種別
│
├─ シート3: 部署マスター
│  ├─ A列: 部署コード
│  ├─ B列: 部署名
│  ├─ C列: 所属施設
│  └─ D列: 親部署（階層構造の場合）
│
└─ シート4: 職位マスター
   ├─ A列: 職位コード
   ├─ B列: 職位名
   ├─ C列: 職位レベル（1-10）
   └─ D列: 職種カテゴリ
```

**Excelサンプル（実際の見た目）**：

| 職員番号 | 姓 | 名 | 姓カナ | 名カナ | 性別 | 生年月日 | メール | 電話 | 入職日 | 施設 | 部署 | 職位 | レベル |
|---------|----|----|--------|--------|------|---------|--------|------|--------|------|------|------|--------|
| EMP001 | 山田 | 太郎 | ヤマダ | タロウ | 男 | 1985-04-15 | yamada@kosei.jp | 090-1234-5678 | 2020-04-01 | 小原病院 | 3階病棟 | 看護師 | 2 |
| EMP002 | 佐藤 | 花子 | サトウ | ハナコ | 女 | 1990-07-20 | sato@kosei.jp | 090-2345-6789 | 2021-05-10 | 小原病院 | 2階病棟 | 主任看護師 | 3 |
| EMP003 | 鈴木 | 一郎 | スズキ | イチロウ | 男 | 1975-12-03 | suzuki@kosei.jp | 090-3456-7890 | 2015-04-01 | 立神リハビリ | リハビリ科 | 統括主任 | 7 |

#### 📧 データ提供方法

**提出先**：医療システムチーム

**提出方法**：
1. **セキュアな方法（推奨）**：
   - パスワード付きZIPファイル
   - パスワードは別メールで送付
   - または、セキュアなファイル共有サービス（Google Drive等）

2. **ファイル名規則**：
   ```
   職員マスターデータ_YYYYMMDD_施設名.xlsx
   例：職員マスターデータ_20251002_小原病院.xlsx
   ```

3. **提出期限**：
   - 第1回提出：2025年10月9日（水）まで
   - 第2回確認：2025年10月16日（水）まで

#### 🔒 個人情報保護について

**事務局へのお願い**：

1. **データ暗号化**：
   - Excelファイルにパスワード設定
   - ZIP圧縮時もパスワード設定

2. **最小限の情報**：
   - 初期構築では基本情報のみ
   - 健康情報・評価情報は後日別途提供

3. **データ保持期間**：
   - システム構築期間中のみ保持
   - 構築完了後は安全に削除

4. **アクセス制限**：
   - データを扱うのは医療システムチーム2名のみ
   - アクセスログを記録

### 2.3 VoiceDriveチームへの確認事項

#### 📋 VoiceDriveチーム確認リスト

| No. | 確認項目 | 期限 | 回答欄 |
|-----|---------|------|--------|
| 1 | VoiceDrive側のデータベース種類（PostgreSQL/MySQL等） | 10/7 | ____________ |
| 2 | 共通データベース移行の可否 | 10/9 | ⬜ 可 / ⬜ 不可 |
| 3 | 職員マスターデータの保有状況 | 10/7 | ⬜ あり / ⬜ なし |
| 4 | VoiceDrive側の職員データ件数 | 10/7 | _____ 件 |
| 5 | アカウント作成API実装状況 | 10/11 | ⬜ 実装済み / ⬜ 未実装 |
| 6 | 面談サマリ受信API実装状況 | 10/7 | ✅ 実装済み（10/2確認） |
| 7 | 健康データ送信API実装状況 | 10/7 | ✅ 実装済み（9/30確認） |
| 8 | 共通DB構築後の作業開始可能日 | 10/14 | _____ 年 ___ 月 ___ 日 |

#### 🔧 技術的確認事項

**VoiceDriveチームに確認すべき技術仕様**：

1. **データベース情報**
   ```
   ・使用しているデータベース: ____________（PostgreSQL/MySQL/その他）
   ・バージョン: ____________
   ・職員マスターテーブル名: ____________
   ・職員ID（Primary Key）のカラム名: ____________
   ```

2. **API連携情報**
   ```
   ・ベースURL: ____________
   ・認証方式: ____________（Bearer Token/API Key/その他）
   ・レート制限: ____________（回/分）
   ```

3. **データ同期方針**
   ```
   ⬜ リアルタイム同期（Webhook）
   ⬜ 定期同期（___分ごと）
   ⬜ 手動同期（管理画面から）
   ```

---

## 第3部：段階的DB構築計画

### 3.1 推奨構築スケジュール（Week 1-8）

#### 📅 全体スケジュール

```
Week 1-2: 環境準備・マスターデータ構築
Week 3-4: コア機能DB構築
Week 5-6: 機能別順次構築
Week 7-8: 統合・最適化
```

#### Week 1（10/7 - 10/13）：環境準備・マスターデータ構築

**目標**: データベースサーバー準備、基本テーブル作成

| 日程 | 作業内容 | 担当 | 成果物 |
|------|---------|------|--------|
| 10/7（月） | DBサーバー申請・設定 | 医療チーム | サーバーアクセス情報 |
| 10/8（火） | MySQL接続確認、.env設定 | 医療チーム | 接続テスト成功 |
| 10/9（水） | 施設マスター構築 | 医療チーム | facilities テーブル |
| 10/10（木） | 部署マスター構築 | 医療チーム | departments テーブル |
| 10/11（金） | 職位マスター構築 | 医療チーム | positions テーブル |
| 10/12（土） | 初期データ投入 | 医療チーム | 3施設分のマスターデータ |
| 10/13（日） | Week 1 動作確認 | 医療チーム | 確認レポート |

**Week 1完了条件**：
- ✅ データベースに接続できる
- ✅ 3つのマスターテーブルが作成されている
- ✅ 小原病院・立神リハビリ・エスポワール立神のデータが入っている
- ✅ バックアップが取得できる

**Week 1で作成するテーブル**：

```sql
-- 1. 施設マスター
CREATE TABLE facilities (
  id INT AUTO_INCREMENT PRIMARY KEY,
  facility_code VARCHAR(50) NOT NULL UNIQUE, -- 'obara-hospital', 'tategami-rehabilitation'
  facility_name VARCHAR(100) NOT NULL,       -- '小原病院', '立神リハビリテーション温泉病院'
  facility_type VARCHAR(50),                 -- '病院', 'リハビリ施設'
  address VARCHAR(255),
  phone VARCHAR(20),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 2. 部署マスター
CREATE TABLE departments (
  id INT AUTO_INCREMENT PRIMARY KEY,
  facility_id INT NOT NULL,
  department_code VARCHAR(50) NOT NULL,
  department_name VARCHAR(100) NOT NULL,     -- '3階病棟', 'リハビリ科'
  parent_department_id INT,                  -- 階層構造の場合
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (facility_id) REFERENCES facilities(id),
  UNIQUE KEY unique_dept_code (facility_id, department_code)
);

-- 3. 職位マスター
CREATE TABLE positions (
  id INT AUTO_INCREMENT PRIMARY KEY,
  position_code VARCHAR(50) NOT NULL UNIQUE,
  position_name VARCHAR(100) NOT NULL,       -- '看護師', '統括主任'
  position_level INT NOT NULL,               -- 1-10
  position_category VARCHAR(50),             -- 'nurse', 'assistant_nurse'
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**Week 1投入データサンプル**：

```sql
-- 施設データ
INSERT INTO facilities (facility_code, facility_name, facility_type, phone) VALUES
('obara-hospital', '小原病院', '病院', '03-1234-5678'),
('tategami-rehabilitation', '立神リハビリテーション温泉病院', 'リハビリ施設', '092-2345-6789'),
('espoir-tategami', 'エスポワール立神', '介護施設', '092-3456-7890');

-- 部署データ（小原病院の例）
INSERT INTO departments (facility_id, department_code, department_name) VALUES
(1, 'ward-2f', '2階病棟'),
(1, 'ward-3f', '3階病棟'),
(1, 'ward-4f', '4階病棟'),
(1, 'outpatient', '外来');

-- 職位データ
INSERT INTO positions (position_code, position_name, position_level, position_category) VALUES
('nursing-aide', '看護助手', 1, 'nursing_aide'),
('nurse', '看護師', 2, 'nurse'),
('senior-nurse', '主任看護師', 3, 'nurse'),
('manager', '課長', 4, 'admin'),
('strategic-planning', '戦略企画部門員', 5, 'admin'),
('career-support', 'キャリア支援部門員', 6, 'admin'),
('chief-nurse-obara', '看護部長', 7, 'nurse'),              -- 小原病院
('chief-supervisor-tategami', '統括主任', 7, 'nurse'),      -- 立神リハビリ（特別調整）
('director-admin', '統括管理部門長', 8, 'admin'),
('vice-director', '副院長', 9, 'admin'),
('director', '院長', 10, 'admin');
```

#### Week 2（10/14 - 10/20）：職員基本情報構築

**目標**: 職員500名分のデータ投入

| 日程 | 作業内容 | 担当 | 成果物 |
|------|---------|------|--------|
| 10/14（月） | staff_basicテーブル作成 | 医療チーム | テーブル構造 |
| 10/15（火） | 事務局提供データのクレンジング | 医療チーム | 整形済みデータ |
| 10/16（水） | 職員データ投入（100名ずつ） | 医療チーム | 100名投入完了 |
| 10/17（木） | 職員データ投入（残り400名） | 医療チーム | 500名投入完了 |
| 10/18（金） | データ検証（重複チェック等） | 医療チーム | 検証レポート |
| 10/19（土） | staff_assignmentsテーブル作成・投入 | 医療チーム | 配属情報完成 |
| 10/20（日） | Week 2 動作確認 | 医療チーム | 確認レポート |

**Week 2で作成するテーブル**：

```sql
-- 4. 職員基本情報
CREATE TABLE staff_basic (
  id INT AUTO_INCREMENT PRIMARY KEY,
  employee_number VARCHAR(20) NOT NULL UNIQUE,
  last_name VARCHAR(50) NOT NULL,
  first_name VARCHAR(50) NOT NULL,
  last_name_kana VARCHAR(50) NOT NULL,
  first_name_kana VARCHAR(50) NOT NULL,
  gender ENUM('男','女','その他') NOT NULL,
  birth_date DATE NOT NULL,
  email VARCHAR(255) UNIQUE,
  phone VARCHAR(20),
  mobile_phone VARCHAR(20),
  postal_code VARCHAR(10),
  address VARCHAR(255),
  emergency_contact_name VARCHAR(100),
  emergency_contact_phone VARCHAR(20),
  emergency_contact_relationship VARCHAR(50),
  hire_date DATE NOT NULL,
  employment_type VARCHAR(50) NOT NULL,      -- '正社員', 'パート', '契約'
  employment_status VARCHAR(50) DEFAULT 'active', -- 'active', 'resigned', 'on_leave'
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_employee_number (employee_number),
  INDEX idx_email (email)
);

-- 5. 配属情報
CREATE TABLE staff_assignments (
  id INT AUTO_INCREMENT PRIMARY KEY,
  staff_id INT NOT NULL,
  facility_id INT NOT NULL,
  department_id INT NOT NULL,
  position_id INT NOT NULL,
  start_date DATE NOT NULL,
  end_date DATE,                             -- NULLなら現在有効
  is_primary BOOLEAN DEFAULT TRUE,           -- 主配属か兼務か
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (staff_id) REFERENCES staff_basic(id),
  FOREIGN KEY (facility_id) REFERENCES facilities(id),
  FOREIGN KEY (department_id) REFERENCES departments(id),
  FOREIGN KEY (position_id) REFERENCES positions(id),
  INDEX idx_staff_current (staff_id, end_date)
);
```

**Week 2完了条件**：
- ✅ 500名の職員データが投入されている
- ✅ メールアドレス・職員番号に重複がない
- ✅ 全職員に配属情報が紐づいている
- ✅ 施設別・部署別の職員数が事務局提供データと一致

#### Week 3-4（10/21 - 11/3）：コア機能DB構築

**対象機能**：
- キャリアコース選択制度（Phase 5）
- 面談予約システム
- 面談記録管理

**Week 3で作成するテーブル**：

```sql
-- 6. キャリアコース定義（マスター）
CREATE TABLE course_definitions (
  id INT AUTO_INCREMENT PRIMARY KEY,
  course_code VARCHAR(10) NOT NULL UNIQUE,   -- 'A', 'B', 'C', 'D'
  course_name VARCHAR(100) NOT NULL,
  description TEXT,
  department_transfer_available BOOLEAN DEFAULT FALSE,
  facility_transfer_available VARCHAR(20) DEFAULT 'none',
  relocation_required BOOLEAN DEFAULT FALSE,
  night_shift_available VARCHAR(20) DEFAULT 'none',
  management_track BOOLEAN DEFAULT FALSE,
  base_salary_multiplier DECIMAL(5,3) DEFAULT 1.000,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 7. 職員キャリアコース選択履歴
CREATE TABLE staff_career_courses (
  id INT AUTO_INCREMENT PRIMARY KEY,
  staff_id INT NOT NULL,
  course_code VARCHAR(10) NOT NULL,
  effective_from DATE NOT NULL,
  effective_to DATE,                         -- NULLなら現在有効
  next_change_available_date DATE,
  special_change_reason VARCHAR(50),
  approved_at TIMESTAMP,
  approved_by INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (staff_id) REFERENCES staff_basic(id),
  FOREIGN KEY (course_code) REFERENCES course_definitions(course_code),
  INDEX idx_staff_current_course (staff_id, effective_to)
);

-- 8. 面談予約
CREATE TABLE interviews (
  id INT AUTO_INCREMENT PRIMARY KEY,
  staff_id INT NOT NULL,
  interviewer_id INT NOT NULL,
  interview_type VARCHAR(50) NOT NULL,       -- '定期', '臨時', 'キャリア'
  interview_category VARCHAR(50),
  booking_date DATE NOT NULL,
  start_time TIME NOT NULL,
  end_time TIME NOT NULL,
  duration_minutes INT,
  location VARCHAR(100),
  status VARCHAR(20) DEFAULT '予定',         -- '予定', '完了', 'キャンセル'
  urgency_level VARCHAR(20) DEFAULT '通常',
  requested_topics JSON,
  created_by VARCHAR(50),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (staff_id) REFERENCES staff_basic(id),
  FOREIGN KEY (interviewer_id) REFERENCES staff_basic(id),
  INDEX idx_booking_date (booking_date),
  INDEX idx_staff_interviews (staff_id, booking_date)
);

-- 9. 面談記録
CREATE TABLE interview_records (
  id INT AUTO_INCREMENT PRIMARY KEY,
  interview_id INT NOT NULL,
  discussion_summary TEXT,
  employee_feedback TEXT,
  interviewer_notes TEXT,
  action_items JSON,
  follow_up_required BOOLEAN DEFAULT FALSE,
  follow_up_date DATE,
  confidentiality_level INT DEFAULT 1,       -- 1-5
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (interview_id) REFERENCES interviews(id),
  UNIQUE KEY unique_interview_record (interview_id)
);
```

**Week 4完了条件**：
- ✅ A～Dコース定義が投入されている
- ✅ 職員のコース選択情報が投入されている（任意）
- ✅ 面談予約のテストデータが投入されている
- ✅ フロントエンドから面談予約が作成できる

#### Week 5-6（11/4 - 11/17）：機能別順次構築

**対象機能**：
- 人事評価システム
- 健康管理システム
- 研修管理システム

**Week 5-6で作成するテーブル**：

```sql
-- 10. 人事評価
CREATE TABLE evaluations (
  id INT AUTO_INCREMENT PRIMARY KEY,
  staff_id INT NOT NULL,
  evaluation_period VARCHAR(20) NOT NULL,    -- '2024年上期'
  evaluation_type VARCHAR(50) NOT NULL,
  overall_rating VARCHAR(10) NOT NULL,       -- 'S', 'A', 'B', 'C', 'D'
  performance_score INT,
  skill_score INT,
  teamwork_score INT,
  growth_potential INT,
  evaluator_id INT NOT NULL,
  evaluation_date DATE NOT NULL,
  comments TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (staff_id) REFERENCES staff_basic(id),
  FOREIGN KEY (evaluator_id) REFERENCES staff_basic(id),
  INDEX idx_staff_evaluation (staff_id, evaluation_period)
);

-- 11. 2軸評価
CREATE TABLE two_axis_evaluations (
  id INT AUTO_INCREMENT PRIMARY KEY,
  staff_id INT NOT NULL,
  evaluation_period VARCHAR(20) NOT NULL,
  facility_score ENUM('S','A','B','C','D'),
  facility_rank INT,
  facility_total_staff INT,
  corporate_score ENUM('S','A','B','C','D'),
  corporate_rank INT,
  corporate_total_staff INT,
  overall_score ENUM('S','A','B','C','D'),
  evaluation_date DATE NOT NULL,
  evaluator_id INT NOT NULL,
  comments TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (staff_id) REFERENCES staff_basic(id),
  FOREIGN KEY (evaluator_id) REFERENCES staff_basic(id)
);

-- 12. 健康診断
CREATE TABLE health_checkups (
  id INT AUTO_INCREMENT PRIMARY KEY,
  staff_id INT NOT NULL,
  checkup_date DATE NOT NULL,
  checkup_type VARCHAR(50) NOT NULL,
  overall_result VARCHAR(20),
  height DECIMAL(5,2),
  weight DECIMAL(5,2),
  bmi DECIMAL(4,2),
  blood_pressure_high INT,
  blood_pressure_low INT,
  vision_left DECIMAL(3,1),
  vision_right DECIMAL(3,1),
  hearing_result VARCHAR(50),
  special_findings TEXT,
  doctor_comments TEXT,
  next_checkup_date DATE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (staff_id) REFERENCES staff_basic(id),
  INDEX idx_staff_checkup (staff_id, checkup_date)
);

-- 13. ストレスチェック
CREATE TABLE stress_checks (
  id INT AUTO_INCREMENT PRIMARY KEY,
  staff_id INT NOT NULL,
  check_date DATE NOT NULL,
  stress_index INT NOT NULL,                 -- 0-100
  physical_stress_score INT,
  mental_stress_score INT,
  work_stress_score INT,
  support_score INT,
  high_stress_flag BOOLEAN DEFAULT FALSE,
  counseling_required BOOLEAN DEFAULT FALSE,
  counseling_date DATE,
  follow_up_required BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (staff_id) REFERENCES staff_basic(id),
  INDEX idx_staff_stress (staff_id, check_date),
  INDEX idx_high_stress (high_stress_flag, check_date)
);

-- 14. 研修プログラム
CREATE TABLE training_programs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  program_name VARCHAR(200) NOT NULL,
  program_category VARCHAR(50) NOT NULL,
  duration_hours INT NOT NULL,
  is_mandatory BOOLEAN DEFAULT FALSE,
  target_positions JSON,
  target_departments JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 15. 研修受講記録
CREATE TABLE training_records (
  id INT AUTO_INCREMENT PRIMARY KEY,
  staff_id INT NOT NULL,
  program_id INT NOT NULL,
  attendance_date DATE NOT NULL,
  completion_status VARCHAR(20),
  score INT,
  evaluation VARCHAR(50),
  certificate_issued BOOLEAN DEFAULT FALSE,
  certificate_number VARCHAR(50),
  expiry_date DATE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (staff_id) REFERENCES staff_basic(id),
  FOREIGN KEY (program_id) REFERENCES training_programs(id)
);
```

**Week 6完了条件**：
- ✅ 評価システムのテストデータ投入
- ✅ 健康診断のサンプルデータ投入
- ✅ 研修プログラムのマスターデータ投入
- ✅ フロントエンドから各機能が利用できる

#### Week 7-8（11/18 - 12/1）：統合・最適化

**作業内容**：
- 全機能の統合テスト
- パフォーマンスチューニング
- インデックス最適化
- バックアップ・リストア確認
- VoiceDrive連携テスト

**Week 7-8完了条件**：
- ✅ 全テーブルが正常に動作
- ✅ 500名分のデータで性能問題なし
- ✅ バックアップ・リストアが正常動作
- ✅ VoiceDriveとのAPI連携成功
- ✅ セキュリティ監査合格

### 3.2 各Weekの成功判定基準

#### Week 1: マスターデータ構築

**✅ 成功判定**：
```sql
-- 施設が3件登録されているか
SELECT COUNT(*) FROM facilities;
-- 期待値: 3

-- 部署が登録されているか（小原病院の例）
SELECT COUNT(*) FROM departments WHERE facility_id = 1;
-- 期待値: 10以上

-- 職位が11件登録されているか
SELECT COUNT(*) FROM positions;
-- 期待値: 11

-- 統括主任のレベルが7か
SELECT position_level FROM positions WHERE position_code = 'chief-supervisor-tategami';
-- 期待値: 7
```

#### Week 2: 職員基本情報構築

**✅ 成功判定**：
```sql
-- 職員が500名登録されているか
SELECT COUNT(*) FROM staff_basic;
-- 期待値: 500

-- メールアドレスの重複がないか
SELECT email, COUNT(*) FROM staff_basic GROUP BY email HAVING COUNT(*) > 1;
-- 期待値: 0件

-- 職員番号の重複がないか
SELECT employee_number, COUNT(*) FROM staff_basic GROUP BY employee_number HAVING COUNT(*) > 1;
-- 期待値: 0件

-- 全職員に配属情報があるか
SELECT COUNT(DISTINCT staff_id) FROM staff_assignments WHERE end_date IS NULL;
-- 期待値: 500

-- 小原病院の職員数
SELECT COUNT(*) FROM staff_assignments sa
JOIN facilities f ON sa.facility_id = f.id
WHERE f.facility_code = 'obara-hospital' AND sa.end_date IS NULL;
-- 期待値: 事務局提供データと一致
```

#### Week 3-4: コア機能DB構築

**✅ 成功判定**：
```sql
-- コース定義が4件あるか
SELECT COUNT(*) FROM course_definitions WHERE is_active = TRUE;
-- 期待値: 4

-- Aコースの給与係数が1.2か
SELECT base_salary_multiplier FROM course_definitions WHERE course_code = 'A';
-- 期待値: 1.200

-- 面談予約のテストデータがあるか
SELECT COUNT(*) FROM interviews;
-- 期待値: 10以上

-- フロントエンドから面談予約が作成できるか（手動テスト）
```

### 3.3 ロールバック計画

**問題発生時の復旧手順**：

#### レベル1: 軽微な問題（データ不整合等）

**対応**：該当レコードのみ修正

```sql
-- 例：職員番号の重複修正
UPDATE staff_basic SET employee_number = 'EMP001_2' WHERE id = 123;
```

#### レベル2: テーブル単位の問題

**対応**：該当テーブルのみ再構築

```bash
# バックアップから該当テーブルのみ復元
mysql -u admin -p staff_medical_system < backup_staff_basic_20251015.sql
```

#### レベル3: Week全体の問題

**対応**：Week開始時点に戻す

```bash
# Week開始時のバックアップから全復元
mysql -u admin -p staff_medical_system < backup_week2_start_20251014.sql
```

#### レベル4: データベース全体の問題

**対応**：データベース再構築

```bash
# データベース削除
mysql -u admin -p -e "DROP DATABASE staff_medical_system;"

# データベース再作成
mysql -u admin -p < initial_setup.sql

# 最新バックアップから復元
mysql -u admin -p staff_medical_system < backup_latest.sql
```

### 3.4 バックアップ戦略

#### 自動バックアップ設定

**毎日バックアップ（午前2時）**：

```bash
#!/bin/bash
# /var/backups/daily-backup.sh

DATE=$(date +%Y%m%d)
BACKUP_DIR="/var/backups/staff_medical_system"
DB_NAME="staff_medical_system"
DB_USER="admin"
DB_PASS="SecureP@ssw0rd!"

# フルバックアップ
mysqldump -u $DB_USER -p$DB_PASS $DB_NAME > $BACKUP_DIR/full_backup_$DATE.sql

# テーブル別バックアップ（重要テーブルのみ）
mysqldump -u $DB_USER -p$DB_PASS $DB_NAME staff_basic > $BACKUP_DIR/staff_basic_$DATE.sql
mysqldump -u $DB_USER -p$DB_PASS $DB_NAME staff_assignments > $BACKUP_DIR/staff_assignments_$DATE.sql

# 30日以上前のバックアップを削除
find $BACKUP_DIR -name "*.sql" -mtime +30 -delete

# バックアップ成功通知
echo "Backup completed: $DATE" | mail -s "DB Backup Success" admin@kosei.jp
```

**Cron設定**：

```bash
# crontab -e
0 2 * * * /var/backups/daily-backup.sh
```

#### 手動バックアップ（Week開始時）

```bash
# Week 1開始前
mysqldump -u admin -p staff_medical_system > backup_week1_start_20251007.sql

# Week 2開始前
mysqldump -u admin -p staff_medical_system > backup_week2_start_20251014.sql

# Week 3開始前
mysqldump -u admin -p staff_medical_system > backup_week3_start_20251021.sql
```

---

## 第4部：リスク管理

### 4.1 想定されるリスクと対策

| リスク | 発生確率 | 影響度 | 対策 | 責任者 |
|--------|---------|--------|------|--------|
| データ投入時の重複エラー | 高 | 中 | 事前にデータクレンジング、UNIQUE制約設定 | 医療チーム |
| 事務局からのデータ提供遅延 | 中 | 高 | サンプルデータで先行構築、後から実データ投入 | 事務局 |
| VoiceDrive連携不具合 | 中 | 中 | API連携を最後のPhaseに配置、独立動作を優先 | VoiceDriveチーム |
| パフォーマンス問題（500名で遅い） | 低 | 中 | インデックス最適化、クエリチューニング | 医療チーム |
| データベースサーバー障害 | 低 | 高 | 毎日バックアップ、冗長化構成（将来） | 医療チーム |
| 個人情報漏洩 | 低 | 最高 | アクセス制限、暗号化、監査ログ | 両チーム |

### 4.2 個人情報保護対策

#### アクセス制御

**データベースユーザー権限設定**：

```sql
-- 管理者（フルアクセス）
CREATE USER 'admin'@'%' IDENTIFIED BY 'SecureP@ssw0rd!';
GRANT ALL PRIVILEGES ON staff_medical_system.* TO 'admin'@'%';

-- アプリケーション（読み書き）
CREATE USER 'app_user'@'%' IDENTIFIED BY 'AppP@ssw0rd!';
GRANT SELECT, INSERT, UPDATE ON staff_medical_system.* TO 'app_user'@'%';

-- 読み取り専用（レポート用）
CREATE USER 'report_user'@'%' IDENTIFIED BY 'Rep0rtP@ss!';
GRANT SELECT ON staff_medical_system.* TO 'report_user'@'%';
```

#### データ暗号化

**機密情報の暗号化**：

```sql
-- メールアドレスの暗号化（例）
-- 実装時にAES_ENCRYPT/AES_DECRYPT使用
INSERT INTO staff_basic (email, ...)
VALUES (AES_ENCRYPT('yamada@kosei.jp', 'encryption_key'), ...);

SELECT AES_DECRYPT(email, 'encryption_key') AS email FROM staff_basic;
```

#### 監査ログ

**全ての変更を記録**：

```sql
-- 監査ログテーブル
CREATE TABLE audit_log (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  table_name VARCHAR(50) NOT NULL,
  action_type ENUM('INSERT', 'UPDATE', 'DELETE') NOT NULL,
  record_id INT NOT NULL,
  old_value JSON,
  new_value JSON,
  changed_by VARCHAR(100),
  changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  ip_address VARCHAR(45),
  INDEX idx_table_action (table_name, action_type),
  INDEX idx_changed_at (changed_at)
);

-- トリガーで自動記録（例：staff_basic更新時）
DELIMITER $$
CREATE TRIGGER audit_staff_basic_update
AFTER UPDATE ON staff_basic
FOR EACH ROW
BEGIN
  INSERT INTO audit_log (table_name, action_type, record_id, old_value, new_value, changed_by)
  VALUES (
    'staff_basic',
    'UPDATE',
    NEW.id,
    JSON_OBJECT('name', OLD.last_name, 'email', OLD.email),
    JSON_OBJECT('name', NEW.last_name, 'email', NEW.email),
    USER()
  );
END$$
DELIMITER ;
```

---

## 第5部：本番移行チェックリスト

### 5.1 構築開始前チェックリスト

**必須確認事項**：

| No. | 確認項目 | 確認者 | 確認日 | ✅ |
|-----|---------|--------|--------|-----|
| 1 | データベースサーバーが準備されている | 医療チーム | ____/____ | ⬜ |
| 2 | MySQLバージョンが8.0以上である | 医療チーム | ____/____ | ⬜ |
| 3 | データベース接続設定（.env）が完了している | 医療チーム | ____/____ | ⬜ |
| 4 | バックアップディレクトリが作成されている | 医療チーム | ____/____ | ⬜ |
| 5 | 事務局から職員情報が提供されている | 事務局 | ____/____ | ⬜ |
| 6 | VoiceDriveチームとDB統合方針が合意されている | VoiceDriveチーム | ____/____ | ⬜ |
| 7 | ロールバック手順書が作成されている | 医療チーム | ____/____ | ⬜ |
| 8 | 個人情報保護対策が完了している | 両チーム | ____/____ | ⬜ |
| 9 | 構築スケジュールが承認されている | 事務局 | ____/____ | ⬜ |
| 10 | 緊急連絡体制が確立されている | 両チーム | ____/____ | ⬜ |

### 5.2 Week別チェックリスト

#### Week 1完了チェック

| 確認項目 | 期待値 | 実測値 | ✅ |
|---------|--------|--------|-----|
| facilitiesテーブルのレコード数 | 3件 | ___件 | ⬜ |
| departmentsテーブルのレコード数 | 30件以上 | ___件 | ⬜ |
| positionsテーブルのレコード数 | 11件 | ___件 | ⬜ |
| データベース接続速度 | < 100ms | ___ms | ⬜ |
| バックアップファイルサイズ | < 1MB | ___MB | ⬜ |

#### Week 2完了チェック

| 確認項目 | 期待値 | 実測値 | ✅ |
|---------|--------|--------|-----|
| staff_basicテーブルのレコード数 | 500件 | ___件 | ⬜ |
| メールアドレス重複 | 0件 | ___件 | ⬜ |
| 職員番号重複 | 0件 | ___件 | ⬜ |
| staff_assignmentsテーブルのレコード数 | 500件 | ___件 | ⬜ |
| 小原病院の職員数 | 事務局データと一致 | ___件 | ⬜ |
| 立神リハビリの職員数 | 事務局データと一致 | ___件 | ⬜ |

#### Week 3-4完了チェック

| 確認項目 | 期待値 | 実測値 | ✅ |
|---------|--------|--------|-----|
| course_definitionsテーブルのレコード数 | 4件 | ___件 | ⬜ |
| interviewsテーブルのレコード数 | 10件以上 | ___件 | ⬜ |
| フロントエンドから面談予約が作成できる | 成功 | _____ | ⬜ |
| キャリアコースカードが表示される | 成功 | _____ | ⬜ |

### 5.3 本番リリースチェックリスト

**本番移行判定会議（Week 8終了時）**：

| No. | 確認項目 | 判定基準 | 判定 |
|-----|---------|---------|------|
| 1 | 全テーブルが正常に動作している | 100% | ⬜ 合格 / ⬜ 不合格 |
| 2 | 500名分のデータで性能問題がない | < 1秒 | ⬜ 合格 / ⬜ 不合格 |
| 3 | バックアップ・リストアが正常動作 | 成功 | ⬜ 合格 / ⬜ 不合格 |
| 4 | VoiceDriveとのAPI連携が成功 | 成功 | ⬜ 合格 / ⬜ 不合格 |
| 5 | セキュリティ監査に合格 | 合格 | ⬜ 合格 / ⬜ 不合格 |
| 6 | 個人情報保護対策が完了 | 完了 | ⬜ 合格 / ⬜ 不合格 |
| 7 | ユーザー受入テスト（UAT）完了 | 完了 | ⬜ 合格 / ⬜ 不合格 |
| 8 | 運用マニュアルが作成されている | 作成済み | ⬜ 合格 / ⬜ 不合格 |

**全項目合格で本番リリース承認**

---

## 第6部：次のアクション

### 6.1 即時実行項目（今週中：10/2-10/6）

| No. | アクション | 担当 | 期限 | 成果物 |
|-----|-----------|------|------|--------|
| 1 | 本確認書の社内回覧・承認 | 事務局 | 10/4 | 承認書 |
| 2 | データベースサーバー選定（Lightsail/既存） | 医療チーム | 10/4 | 決定書 |
| 3 | VoiceDriveチームへの確認事項送付 | 医療チーム | 10/3 | 送付完了 |
| 4 | 事務局への職員情報提供依頼送付 | 医療チーム | 10/3 | 依頼書送付 |
| 5 | バックアップ手順書の作成 | 医療チーム | 10/6 | 手順書 |

### 6.2 Week 1開始前準備（10/7-10/9）

| No. | アクション | 担当 | 期限 | 成果物 |
|-----|-----------|------|------|--------|
| 1 | データベースサーバー構築 | 医療チーム | 10/7 | 接続情報 |
| 2 | .envファイル設定 | 医療チーム | 10/8 | 設定完了 |
| 3 | 接続テスト実施 | 医療チーム | 10/8 | テスト結果 |
| 4 | 事務局提供データの受領 | 医療チーム | 10/9 | Excelファイル |
| 5 | VoiceDriveチームからの回答受領 | VoiceDriveチーム | 10/9 | 回答書 |

### 6.3 構築開始判定会議（10/9開催予定）

**参加者**：
- 医療システムチーム
- VoiceDriveチーム
- 事務局責任者

**議題**：
1. 本確認書の最終承認
2. 職員情報提供データの確認
3. VoiceDriveチームからの回答確認
4. データベースサーバー準備状況確認
5. Week 1開始の可否判断

**判定基準**：
- ✅ 第5部 5.1「構築開始前チェックリスト」が全て✅
- ✅ 事務局からの職員情報提供が完了
- ✅ VoiceDriveチームとのDB統合方針が合意
- ✅ データベースサーバーが準備完了

**構築開始日**: 2025年10月10日（木）（判定会議で承認された場合）

---

## 第7部：問い合わせ先

### 7.1 医療システムチーム

**プロジェクトリーダー**：
- 連絡先: medical-system-lead@example.com
- 対応時間: 平日 9:00-18:00

**技術担当**：
- 連絡先: medical-system-tech@example.com
- 対応時間: 平日 9:00-18:00
- 緊急時: 24時間対応（電話: 090-XXXX-XXXX）

### 7.2 VoiceDriveチーム

**プロジェクトリーダー**：
- 連絡先: voicedrive-lead@example.com
- 対応時間: 平日 10:00-19:00

**技術担当**：
- 連絡先: voicedrive-tech@example.com
- 対応時間: 平日 10:00-19:00

### 7.3 事務局

**データ提供担当**：
- 部署: 医療法人厚生会 人事部
- 連絡先: hr@kosei.jp
- 対応時間: 平日 9:00-17:00

---

## 付録A：用語集（素人向け）

| 用語 | 意味 | 例え |
|-----|------|------|
| **データベース（DB）** | データを整理して保存する場所 | 電子版のファイルキャビネット |
| **テーブル** | データの種類ごとの表 | Excelのシート |
| **レコード** | 1件分のデータ | Excelの1行 |
| **カラム** | データの項目 | Excelの列（A列、B列等） |
| **プライマリーキー（PK）** | データを一意に識別する番号 | 職員番号、社員番号 |
| **フォーリンキー（FK）** | 他のテーブルとの関連づけ | 職員IDで面談記録と紐づける |
| **インデックス** | 検索を高速化する仕組み | 本の索引 |
| **マイグレーション** | データベース構造の変更履歴 | Gitのコミット履歴のDB版 |
| **バックアップ** | データの複製保存 | ファイルのコピー |
| **ロールバック** | 以前の状態に戻す | Ctrl+Z（元に戻す） |
| **SQL** | データベース操作言語 | データベースへの命令文 |
| **API** | システム間の連携方法 | 郵便局と宅配便の連携 |
| **SSO** | 1回のログインで複数システム利用 | 社員証1枚で全ての扉が開く |

---

## 付録B：SQLサンプルクエリ集

### B.1 データ確認用クエリ

```sql
-- 職員数の確認
SELECT COUNT(*) AS total_staff FROM staff_basic;

-- 施設別職員数
SELECT
  f.facility_name,
  COUNT(sa.staff_id) AS staff_count
FROM facilities f
LEFT JOIN staff_assignments sa ON f.id = sa.facility_id AND sa.end_date IS NULL
GROUP BY f.facility_name;

-- 部署別職員数
SELECT
  d.department_name,
  COUNT(sa.staff_id) AS staff_count
FROM departments d
LEFT JOIN staff_assignments sa ON d.id = sa.department_id AND sa.end_date IS NULL
GROUP BY d.department_name
ORDER BY staff_count DESC;

-- 職位別職員数
SELECT
  p.position_name,
  p.position_level,
  COUNT(sa.staff_id) AS staff_count
FROM positions p
LEFT JOIN staff_assignments sa ON p.id = sa.position_id AND sa.end_date IS NULL
GROUP BY p.position_name, p.position_level
ORDER BY p.position_level;

-- メールアドレス重複チェック
SELECT email, COUNT(*) AS count
FROM staff_basic
GROUP BY email
HAVING COUNT(*) > 1;

-- 職員番号重複チェック
SELECT employee_number, COUNT(*) AS count
FROM staff_basic
GROUP BY employee_number
HAVING COUNT(*) > 1;
```

### B.2 データ投入用クエリ

```sql
-- 施設データ投入
INSERT INTO facilities (facility_code, facility_name, facility_type, phone) VALUES
('obara-hospital', '小原病院', '病院', '03-1234-5678'),
('tategami-rehabilitation', '立神リハビリテーション温泉病院', 'リハビリ施設', '092-2345-6789'),
('espoir-tategami', 'エスポワール立神', '介護施設', '092-3456-7890');

-- 職員データ投入（サンプル）
INSERT INTO staff_basic (
  employee_number, last_name, first_name, last_name_kana, first_name_kana,
  gender, birth_date, email, phone, hire_date, employment_type
) VALUES (
  'EMP001', '山田', '太郎', 'ヤマダ', 'タロウ',
  '男', '1985-04-15', 'yamada@kosei.jp', '090-1234-5678', '2020-04-01', '正社員'
);

-- 配属情報投入（サンプル）
INSERT INTO staff_assignments (
  staff_id, facility_id, department_id, position_id, start_date, is_primary
) VALUES (
  1, 1, 1, 2, '2020-04-01', TRUE
);
```

### B.3 データ分析用クエリ

```sql
-- 平均勤続年数
SELECT
  AVG(DATEDIFF(CURDATE(), hire_date) / 365) AS avg_years_of_service
FROM staff_basic
WHERE employment_status = 'active';

-- 年齢分布
SELECT
  CASE
    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 25 THEN '25歳未満'
    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 35 THEN '25-34歳'
    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 45 THEN '35-44歳'
    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) < 55 THEN '45-54歳'
    ELSE '55歳以上'
  END AS age_group,
  COUNT(*) AS count
FROM staff_basic
WHERE employment_status = 'active'
GROUP BY age_group
ORDER BY age_group;

-- 面談実施率（過去6ヶ月）
SELECT
  COUNT(DISTINCT i.staff_id) AS interviewed_staff,
  (SELECT COUNT(*) FROM staff_basic WHERE employment_status = 'active') AS total_staff,
  ROUND(COUNT(DISTINCT i.staff_id) * 100.0 / (SELECT COUNT(*) FROM staff_basic WHERE employment_status = 'active'), 2) AS interview_rate_percent
FROM interviews i
WHERE i.booking_date >= DATE_SUB(CURDATE(), INTERVAL 6 MONTH)
  AND i.status = '完了';
```

---

## 付録C：事務局提供データExcelテンプレート

**ファイル名**: `職員マスターデータ_提出用テンプレート.xlsx`

### シート1: 基本情報

| A | B | C | D | E | F | G | H | I | J | K | L | M | N |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 職員番号※ | 姓※ | 名※ | 姓カナ※ | 名カナ※ | 性別※ | 生年月日※ | メール※ | 電話※ | 入職日※ | 施設※ | 部署※ | 職位※ | レベル※ |
| EMP001 | 山田 | 太郎 | ヤマダ | タロウ | 男 | 1985-04-15 | yamada@kosei.jp | 090-1234-5678 | 2020-04-01 | 小原病院 | 3階病棟 | 看護師 | 2 |

※印は必須項目

### シート2: 追加情報（任意）

| A | B | C | D | E | F | G |
|---|---|---|---|---|---|---|
| 職員番号※ | 郵便番号 | 住所 | 緊急連絡先氏名 | 緊急連絡先電話 | 緊急連絡先続柄 | 雇用形態 |
| EMP001 | 123-4567 | 東京都渋谷区... | 山田花子（妻） | 080-9876-5432 | 配偶者 | 正社員 |

### シート3: キャリアコース（任意）

| A | B | C |
|---|---|---|
| 職員番号※ | 現在のコース | コース選択日 |
| EMP001 | B | 2024-04-01 |

**コース選択肢**: A / B / C / D

---

## 署名欄

### 承認者署名

**医療システムチーム**：

- プロジェクトリーダー: _________________ 日付: ____/____/____

**VoiceDriveチーム**：

- プロジェクトリーダー: _________________ 日付: ____/____/____

**事務局**：

- 人事部長: _________________ 日付: ____/____/____

---

**文書終了**

*本確認書は医療法人厚生会の職員カルテシステムDB構築プロジェクトの正式文書です。*
*承認後、構築作業を開始いたします。*
