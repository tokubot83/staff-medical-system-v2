# MyRequestsPage VoiceDriveç¢ºèªäº‹é …ã¸ã®å›ç­”æ›¸

**æ–‡æ›¸ç•ªå·**: MED-RESP-MYREQUESTS-2025-1027-001
**ä½œæˆæ—¥**: 2025å¹´10æœˆ27æ—¥
**ä½œæˆè€…**: ClaudeCodeï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ ï¼‰
**å®›å…ˆ**: VoiceDriveãƒãƒ¼ãƒ 
**ä»¶å**: MyRequestsPageå®Ÿè£…ã«é–¢ã™ã‚‹4ä»¶ã®ç¢ºèªäº‹é …ã¸ã®å›ç­”
**å‚ç…§æ›¸é¡**:
- MyRequestsPage_åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªçµæœ_20251027.mdï¼ˆMED-CONF-2025-1027-006ï¼‰
- VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®ç¢ºèªäº‹é …ï¼ˆ2025å¹´10æœˆ27æ—¥å—é ˜ï¼‰

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®4ä»¶ã®ç¢ºèªäº‹é …ãƒ»è¿½åŠ è³ªå•ã«ã¤ã„ã¦ã€åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ ã¨ã—ã¦å›ç­”ã—ã¾ã™ã€‚

### å›ç­”ã‚µãƒãƒªãƒ¼

| # | ç¢ºèªäº‹é … | å›ç­” | è©³ç´° |
|---|---------|------|------|
| 1 | ã‚³ãƒ¼ã‚¹å®šç¾©ã®çµ¦ä¸ä¿‚æ•° | âœ… **ä»®ã®å€¤** | äººäº‹éƒ¨é–€ã¨èª¿æ•´å¿…è¦ |
| 2 | æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† | âœ… **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§ç®¡ç†** | S3ä½¿ç”¨æ¨å¥¨ |
| 3 | ç”³è«‹ã®å¹´é–“å›æ•°åˆ¶é™ | âœ… **å¹´1å› + ç‰¹ä¾‹ç„¡åˆ¶é™** | ãƒ­ã‚¸ãƒƒã‚¯ææ¡ˆæ‰¿èª |
| 4 | Webhookãƒªãƒˆãƒ©ã‚¤ãƒãƒªã‚·ãƒ¼ | âœ… **3å›ãƒªãƒˆãƒ©ã‚¤** | ææ¡ˆãƒãƒªã‚·ãƒ¼æ‰¿èª |

### è¿½åŠ åˆæ„äº‹é …

âœ… **VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®ææ¡ˆã‚’å…¨ã¦æ‰¿èªã—ã¾ã™**
- å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: Phase 1.6ã¨åŒæ™‚å®Ÿæ–½
- Webhook Secret Key: é–‹ç™ºç’°å¢ƒç”¨ã‚­ãƒ¼æ‰¿èª
- Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…: Week 3å®Ÿè£…è¨ˆç”»æ‰¿èª
- å®Ÿè£…å„ªå…ˆåº¦: ğŸ”´ æœ€é«˜å„ªå…ˆåº¦ã§åˆæ„

---

## âœ… ç¢ºèªäº‹é …ã¸ã®å›ç­”

### 1. ã‚³ãƒ¼ã‚¹å®šç¾©ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦

#### VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®è³ªå•

> çµ¦ä¸ä¿‚æ•°ï¼ˆAã‚³ãƒ¼ã‚¹1.20å€ã€Bã‚³ãƒ¼ã‚¹1.10å€ã€Cã‚³ãƒ¼ã‚¹1.00å€ã€Dã‚³ãƒ¼ã‚¹0.90å€ï¼‰ã¯å®Ÿéš›ã®äººäº‹è¦å®šã«åŸºã¥ã„ãŸå€¤ã§ã™ã‹ï¼Ÿ

#### å›ç­”: âš ï¸ **ä»®ã®å€¤ã§ã™ã€‚äººäº‹éƒ¨é–€ã¨èª¿æ•´ãŒå¿…è¦ã§ã™ã€‚**

**ç¾çŠ¶ã®çµ¦ä¸ä¿‚æ•°ï¼ˆä»®è¨­å®šï¼‰**:

| ã‚³ãƒ¼ã‚¹ | çµ¦ä¸ä¿‚æ•° | è¨­å®šæ ¹æ‹  | çŠ¶æ…‹ |
|--------|---------|---------|------|
| Aã‚³ãƒ¼ã‚¹ | 1.20å€ | æ–½è¨­é–“ç•°å‹•ãƒ»è»¢å±…å¯¾å¿œã®å¯¾ä¾¡ | ğŸŸ¡ ä»®è¨­å®š |
| Bã‚³ãƒ¼ã‚¹ | 1.10å€ | éƒ¨ç½²ç•°å‹•å¯¾å¿œã®å¯¾ä¾¡ | ğŸŸ¡ ä»®è¨­å®š |
| Cã‚³ãƒ¼ã‚¹ | 1.00å€ | åŸºæº–çµ¦ä¸ï¼ˆç•°å‹•ãªã—ï¼‰ | ğŸŸ¡ ä»®è¨­å®š |
| Dã‚³ãƒ¼ã‚¹ | 0.90å€ | å¤œå‹¤ãªã—ãƒ»æ™‚çŸ­å‹¤å‹™æƒ³å®š | ğŸŸ¡ ä»®è¨­å®š |

#### ä»Šå¾Œã®èª¿æ•´æ–¹é‡

**Phase 1ï¼ˆå®Ÿè£…æ™‚ï¼‰**:
- âœ… ä»®ã®å€¤ã§å®Ÿè£…ã‚’é€²ã‚ã‚‹
- âœ… ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆä¸Šã¯`baseSalaryMultiplier`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ç®¡ç†
- âœ… å¾Œã‹ã‚‰å¤‰æ›´å¯èƒ½ãªè¨­è¨ˆ

**Phase 2ï¼ˆé‹ç”¨å‰ï¼‰**:
- ğŸ”´ äººäº‹éƒ¨é–€ã¨ã®èª¿æ•´ä¼šè­°ã‚’å®Ÿæ–½
- ğŸ”´ å°±æ¥­è¦å‰‡ãƒ»çµ¦ä¸è¦å®šã¨ã®æ•´åˆæ€§ç¢ºèª
- ğŸ”´ ç†äº‹ä¼šæ‰¿èªãŒå¿…è¦ãªå¯èƒ½æ€§ã‚ã‚Š
- ğŸ”´ å®Ÿéš›ã®çµ¦ä¸ä¿‚æ•°ã‚’ç¢ºå®š

**æ¨å¥¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³**:
```
Week 1-5:  åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ï¼ˆä»®ä¿‚æ•°ã§é€²è¡Œï¼‰
Week 6:    äººäº‹éƒ¨é–€èª¿æ•´ä¼šè­°ï¼ˆå®Ÿä¿‚æ•°ç¢ºå®šï¼‰
Week 7:    ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ï¼ˆå®Ÿä¿‚æ•°åæ˜ ï¼‰
Week 8-9:  çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®Ÿä¿‚æ•°ã§æ¤œè¨¼ï¼‰
```

#### è¿½åŠ è¨­è¨ˆææ¡ˆ: çµ¦ä¸ä¿‚æ•°ã®å±¥æ­´ç®¡ç†

å°†æ¥çš„ã«çµ¦ä¸ä¿‚æ•°ãŒå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚’è€ƒæ…®ã—ã€å±¥æ­´ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¾ã™ã€‚

```prisma
// ğŸ†• çµ¦ä¸ä¿‚æ•°å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆPhase 2å®Ÿè£…æ¨å¥¨ï¼‰
model CareerCourseSalaryHistory {
  id                   String   @id @default(cuid())
  courseCode           String   @map("course_code")
  baseSalaryMultiplier Decimal  @map("base_salary_multiplier") @db.Decimal(3, 2)
  effectiveFrom        DateTime @map("effective_from") @db.Date
  effectiveTo          DateTime? @map("effective_to") @db.Date
  changeReason         String?  @map("change_reason")  // ç†äº‹ä¼šæ±ºè­°ç•ªå·ç­‰
  approvedBy           String?  @map("approved_by")
  createdAt            DateTime @default(now()) @map("created_at")

  @@map("career_course_salary_history")
  @@index([courseCode, effectiveFrom])
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- çµ¦ä¸ä¿‚æ•°å¤‰æ›´ã®ç›£æŸ»è¨¼è·¡
- éå»ã®çµ¦ä¸è¨ˆç®—ã®å†ç¾æ€§ç¢ºä¿
- ç†äº‹ä¼šæ‰¿èªã¨ã®ç´ä»˜ã‘

---

### 2. ç‰¹ä¾‹å¤‰æ›´ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã«ã¤ã„ã¦

#### VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®è³ªå•

> ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§ç®¡ç†ã—ã¾ã™ã‹ï¼Ÿãã‚Œã¨ã‚‚VoiceDriveå´ã§ç®¡ç†ã™ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿ

#### å›ç­”: âœ… **åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§ç®¡ç†ã—ã¾ã™ï¼ˆAWS S3ä½¿ç”¨æ¨å¥¨ï¼‰**

**ç†ç”±**:
1. **æ³•çš„ä¿ç®¡ç¾©å‹™**: ä»‹è­·çŠ¶æ³è¨¼æ˜æ›¸ã€è¨ºæ–­æ›¸ç­‰ã¯3-5å¹´ã®ä¿ç®¡ç¾©å‹™ã‚ã‚Š
2. **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: äººäº‹éƒ¨é–€ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
3. **ç›£æŸ»å¯¾å¿œ**: ç¤¾åŠ´å£«ç›£æŸ»æ™‚ã«æå‡ºãŒå¿…è¦
4. **å€‹äººæƒ…å ±ä¿è­·**: åŒ»ç™‚ãƒ»ä»‹è­·æƒ…å ±ã‚’å«ã‚€ãŸã‚å³æ ¼ãªç®¡ç†ãŒå¿…è¦

#### å®Ÿè£…æ–¹é‡

**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹æˆ**:
```
AWS S3ãƒã‚±ãƒƒãƒˆ: medical-system-career-course-attachments

ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ :
/{facilityId}/{requestId}/{fileName}

ä¾‹:
/tategami-hospital/req-001/caregiving-certificate.pdf
/obara-hospital/req-002/medical-diagnosis.pdf
```

**ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**:
```json
{
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::ACCOUNT-ID:role/MedicalSystemHRRole"
      },
      "Action": ["s3:GetObject", "s3:PutObject"],
      "Resource": "arn:aws:s3:::medical-system-career-course-attachments/*"
    }
  ]
}
```

#### attachmentsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ§‹é€ ï¼ˆVoiceDriveææ¡ˆã‚’æ‰¿èªï¼‰

âœ… **VoiceDriveãƒãƒ¼ãƒ ã®ææ¡ˆæ§‹é€ ã‚’æ¡ç”¨ã—ã¾ã™**

```json
{
  "attachments": [
    {
      "fileName": "ä»‹è­·çŠ¶æ³è¨¼æ˜æ›¸.pdf",
      "fileUrl": "https://medical-system-s3.amazonaws.com/tategami-hospital/req-001/caregiving-certificate.pdf",
      "uploadedAt": "2025-10-27T10:00:00Z",
      "fileSize": 245678,
      "mimeType": "application/pdf"
    },
    {
      "fileName": "è¨ºæ–­æ›¸.pdf",
      "fileUrl": "https://medical-system-s3.amazonaws.com/tategami-hospital/req-001/medical-diagnosis.pdf",
      "uploadedAt": "2025-10-27T10:05:00Z",
      "fileSize": 189234,
      "mimeType": "application/pdf"
    }
  ]
}
```

#### âš ï¸ è¨‚æ­£: æ—¢å­˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹å¼ã‚’æµç”¨

**é‡è¦**: æ–°è¦APIå®Ÿè£…ã¯ä¸è¦ã§ã™ã€‚**æ—¢å­˜ã®é¡”å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰APIï¼ˆphase2-photo-webhook.tsï¼‰ã¨åŒã˜æ–¹å¼ã‚’ä½¿ç”¨**ã—ã¾ã™ã€‚

**å®Ÿè£…æ–¹é‡**: æ—¢å­˜ã® `POST /api/v2/upload/file` ã‚’æ‹¡å¼µï¼ˆfileTypeåˆ†å²è¿½åŠ ã®ã¿ï¼‰

```typescript
// åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ : src/api/v2/career-course/upload-attachment.ts

import { Request, Response } from 'express';
import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';
import multer from 'multer';
import { v4 as uuidv4 } from 'uuid';

const s3Client = new S3Client({ region: 'ap-northeast-1' });
const upload = multer({
  storage: multer.memoryStorage(),
  limits: { fileSize: 5 * 1024 * 1024 }  // 5MBåˆ¶é™
});

/**
 * POST /api/career-course/upload-attachment
 * æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
 */
export async function uploadAttachment(req: Request, res: Response) {
  const { requestId, employeeId } = req.body;
  const file = req.file;

  if (!file) {
    return res.status(400).json({ error: 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“' });
  }

  // è¨±å¯ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼
  const allowedMimeTypes = [
    'application/pdf',
    'image/jpeg',
    'image/png',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
  ];

  if (!allowedMimeTypes.includes(file.mimetype)) {
    return res.status(400).json({
      error: 'è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ï¼ˆPDF, JPEG, PNG, DOCXã®ã¿ï¼‰'
    });
  }

  // S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  const fileName = `${uuidv4()}-${file.originalname}`;
  const facilityId = await getFacilityIdFromEmployee(employeeId);
  const key = `${facilityId}/${requestId}/${fileName}`;

  try {
    await s3Client.send(new PutObjectCommand({
      Bucket: 'medical-system-career-course-attachments',
      Key: key,
      Body: file.buffer,
      ContentType: file.mimetype,
      Metadata: {
        uploadedBy: employeeId,
        requestId: requestId
      }
    }));

    const fileUrl = `https://medical-system-s3.amazonaws.com/${key}`;

    res.json({
      success: true,
      attachment: {
        fileName: file.originalname,
        fileUrl: fileUrl,
        uploadedAt: new Date().toISOString(),
        fileSize: file.size,
        mimeType: file.mimetype
      }
    });
  } catch (error) {
    console.error('S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
    res.status(500).json({ error: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ' });
  }
}
```

**VoiceDriveå´ã®å®Ÿè£…**:

VoiceDriveå´ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰APIã‚’å‘¼ã³å‡ºã™ã®ã¿ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã¯ä¸è¦ã§ã™ã€‚

```typescript
// VoiceDrive: careerCourseService.ts ã«è¿½åŠ 

async uploadAttachment(
  requestId: string,
  file: File
): Promise<CareerCourseAttachment> {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('requestId', requestId);
  formData.append('employeeId', this.currentEmployeeId);

  const response = await fetch(
    `${this.medicalApiBaseUrl}/api/career-course/upload-attachment`,
    {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.authToken}`
      },
      body: formData
    }
  );

  if (!response.ok) {
    throw new Error('ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }

  const data = await response.json();
  return data.attachment;
}
```

**ä¿ç®¡æœŸé–“**:
- åŸå‰‡: 5å¹´é–“ä¿ç®¡ï¼ˆç¤¾åŠ´å£«ç›£æŸ»å¯¾å¿œï¼‰
- è‡ªå‹•å‰Šé™¤: 5å¹´çµŒéå¾Œã«S3 Lifecycle Policyã§è‡ªå‹•å‰Šé™¤

---

### 3. ç”³è«‹ã®å¹´é–“å›æ•°åˆ¶é™ã«ã¤ã„ã¦

#### VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®è³ªå•

> å¹´1å›ã®å®šæœŸå¤‰æ›´ + ç‰¹ä¾‹å¤‰æ›´ï¼ˆå›æ•°åˆ¶é™ãªã—ï¼‰ã¨ã„ã†ç†è§£ã§æ­£ã—ã„ã§ã™ã‹ï¼Ÿ

#### å›ç­”: âœ… **æ­£ã—ã„ã§ã™ã€‚VoiceDriveãƒãƒ¼ãƒ ã®ææ¡ˆãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‰¿èªã—ã¾ã™ã€‚**

**ç”³è«‹ãƒ«ãƒ¼ãƒ«**:

| ç”³è«‹ã‚¿ã‚¤ãƒ— | å›æ•°åˆ¶é™ | æ¡ä»¶ | å‚™è€ƒ |
|----------|---------|------|------|
| **å®šæœŸå¤‰æ›´ï¼ˆannualï¼‰** | å¹´1å› | æ¯å¹´4æœˆ1æ—¥ã‹ã‚‰ç”³è«‹å¯èƒ½ | æ¬¡å›å¤‰æ›´å¯èƒ½æ—¥: å‰å›ç”³è«‹æ—¥+365æ—¥ |
| **ç‰¹ä¾‹å¤‰æ›´ï¼ˆpregnancyï¼‰** | ç„¡åˆ¶é™ | å¦Šå¨ è¨¼æ˜æ›¸å¿…é ˆ | è¨ºæ–­æ›¸æ·»ä»˜ |
| **ç‰¹ä¾‹å¤‰æ›´ï¼ˆcaregivingï¼‰** | ç„¡åˆ¶é™ | ä»‹è­·çŠ¶æ³è¨¼æ˜æ›¸å¿…é ˆ | å¸‚åŒºç”ºæ‘ç™ºè¡Œã®è¨¼æ˜æ›¸ |
| **ç‰¹ä¾‹å¤‰æ›´ï¼ˆillnessï¼‰** | ç„¡åˆ¶é™ | è¨ºæ–­æ›¸å¿…é ˆ | åŒ»å¸«ã®è¨ºæ–­æ›¸ |

#### VoiceDriveãƒãƒ¼ãƒ ææ¡ˆã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‰¿èª

âœ… **ææ¡ˆã•ã‚ŒãŸ`canSubmitRequest()`ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…¨é¢çš„ã«æ¡ç”¨ã—ã¾ã™**

```typescript
/**
 * ç”³è«‹å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯
 * VoiceDriveãƒãƒ¼ãƒ ææ¡ˆã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¡ç”¨
 */
async function canSubmitRequest(staffId: string): Promise<{
  canSubmit: boolean;
  reason?: string;
}> {
  // 1. æ‰¿èªå¾…ã¡ã®ç”³è«‹ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
  const pendingRequest = await prisma.careerCourseChangeRequest.findFirst({
    where: { staffId, approvalStatus: 'pending' }
  });

  if (pendingRequest) {
    return {
      canSubmit: false,
      reason: 'æ‰¿èªå¾…ã¡ã®ç”³è«‹ãŒã‚ã‚Šã¾ã™ã€‚æ‰¿èªã¾ãŸã¯å´ä¸‹ã•ã‚Œã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚'
    };
  }

  // 2. æ¬¡å›å¤‰æ›´å¯èƒ½æ—¥ã‚’ãƒã‚§ãƒƒã‚¯
  const currentSelection = await prisma.careerCourseSelection.findFirst({
    where: { staffId, effectiveTo: null },
    orderBy: { effectiveFrom: 'desc' }
  });

  if (currentSelection?.nextChangeAvailableDate) {
    const today = new Date();
    const nextDate = new Date(currentSelection.nextChangeAvailableDate);

    if (today < nextDate) {
      return {
        canSubmit: false,
        reason: `æ¬¡å›å¤‰æ›´å¯èƒ½æ—¥ã¯ ${nextDate.toLocaleDateString('ja-JP')} ã§ã™ï¼ˆå®šæœŸå¤‰æ›´ã®å ´åˆï¼‰ã€‚ç‰¹ä¾‹å¤‰æ›´ï¼ˆå¦Šå¨ ãƒ»ä»‹è­·ãƒ»ç—…æ°—ï¼‰ã®å ´åˆã¯ç”³è«‹å¯èƒ½ã§ã™ã€‚`
      };
    }
  }

  return { canSubmit: true };
}
```

#### è¿½åŠ å®Ÿè£…: ç‰¹ä¾‹å¤‰æ›´ã®å„ªå…ˆå‡¦ç†

ç‰¹ä¾‹å¤‰æ›´ã¯`nextChangeAvailableDate`ã‚’ç„¡è¦–ã—ã¦ç”³è«‹å¯èƒ½ã«ã—ã¾ã™ã€‚

```typescript
/**
 * ç”³è«‹å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆç‰¹ä¾‹å¤‰æ›´è€ƒæ…®ç‰ˆï¼‰
 */
async function canSubmitRequest(
  staffId: string,
  changeReason: 'annual' | 'special_pregnancy' | 'special_caregiving' | 'special_illness'
): Promise<{
  canSubmit: boolean;
  reason?: string;
}> {
  // 1. æ‰¿èªå¾…ã¡ã®ç”³è«‹ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆå…¨ã‚¿ã‚¤ãƒ—å…±é€šï¼‰
  const pendingRequest = await prisma.careerCourseChangeRequest.findFirst({
    where: { staffId, approvalStatus: 'pending' }
  });

  if (pendingRequest) {
    return {
      canSubmit: false,
      reason: 'æ‰¿èªå¾…ã¡ã®ç”³è«‹ãŒã‚ã‚Šã¾ã™ã€‚'
    };
  }

  // 2. ç‰¹ä¾‹å¤‰æ›´ã®å ´åˆã¯æ¬¡å›å¤‰æ›´å¯èƒ½æ—¥ã‚’ç„¡è¦–
  if (changeReason.startsWith('special_')) {
    return { canSubmit: true };
  }

  // 3. å®šæœŸå¤‰æ›´ã®å ´åˆã®ã¿æ¬¡å›å¤‰æ›´å¯èƒ½æ—¥ã‚’ãƒã‚§ãƒƒã‚¯
  const currentSelection = await prisma.careerCourseSelection.findFirst({
    where: { staffId, effectiveTo: null },
    orderBy: { effectiveFrom: 'desc' }
  });

  if (currentSelection?.nextChangeAvailableDate) {
    const today = new Date();
    const nextDate = new Date(currentSelection.nextChangeAvailableDate);

    if (today < nextDate) {
      return {
        canSubmit: false,
        reason: `å®šæœŸå¤‰æ›´ã¯ ${nextDate.toLocaleDateString('ja-JP')} ã‹ã‚‰ç”³è«‹å¯èƒ½ã§ã™ã€‚`
      };
    }
  }

  return { canSubmit: true };
}
```

#### ç”³è«‹å–ã‚Šä¸‹ã’å¾Œã®å†ç”³è«‹åˆ¶é™

**ãƒ«ãƒ¼ãƒ«**: âœ… **åŒæ—¥ä¸­ã®å†ç”³è«‹ã¯ä¸å¯ã€ç¿Œæ—¥ã‹ã‚‰å†ç”³è«‹å¯èƒ½**

```typescript
/**
 * å–ã‚Šä¸‹ã’å¾Œã®å†ç”³è«‹å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯
 */
async function canResubmitAfterWithdrawal(staffId: string): Promise<{
  canSubmit: boolean;
  reason?: string;
}> {
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  // æœ¬æ—¥ä¸­ã«å–ã‚Šä¸‹ã’ãŸç”³è«‹ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
  const todayWithdrawn = await prisma.careerCourseChangeRequest.findFirst({
    where: {
      staffId,
      approvalStatus: 'withdrawn',
      withdrawnAt: {
        gte: today
      }
    }
  });

  if (todayWithdrawn) {
    return {
      canSubmit: false,
      reason: 'æœ¬æ—¥ä¸­ã«å–ã‚Šä¸‹ã’ãŸç”³è«‹ãŒã‚ã‚‹ãŸã‚ã€å†ç”³è«‹ã¯ç¿Œæ—¥ä»¥é™ã«å¯èƒ½ã§ã™ã€‚'
    };
  }

  return { canSubmit: true };
}
```

---

### 4. Webhookã®ãƒªãƒˆãƒ©ã‚¤ãƒãƒªã‚·ãƒ¼ã«ã¤ã„ã¦

#### VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®è³ªå•

> Webhooké€ä¿¡å¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤å›æ•°ã€ãƒªãƒˆãƒ©ã‚¤é–“éš”ã€æ°¸ç¶šçš„å¤±æ•—æ™‚ã®é€šçŸ¥æ–¹æ³•ã¯ï¼Ÿ

#### å›ç­”: âœ… **VoiceDriveãƒãƒ¼ãƒ ã®ææ¡ˆãƒãƒªã‚·ãƒ¼ã‚’å…¨é¢çš„ã«æ¡ç”¨ã—ã¾ã™**

**ãƒªãƒˆãƒ©ã‚¤è¨­å®šï¼ˆVoiceDriveææ¡ˆã‚’æ‰¿èªï¼‰**:

| é …ç›® | è¨­å®šå€¤ | å‚™è€ƒ |
|-----|--------|------|
| æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•° | 3å› | è¨ˆ4å›ã®é€ä¿¡è©¦è¡Œ |
| 1å›ç›®ãƒªãƒˆãƒ©ã‚¤ | 1ç§’å¾Œ | ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³å¯¾å¿œ |
| 2å›ç›®ãƒªãƒˆãƒ©ã‚¤ | 5ç§’å¾Œ | ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•å¾…ã¡ |
| 3å›ç›®ãƒªãƒˆãƒ©ã‚¤ | 15ç§’å¾Œ | é•·æ™‚é–“éšœå®³ã‹ã‚‰ã®å¾©æ—§å¾…ã¡ |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 10ç§’ | 1å›ã‚ãŸã‚Šã®é€ä¿¡ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ |

#### å®Ÿè£…ã‚³ãƒ¼ãƒ‰ï¼ˆVoiceDriveææ¡ˆã‚’æ¡ç”¨ï¼‰

âœ… **VoiceDriveãƒãƒ¼ãƒ ãŒææ¡ˆã—ãŸ`sendWebhookWithRetry()`ã‚’ãã®ã¾ã¾æ¡ç”¨ã—ã¾ã™**

```typescript
// åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ : src/services/webhook/sendCareerCourseNotification.ts

const WEBHOOK_RETRY_CONFIG = {
  maxRetries: 3,
  retryDelays: [1000, 5000, 15000],  // 1ç§’ã€5ç§’ã€15ç§’
  timeout: 10000  // 10ç§’
};

/**
 * Webhookãƒªãƒˆãƒ©ã‚¤é€ä¿¡
 * VoiceDriveãƒãƒ¼ãƒ ææ¡ˆã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¡ç”¨
 */
async function sendWebhookWithRetry(
  url: string,
  payload: any,
  retries = 0
): Promise<boolean> {
  try {
    const signature = generateHMAC(
      payload,
      process.env.CAREER_COURSE_WEBHOOK_SECRET || ''
    );

    const controller = new AbortController();
    const timeoutId = setTimeout(
      () => controller.abort(),
      WEBHOOK_RETRY_CONFIG.timeout
    );

    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Medical-System-Signature': signature
      },
      body: JSON.stringify(payload),
      signal: controller.signal
    });

    clearTimeout(timeoutId);

    if (response.ok) {
      console.log('âœ… Webhooké€ä¿¡æˆåŠŸ:', {
        type: payload.type,
        staffId: payload.staffId,
        attempt: retries + 1
      });
      return true;
    }

    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
  } catch (error) {
    console.error(
      `âŒ Webhooké€ä¿¡å¤±æ•— (è©¦è¡Œ ${retries + 1}/${WEBHOOK_RETRY_CONFIG.maxRetries + 1}):`,
      {
        error: error instanceof Error ? error.message : String(error),
        payload: payload
      }
    );

    if (retries < WEBHOOK_RETRY_CONFIG.maxRetries) {
      const delay = WEBHOOK_RETRY_CONFIG.retryDelays[retries];
      console.log(`â³ ${delay}mså¾Œã«ãƒªãƒˆãƒ©ã‚¤ã—ã¾ã™...`);

      await new Promise(resolve => setTimeout(resolve, delay));
      return sendWebhookWithRetry(url, payload, retries + 1);
    }

    // å…¨ãƒªãƒˆãƒ©ã‚¤å¤±æ•—æ™‚: ç®¡ç†è€…ã«é€šçŸ¥ + ãƒ­ã‚°è¨˜éŒ²
    await handleWebhookPermanentFailure(payload);
    return false;
  }
}
```

#### æ°¸ç¶šçš„å¤±æ•—æ™‚ã®é€šçŸ¥æ–¹æ³•

**3æ®µéšã®é€šçŸ¥**:

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ­ã‚°è¨˜éŒ²**:
```typescript
async function handleWebhookPermanentFailure(payload: any) {
  // 1. å¤±æ•—ãƒ­ã‚°ã‚’DBã«è¨˜éŒ²
  await prisma.webhookFailureLog.create({
    data: {
      webhookType: 'career_course_notification',
      payload: JSON.stringify(payload),
      failedAt: new Date(),
      retryCount: WEBHOOK_RETRY_CONFIG.maxRetries,
      errorMessage: 'å…¨ãƒªãƒˆãƒ©ã‚¤å¤±æ•—'
    }
  });

  // 2. ç®¡ç†è€…ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
  await sendAdminEmail({
    subject: 'ã€é‡è¦ã€‘Webhooké€ä¿¡å¤±æ•— - ã‚­ãƒ£ãƒªã‚¢ã‚³ãƒ¼ã‚¹å¤‰æ›´é€šçŸ¥',
    body: `
      è·å“¡ID: ${payload.staffId}
      ç”³è«‹ID: ${payload.requestId}
      é€šçŸ¥ã‚¿ã‚¤ãƒ—: ${payload.type}

      VoiceDriveã¸ã®é€šçŸ¥é€ä¿¡ãŒ4å›å¤±æ•—ã—ã¾ã—ãŸã€‚
      æ‰‹å‹•ã§ã®é€šçŸ¥ãŒå¿…è¦ã§ã™ã€‚
    `,
    to: 'hr-admin@hospital.local'
  });

  // 3. Slackãƒãƒ£ãƒ³ãƒãƒ«ã«é€šçŸ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  await sendSlackNotification({
    channel: '#medical-system-alerts',
    message: `ğŸš¨ Webhooké€ä¿¡å¤±æ•—\nè·å“¡ID: ${payload.staffId}\nç”³è«‹ID: ${payload.requestId}`
  });
}
```

2. **ç®¡ç†ç”»é¢ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º**:
```typescript
// åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ç”»é¢: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«å¤±æ•—ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
const failedWebhooks = await prisma.webhookFailureLog.findMany({
  where: {
    resolvedAt: null,  // æœªè§£æ±ºã®ã¿
    failedAt: {
      gte: new Date(Date.now() - 24 * 60 * 60 * 1000)  // éå»24æ™‚é–“
    }
  },
  orderBy: { failedAt: 'desc' }
});

// ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«èµ¤è‰²ãƒãƒƒã‚¸ã§è¡¨ç¤º
```

3. **æ‰‹å‹•å†é€æ©Ÿèƒ½**:
```typescript
// ç®¡ç†ç”»é¢ã‹ã‚‰æ‰‹å‹•å†é€
async function manualRetryWebhook(failureLogId: string) {
  const log = await prisma.webhookFailureLog.findUnique({
    where: { id: failureLogId }
  });

  if (!log) return;

  const payload = JSON.parse(log.payload);
  const success = await sendWebhookWithRetry(
    process.env.VOICEDRIVE_WEBHOOK_URL,
    payload
  );

  if (success) {
    await prisma.webhookFailureLog.update({
      where: { id: failureLogId },
      data: {
        resolvedAt: new Date(),
        resolvedBy: 'admin-manual-retry'
      }
    });
  }
}
```

#### WebhookFailureLogãƒ†ãƒ¼ãƒ–ãƒ«ã®è¿½åŠ 

```prisma
model WebhookFailureLog {
  id           String    @id @default(cuid())
  webhookType  String    @map("webhook_type")  // 'career_course_notification'
  payload      String    @db.Text  // JSONæ–‡å­—åˆ—
  failedAt     DateTime  @default(now()) @map("failed_at")
  retryCount   Int       @map("retry_count")
  errorMessage String    @map("error_message")
  resolvedAt   DateTime? @map("resolved_at")
  resolvedBy   String?   @map("resolved_by")  // 'admin-manual-retry' | 'auto-retry-success'
  createdAt    DateTime  @default(now()) @map("created_at")

  @@map("webhook_failure_logs")
  @@index([failedAt])
  @@index([resolvedAt])
}
```

---

## âœ… VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®ææ¡ˆã¸ã®åˆæ„

### 1. å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

âœ… **Phase 1.6ï¼ˆå…±é€šDBæ§‹ç¯‰ï¼‰ã¨åŒæ™‚å®Ÿæ–½ã‚’æ‰¿èªã—ã¾ã™**

**ç†ç”±**:
- ã‚­ãƒ£ãƒªã‚¢ã‚³ãƒ¼ã‚¹ç®¡ç†ã¯äººäº‹æ¥­å‹™ã®ä¸­æ ¸æ©Ÿèƒ½
- ä»–ã®åŸºå¹¹æ©Ÿèƒ½ã¨ä¾å­˜é–¢ä¿‚ãŒå°‘ãªã„
- VoiceDriveå´UIå®Ÿè£…å®Œäº†æ¸ˆã¿

**åˆæ„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**:
```
Week 1-2:  åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ DBæ§‹ç¯‰ + APIå®Ÿè£…
Week 3:    Webhookå®Ÿè£… + VoiceDriveå´Webhookå—ä¿¡å®Ÿè£…
Week 4-5:  åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ç”»é¢å®Ÿè£…
Week 6:    çµ±åˆãƒ†ã‚¹ãƒˆ + E2Eãƒ†ã‚¹ãƒˆ
```

---

### 2. Webhook Secret Key

âœ… **é–‹ç™ºç’°å¢ƒç”¨Secret Keyã‚’æ‰¿èªã—ã¾ã™**

**é–‹ç™ºç’°å¢ƒ**:
```bash
CAREER_COURSE_WEBHOOK_SECRET=voicedrive_medical_system_webhook_secret_dev_2025
```

**æœ¬ç•ªç’°å¢ƒ**:
```bash
# AWS Secrets Managerã§ç®¡ç†
# Secret Name: medical-system/career-course/webhook-secret
# 64æ–‡å­—ä»¥ä¸Šã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã‚’ç”Ÿæˆ
# å®šæœŸãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³: 3ãƒ¶æœˆã”ã¨
```

**HMACå®Ÿè£…**:
âœ… VoiceDriveãƒãƒ¼ãƒ ãŒææ¡ˆã—ãŸ`generateHMAC()`ã¨`verifyHMAC()`ã‚’ãã®ã¾ã¾æ¡ç”¨ã—ã¾ã™ã€‚

---

### 3. VoiceDriveå´Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…

âœ… **Week 3å®Ÿè£…è¨ˆç”»ã‚’æ‰¿èªã—ã¾ã™**

**å®Ÿè£…å†…å®¹**:
- âœ… `/api/webhooks/career-course` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- âœ… HMACç½²åæ¤œè¨¼
- âœ… é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ

**å®Ÿè£…ã‚³ãƒ¼ãƒ‰**:
âœ… VoiceDriveãƒãƒ¼ãƒ ãŒææ¡ˆã—ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…ã‚³ãƒ¼ãƒ‰ã‚’æ‰¿èªã—ã¾ã™ã€‚

**ãƒ†ã‚¹ãƒˆå”åŠ›**:
åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã‹ã‚‰ä»¥ä¸‹ã®çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã™ï¼š
1. æ‰¿èªé€šçŸ¥ã®é€ä¿¡ãƒ»å—ä¿¡ãƒ†ã‚¹ãƒˆ
2. å´ä¸‹é€šçŸ¥ã®é€ä¿¡ãƒ»å—ä¿¡ãƒ†ã‚¹ãƒˆ
3. HMACç½²åæ¤œè¨¼ãƒ†ã‚¹ãƒˆ
4. ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

---

### 4. ãƒ‡ãƒ¼ã‚¿ç®¡ç†è²¬ä»»

âœ… **ä»¥ä¸‹ã®è²¬ä»»åˆ†æ‹…ã§åˆæ„ã—ã¾ã™**

| ãƒ‡ãƒ¼ã‚¿ | ç®¡ç†è€… | å‚™è€ƒ |
|--------|--------|------|
| **ã‚³ãƒ¼ã‚¹å®šç¾©** | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  100% | career_course_definitions |
| **ç¾åœ¨ã®ã‚³ãƒ¼ã‚¹é¸æŠ** | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  100% | career_course_selections |
| **ç”³è«‹å±¥æ­´** | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  100% | career_course_change_requests |
| **æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«** | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  100% | AWS S3ç®¡ç† |
| **çµ¦ä¸ä¿‚æ•°** | åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ  100% | äººäº‹éƒ¨é–€èª¿æ•´å¾Œç¢ºå®š |
| **UIè¡¨ç¤º** | VoiceDrive 100% | MyRequestsPage |
| **é€šçŸ¥å‡¦ç†** | VoiceDrive 100% | CareerCourseNotificationService |

---

## ğŸ“Š å®Ÿè£…çŠ¶æ…‹ã®æœ€çµ‚ç¢ºèªï¼ˆåŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ï¼‰

### è¿½åŠ å®Ÿè£…é …ç›®ï¼ˆâš ï¸ è¨‚æ­£ç‰ˆï¼šæ—¢å­˜æ©Ÿèƒ½æµç”¨ã«ã‚ˆã‚Šå¤§å¹…å‰Šæ¸›ï¼‰

| é …ç›® | å†…å®¹ | å…ƒã®å·¥æ•° | è¨‚æ­£å¾Œ | çŠ¶æ…‹ |
|------|------|---------|-------|------|
| **1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰** | ~~æ–°è¦API~~ â†’ æ—¢å­˜APIæ‹¡å¼µï¼ˆifåˆ†å²è¿½åŠ ï¼‰ | ~~1æ—¥~~ | **0.1æ—¥** | âœ… æ—¢å­˜æµç”¨ |
| **2. S3çµ±åˆ** | ~~æ–°è¦ãƒã‚±ãƒƒãƒˆ~~ â†’ æ—¢å­˜ãƒã‚±ãƒƒãƒˆæµç”¨ | ~~0.5æ—¥~~ | **0æ—¥** | âœ… æ—¢å­˜æµç”¨ |
| **3. WebhookFailureLogãƒ†ãƒ¼ãƒ–ãƒ«** | æ°¸ç¶šçš„å¤±æ•—è¨˜éŒ² | 0.25æ—¥ | 0.25æ—¥ | ğŸ†• è¿½åŠ  |
| **4. ç®¡ç†è€…é€šçŸ¥æ©Ÿèƒ½** | ~~æ–°è¦å®Ÿè£…~~ â†’ æ—¢å­˜Slackã‚¢ãƒ©ãƒ¼ãƒˆæµç”¨ | ~~0.5æ—¥~~ | **0æ—¥** | âœ… æ—¢å­˜æµç”¨ |
| **5. æ‰‹å‹•å†é€æ©Ÿèƒ½** | ç®¡ç†ç”»é¢ã‹ã‚‰Webhookå†é€ | 0.5æ—¥ | 0æ—¥ | â³ Phase 2 |
| **6. Webhookã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ ** | å‹å®šç¾©+é–¢æ•°1ã¤ï¼ˆphase2-photo-webhook.tsï¼‰ | - | **0.1æ—¥** | ğŸ†• è¿½åŠ  |
| **7. çµ¦ä¸ä¿‚æ•°å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«** | CareerCourseSalaryHistory | 0.5æ—¥ | 0.5æ—¥ | â³ Phase 2 |

**å‰Šæ¸›**: -2.3æ—¥
**æ›´æ–°å¾Œã®åˆè¨ˆå·¥æ•°**: 22æ—¥ + ~~2.75æ—¥~~ â†’ **22æ—¥ + 0.45æ—¥ = 22.45æ—¥ï¼ˆç´„4.5é€±é–“ï¼‰**

---

## ğŸ“… æ›´æ–°å¾Œã®å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹ç¯‰ï¼ˆ1.5é€±é–“ï¼‰

| æ—¥ä»˜ | ä½œæ¥­å†…å®¹ | æ‹…å½“ | çŠ¶æ…‹ |
|------|---------|------|------|
| Day 1-2 | 3ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ + WebhookFailureLogè¿½åŠ  | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 3 | S3ãƒã‚±ãƒƒãƒˆè¨­å®š | DevOps | â³ æœªå®Ÿè£… |
| Day 4-5 | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ + åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |

---

### Phase 2: APIå®Ÿè£…ï¼ˆ1.5é€±é–“ï¼‰

| æ—¥ä»˜ | ä½œæ¥­å†…å®¹ | æ‹…å½“ | çŠ¶æ…‹ |
|------|---------|------|------|
| Day 1-2 | GET /my-requests, GET /definitions å®Ÿè£… | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 3 | POST /change-request å®Ÿè£… | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 4 | POST /upload-attachment å®Ÿè£… ğŸ†• | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 5 | JWTèªè¨¼å®Ÿè£… | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |

---

### Phase 3: Webhookå®Ÿè£…ï¼ˆ1é€±é–“ï¼‰

| æ—¥ä»˜ | ä½œæ¥­å†…å®¹ | æ‹…å½“ | çŠ¶æ…‹ |
|------|---------|------|------|
| Day 1 | HMACç½²åç”Ÿæˆæ©Ÿèƒ½ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 2 | sendWebhookWithRetryå®Ÿè£… ğŸ†• | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 3 | ç®¡ç†è€…é€šçŸ¥æ©Ÿèƒ½ï¼ˆãƒ¡ãƒ¼ãƒ«ã€Slackï¼‰ğŸ†• | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |

---

### Phase 4: ç®¡ç†ç”»é¢å®Ÿè£…ï¼ˆ1.5é€±é–“ï¼‰

| æ—¥ä»˜ | ä½œæ¥­å†…å®¹ | æ‹…å½“ | çŠ¶æ…‹ |
|------|---------|------|------|
| Day 1-3 | ç”³è«‹ä¸€è¦§ç”»é¢ | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 4-5 | ç”³è«‹è©³ç´°ç”»é¢ | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 6 | æ‰¿èªãƒ»å´ä¸‹å‡¦ç† | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |
| Day 7 | æ‰‹å‹•å†é€æ©Ÿèƒ½ ğŸ†• | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | â³ æœªå®Ÿè£… |

---

### Phase 5: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ1é€±é–“ï¼‰

| æ—¥ä»˜ | ä½œæ¥­å†…å®¹ | æ‹…å½“ | çŠ¶æ…‹ |
|------|---------|------|------|
| Day 1-2 | APIçµ±åˆãƒ†ã‚¹ãƒˆ | QA | â³ æœªå®Ÿè£… |
| Day 3-4 | Webhookçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆVoiceDriveã¨å”åŠ›ï¼‰ğŸ†• | QA + VoiceDrive | â³ æœªå®Ÿè£… |
| Day 5 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ ğŸ†• | QA | â³ æœªå®Ÿè£… |

---

### Phase 6: E2Eãƒ†ã‚¹ãƒˆï¼ˆ0.5é€±é–“ï¼‰

| æ—¥ä»˜ | ä½œæ¥­å†…å®¹ | æ‹…å½“ | çŠ¶æ…‹ |
|------|---------|------|------|
| Day 1 | ç”³è«‹ä½œæˆâ†’å¯©æŸ»â†’é€šçŸ¥â†’ç”»é¢æ›´æ–° | QA + VoiceDrive | â³ æœªå®Ÿè£… |
| Day 2 | ãƒªãƒˆãƒ©ã‚¤ãƒ»å¤±æ•—é€šçŸ¥ãƒ†ã‚¹ãƒˆ ğŸ†• | QA + VoiceDrive | â³ æœªå®Ÿè£… |

---

## ğŸ¯ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ 

1. âœ… VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®ç¢ºèªäº‹é …ã«å›ç­”å®Œäº†
2. âœ… è¿½åŠ å®Ÿè£…é …ç›®ã®å·¥æ•°è¦‹ç©ã‚‚ã‚Šå®Œäº†
3. â³ Phase 1.6å®Ÿæ–½æ—¥ã®ç¢ºå®šå¾…ã¡
4. â³ å®Ÿè£…é–‹å§‹æº–å‚™

### VoiceDriveãƒãƒ¼ãƒ 

1. âœ… åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å›ç­”æ›¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
2. â³ Week 3ã§ã®Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
3. â³ çµ±åˆãƒ†ã‚¹ãƒˆæº–å‚™

---

## ğŸ“ æœ€çµ‚ç¢ºèª

ä»¥ä¸‹ã®å†…å®¹ã§åˆæ„ã§ãã¾ã—ãŸã‚‰ã€å®Ÿè£…ã‚’é–‹å§‹ã„ãŸã—ã¾ã™ï¼š

### âœ… åˆæ„äº‹é …ï¼ˆ8é …ç›®ï¼‰

1. âœ… çµ¦ä¸ä¿‚æ•°ã¯ä»®è¨­å®šã§å®Ÿè£…ã€Phase 2ã§äººäº‹éƒ¨é–€ã¨èª¿æ•´
2. âœ… æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã¯åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ å´ã§S3ç®¡ç†
3. âœ… VoiceDriveææ¡ˆã®attachmentsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ§‹é€ ã‚’æ¡ç”¨
4. âœ… ç”³è«‹ãƒ«ãƒ¼ãƒ«: å¹´1å›å®šæœŸ + ç‰¹ä¾‹ç„¡åˆ¶é™
5. âœ… VoiceDriveææ¡ˆã®ç”³è«‹å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¡ç”¨
6. âœ… Webhookãƒªãƒˆãƒ©ã‚¤: 3å›ã€1ç§’/5ç§’/15ç§’é–“éš”
7. âœ… æ°¸ç¶šçš„å¤±æ•—æ™‚: DBè¨˜éŒ² + ãƒ¡ãƒ¼ãƒ« + Slacké€šçŸ¥
8. âœ… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: Phase 1.6ã¨åŒæ™‚å®Ÿæ–½ï¼ˆç´„5é€±é–“ï¼‰

### ğŸ“‹ è¿½åŠ å®Ÿè£…é …ç›®ï¼ˆâš ï¸ è¨‚æ­£ï¼šæ—¢å­˜æ©Ÿèƒ½æµç”¨ã«ã‚ˆã‚Šå‰Šæ¸›ï¼‰

1. ~~ğŸ†• POST /api/career-course/upload-attachment~~ â†’ âœ… **æ—¢å­˜APIæ‹¡å¼µï¼ˆ0.1æ—¥ï¼‰**
2. ~~ğŸ†• S3çµ±åˆ~~ â†’ âœ… **æ—¢å­˜ãƒã‚±ãƒƒãƒˆæµç”¨ï¼ˆ0æ—¥ï¼‰**
3. ğŸ†• WebhookFailureLogãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ0.25æ—¥ï¼‰
4. ~~ğŸ†• ç®¡ç†è€…é€šçŸ¥æ©Ÿèƒ½~~ â†’ âœ… **æ—¢å­˜Slackã‚¢ãƒ©ãƒ¼ãƒˆæµç”¨ï¼ˆ0æ—¥ï¼‰**
5. ~~ğŸ†• æ‰‹å‹•å†é€æ©Ÿèƒ½~~ â†’ â³ **Phase 2ã¸å»¶æœŸï¼ˆ0æ—¥ï¼‰**
6. ğŸ†• Webhookã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ ï¼ˆ0.1æ—¥ï¼‰

### ğŸ“Š æ›´æ–°å¾Œã®åˆè¨ˆå·¥æ•°

**~~24.75æ—¥~~** â†’ **22.45æ—¥ï¼ˆç´„4.5é€±é–“ï¼‰** â† **-2.3æ—¥å‰Šæ¸›**

---

## ğŸ™ æ„Ÿè¬

VoiceDriveãƒãƒ¼ãƒ ã‹ã‚‰ã®è©³ç´°ãªç¢ºèªäº‹é …ã¨ã”ææ¡ˆã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚ææ¡ˆã„ãŸã ã„ãŸãƒ­ã‚¸ãƒƒã‚¯ãƒ»å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã¯å…¨ã¦éå¸¸ã«çš„ç¢ºã§ã€ãã®ã¾ã¾æ¡ç”¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚

ä¸¡ãƒãƒ¼ãƒ ãŒå”åŠ›ã—ã€åŒ»ç™‚ç¾å ´ã®ã‚­ãƒ£ãƒªã‚¢é¸æŠåˆ¶åº¦ã‚’å®Ÿç¾ã—ã¦ã¾ã„ã‚Šã¾ã™ã€‚å¼•ãç¶šãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚

---

**æ–‡æ›¸çµ‚äº†**

æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ27æ—¥
ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0
æ‰¿èª: åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ æ‰¿èªæ¸ˆã¿ã€VoiceDriveãƒãƒ¼ãƒ ç¢ºèªå¾…ã¡
æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼: Phase 1.6å®Ÿæ–½æ—¥ç¢ºå®šå¾Œ
