# アカウントレベル定義変更 影響範囲調査報告書

**調査番号**: ACLV-IMP-YYYY-MM-DD-XXX
**調査日**: YYYY年MM月DD日
**調査者**: [医療チーム / VoiceDriveチーム]
**調査者名**: [氏名]
**対象変更**: [変更提案書番号: ACLV-YYYY-MM-DD-XXX]

---

## エグゼクティブサマリー

### 変更内容（簡潔に）
[1-2行で変更内容を記述]

### 影響範囲サマリー

| 項目 | 影響度 | 工数見積 | リスク |
|------|--------|---------|--------|
| データベース設計 | [高/中/低] | X時間 | [高/中/低] |
| バックエンドロジック | [高/中/低] | X時間 | [高/中/低] |
| API仕様 | [高/中/低] | X時間 | [高/中/低] |
| フロントエンドUI | [高/中/低] | X時間 | [高/中/低] |
| 既存データ移行 | [高/中/低] | X時間 | [高/中/低] |
| テストケース | [高/中/低] | X時間 | [高/中/低] |
| ドキュメント | [高/中/低] | X時間 | [高/中/低] |

**総合判定**: [実装可能 / 要検討 / 実装困難]
**総工数見積**: ____ 時間（____ 日間）
**推奨実装優先度**: [高 / 中 / 低]

---

## 1. データベースへの影響

### 1.1 スキーマ変更

#### 影響を受けるテーブル

| テーブル名 | 変更内容 | 影響度 | 備考 |
|----------|---------|--------|------|
| `unified_staff_master` | [変更内容] | [高/中/低] | [備考] |
| `account_integration` | [変更内容] | [高/中/低] | [備考] |
| [その他のテーブル] | [変更内容] | [高/中/低] | [備考] |

#### 必要なDDL

```sql
-- 【医療側】
ALTER TABLE unified_staff_master
  ADD COLUMN xxxxx VARCHAR(50);

-- 【VoiceDrive側】
ALTER TABLE users
  ADD COLUMN xxxxx VARCHAR(50);
```

### 1.2 既存データへの影響

**影響を受けるレコード数**: 約 ____ 件

| データ種別 | レコード数 | 移行方法 | 工数見積 |
|----------|----------|---------|---------|
| 既存職員データ | XXX件 | [バッチ処理/手動] | X時間 |
| 履歴データ | XXX件 | [バッチ処理/手動] | X時間 |
| [その他] | XXX件 | [バッチ処理/手動] | X時間 |

#### データ移行スクリプト（案）

```sql
-- 既存データの更新例
UPDATE unified_staff_master
SET voicedrive_account_level = XXXXX
WHERE position_id = 'XXXXX'
  AND facility_id = 'xxxxx-xxxxx';
```

### 1.3 インデックスへの影響

- [ ] 新規インデックスの追加が必要
- [ ] 既存インデックスの変更が必要
- [ ] インデックスへの影響なし

**必要なインデックス変更**:
```sql
CREATE INDEX idx_xxxxx ON table_name(column_name);
```

---

## 2. バックエンドロジックへの影響

### 2.1 医療システム側

#### 影響を受けるファイル

| ファイル名 | 影響内容 | 変更行数 | 影響度 | 工数 |
|-----------|---------|---------|--------|------|
| `accountLevelCalculator.ts` | [詳細] | XX行 | [高/中/低] | X時間 |
| `facility-position-mapping.ts` | [詳細] | XX行 | [高/中/低] | X時間 |
| `accessControl.ts` | [詳細] | XX行 | [高/中/低] | X時間 |
| [その他] | [詳細] | XX行 | [高/中/低] | X時間 |

#### 変更が必要なロジック

**変更箇所1**: `accountLevelCalculator.ts`
```typescript
// 【変更前】
if (condition) {
  return OLD_LEVEL;
}

// 【変更後】
if (condition) {
  return NEW_LEVEL;
}
```

**変更箇所2**: `facility-position-mapping.ts`
```typescript
// 【追加】
{ positionName: 'XXXXX', baseLevel: X.X, managementScope: XX }
```

### 2.2 VoiceDriveシステム側

#### 影響を受けるファイル

| ファイル名 | 影響内容 | 変更行数 | 影響度 | 工数 |
|-----------|---------|---------|--------|------|
| `accountLevel.ts` | [詳細] | XX行 | [高/中/低] | X時間 |
| `accountLevelHelpers.ts` | [詳細] | XX行 | [高/中/低] | X時間 |
| `projectModePermissions.ts` | [詳細] | XX行 | [高/中/低] | X時間 |
| `agendaModePermissions.ts` | [詳細] | XX行 | [高/中/低] | X時間 |

---

## 3. API仕様への影響

### 3.1 影響を受けるエンドポイント

| エンドポイント | 変更内容 | 影響度 | 互換性 |
|--------------|---------|--------|--------|
| `GET /api/v1/calculate-level` | [変更内容] | [高/中/低] | [後方互換あり/なし] |
| `POST /api/staff/create` | [変更内容] | [高/中/低] | [後方互換あり/なし] |
| [その他] | [変更内容] | [高/中/低] | [後方互換あり/なし] |

### 3.2 リクエスト/レスポンス形式の変更

#### 変更前
```json
{
  "accountLevel": 6,
  "position": "主任"
}
```

#### 変更後
```json
{
  "accountLevel": 7.0,
  "position": "統括主任",
  "facilityId": "tategami-rehabilitation"
}
```

### 3.3 API バージョニング

- [ ] 新しいAPIバージョンが必要（v2, v3等）
- [ ] 既存APIバージョンの拡張で対応可能
- [ ] APIへの影響なし

---

## 4. フロントエンドUIへの影響

### 4.1 医療システム側UI

| 画面名 | 影響内容 | 変更箇所 | 影響度 | 工数 |
|--------|---------|---------|--------|------|
| 職員一覧 | [詳細] | [箇所] | [高/中/低] | X時間 |
| 職員詳細 | [詳細] | [箇所] | [高/中/低] | X時間 |
| [その他] | [詳細] | [箇所] | [高/中/低] | X時間 |

### 4.2 VoiceDriveシステム側UI

| 画面名 | 影響内容 | 変更箇所 | 影響度 | 工数 |
|--------|---------|---------|--------|------|
| プロフィール | [詳細] | [箇所] | [高/中/低] | X時間 |
| 投票画面 | [詳細] | [箇所] | [高/中/低] | X時間 |
| [その他] | [詳細] | [箇所] | [高/中/低] | X時間 |

---

## 5. 既存機能への影響

### 5.1 権限チェックロジック

**影響を受ける機能**:
- [ ] SSO認証
- [ ] 権限判定
- [ ] データアクセス制御
- [ ] その他: _______________

**必要な修正**:
- [修正1]
- [修正2]

### 5.2 レポート・分析機能

**影響を受けるレポート**:
- [ ] 職員一覧レポート
- [ ] 権限マトリックスレポート
- [ ] VoiceDrive分析レポート
- [ ] その他: _______________

**必要な修正**:
- [修正1]
- [修正2]

---

## 6. テストケースへの影響

### 6.1 新規テストケース

| テストケース名 | テスト種別 | 優先度 | 工数 |
|--------------|----------|--------|------|
| [テスト1] | [単体/統合] | [高/中/低] | X時間 |
| [テスト2] | [単体/統合] | [高/中/低] | X時間 |

**総テストケース数**: 約 ____ 件

### 6.2 既存テストケースの修正

| テストケース名 | 修正内容 | 影響度 | 工数 |
|--------------|---------|--------|------|
| [テスト1] | [修正内容] | [高/中/低] | X時間 |
| [テスト2] | [修正内容] | [高/中/低] | X時間 |

---

## 7. パフォーマンスへの影響

### 7.1 処理速度への影響

| 処理名 | 現在の処理時間 | 予想される処理時間 | 影響度 |
|--------|-------------|----------------|--------|
| レベル計算 | XX ms | XX ms | [高/中/低] |
| データ同期 | XX秒 | XX秒 | [高/中/低] |
| [その他] | XX ms | XX ms | [高/中/低] |

### 7.2 データ量への影響

**データベースサイズの増加**: 約 ____ MB

---

## 8. セキュリティへの影響

### 8.1 権限エスカレーション

- [ ] 権限エスカレーションのリスクあり
- [ ] 権限エスカレーションのリスクなし

**詳細**:
[リスクの詳細、対策]

### 8.2 データアクセス制御

**影響を受けるデータアクセス制御**:
- [制御1]
- [制御2]

**必要な対策**:
- [対策1]
- [対策2]

---

## 9. 運用への影響

### 9.1 データ移行作業

**移行作業の規模**: [小規模 / 中規模 / 大規模]

| 作業項目 | 所要時間 | ダウンタイム | 担当 |
|---------|---------|------------|------|
| データバックアップ | X時間 | [必要/不要] | [担当] |
| スキーマ変更 | X時間 | [必要/不要] | [担当] |
| データ移行 | X時間 | [必要/不要] | [担当] |
| 検証 | X時間 | [必要/不要] | [担当] |

**推奨実施時間帯**: [平日夜間 / 休日 / いつでも可]

### 9.2 監視・ログへの影響

**必要な監視項目の追加**:
- [項目1]
- [項目2]

**ログ出力の変更**:
- [変更1]
- [変更2]

---

## 10. ドキュメントへの影響

### 10.1 更新が必要なドキュメント

| ドキュメント名 | 更新内容 | 優先度 | 工数 |
|--------------|---------|--------|------|
| マスタープラン | [更新内容] | [高/中/低] | X時間 |
| API仕様書 | [更新内容] | [高/中/低] | X時間 |
| 運用マニュアル | [更新内容] | [高/中/低] | X時間 |
| [その他] | [更新内容] | [高/中/低] | X時間 |

---

## 11. リスク評価

### 11.1 技術的リスク

| リスク内容 | 発生確率 | 影響度 | リスクレベル | 対策 |
|-----------|---------|--------|------------|------|
| [リスク1] | [高/中/低] | [高/中/低] | [高/中/低] | [対策] |
| [リスク2] | [高/中/低] | [高/中/低] | [高/中/低] | [対策] |

### 11.2 運用リスク

| リスク内容 | 発生確率 | 影響度 | リスクレベル | 対策 |
|-----------|---------|--------|------------|------|
| [リスク1] | [高/中/低] | [高/中/低] | [高/中/低] | [対策] |
| [リスク2] | [高/中/低] | [高/中/低] | [高/中/低] | [対策] |

### 11.3 ビジネスリスク

| リスク内容 | 発生確率 | 影響度 | リスクレベル | 対策 |
|-----------|---------|--------|------------|------|
| [リスク1] | [高/中/低] | [高/中/低] | [高/中/低] | [対策] |
| [リスク2] | [高/中/低] | [高/中/低] | [高/中/低] | [対策] |

---

## 12. 工数・コスト見積

### 12.1 工数見積サマリー

| チーム | 設計 | 実装 | テスト | ドキュメント | 合計 |
|--------|------|------|--------|-------------|------|
| **医療チーム** | X時間 | X時間 | X時間 | X時間 | **X時間** |
| **VoiceDriveチーム** | X時間 | X時間 | X時間 | X時間 | **X時間** |
| **合計** | X時間 | X時間 | X時間 | X時間 | **X時間** |

### 12.2 スケジュール見積

**総所要期間**: ____ 週間

| フェーズ | 期間 | 備考 |
|---------|------|------|
| 設計 | X週間 | [備考] |
| 実装 | X週間 | [備考] |
| テスト | X週間 | [備考] |
| 本番反映 | X週間 | [備考] |

---

## 13. 推奨事項

### 13.1 実装判定

- [ ] **推奨**: 影響範囲が明確で、実装可能
- [ ] **条件付き推奨**: 以下の条件を満たせば実装可能
  - 条件1: _______________
  - 条件2: _______________
- [ ] **非推奨**: 以下の理由により実装困難
  - 理由1: _______________
  - 理由2: _______________

### 13.2 実装時の注意事項

1. [注意事項1]
2. [注意事項2]
3. [注意事項3]

### 13.3 代替案

**代替案1**:
- 内容: _______________
- メリット: _______________
- デメリット: _______________

**代替案2**:
- 内容: _______________
- メリット: _______________
- デメリット: _______________

---

## 14. 次のアクション

### 14.1 即時実施項目

- [ ] [アクション1]
- [ ] [アクション2]

### 14.2 承認後実施項目

- [ ] [アクション1]
- [ ] [アクション2]

---

## 15. 添付資料

1. [資料1]
2. [資料2]
3. [資料3]

---

## 変更履歴

| 日付 | バージョン | 調査者 | 変更内容 |
|------|-----------|--------|---------|
| YYYY-MM-DD | 1.0 | [氏名] | 初版作成 |
| YYYY-MM-DD | 1.1 | [氏名] | [変更内容] |

---

**調査者**: ___________________
**レビュー者（医療チーム）**: ___________________
**レビュー者（VoiceDriveチーム）**: ___________________

**提出日**: YYYY年MM月DD日
